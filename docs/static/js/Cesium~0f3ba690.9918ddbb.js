(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["Cesium~0f3ba690"],{"05e5":function(e,t,i){"use strict";const n={CENTER:0,BOTTOM:1,BASELINE:2,TOP:-1};t["a"]=Object.freeze(n)},"27aa":function(e,t,i){"use strict";var n=i("be18"),a=i("bd8d"),o=i("abab"),s=i("535a"),r=i("2f63"),c=i("7d62"),u=i("0123"),l=i("52f0"),d=i("1b8d"),h=i("f20a"),_=i("8b68"),f=i("a894"),p=i("d289"),m=i("6dc0"),b=i("e90c"),g=i("5770"),y=i("7c5e"),O=i("ae16"),v=i("8fa0"),T=i("b7c8"),I=i("5af0"),C=i("5a6c"),S=i("06f0"),x=i("6928"),w=i("3626"),A=i("6102"),P=i("25ef"),E=i("d8f6");function L(e){e=Object(s["a"])(e,s["a"].EMPTY_OBJECT),this._batchTable=e.batchTable,this._batchIds=e.batchIds,this._positions=e.positions,this._vertexBatchIds=e.vertexBatchIds,this._indices=e.indices,this._indexCounts=e.indexCounts,this._indexOffsets=e.indexOffsets,this._batchedIndices=e.batchedIndices,this._boundingVolume=e.boundingVolume,this._boundingVolumes=e.boundingVolumes,this._center=Object(s["a"])(e.center,n["a"].ZERO),this._va=void 0,this._sp=void 0,this._spStencil=void 0,this._spPick=void 0,this._uniformMap=void 0,this._vaSwap=void 0,this._rsStencilDepthPass=void 0,this._rsStencilDepthPass3DTiles=void 0,this._rsColorPass=void 0,this._rsPickPass=void 0,this._rsWireframe=void 0,this._commands=[],this._commandsIgnoreShow=[],this._pickCommands=[],this._constantColor=a["a"].clone(a["a"].WHITE),this._highlightColor=this._constantColor,this._batchDirty=!0,this._pickCommandsDirty=!0,this._framesSinceLastRebatch=0,this._updatingAllCommands=!1,this._trianglesLength=this._indices.length/3,this._geometryByteLength=this._indices.byteLength+this._positions.byteLength+this._vertexBatchIds.byteLength,this.debugWireframe=!1,this._debugWireframe=this.debugWireframe,this._wireframeDirty=!1,this.forceRebatch=!1,this.classificationType=Object(s["a"])(e.classificationType,C["a"].BOTH),this._vertexShaderSource=e._vertexShaderSource,this._fragmentShaderSource=e._fragmentShaderSource,this._attributeLocations=e._attributeLocations,this._uniformMap=e._uniformMap,this._pickId=e._pickId,this._modelMatrix=e._modelMatrix,this._boundingSphere=e._boundingSphere,this._batchIdLookUp={};const t=this._batchIds.length;for(let i=0;i<t;++i){const e=this._batchIds[i];this._batchIdLookUp[e]=i}}Object.defineProperties(L.prototype,{trianglesLength:{get:function(){return this._trianglesLength}},geometryByteLength:{get:function(){return this._geometryByteLength}}});const D={position:0,a_batchId:1};function j(e,t){if(Object(r["a"])(e._va))return;const i=h["a"].createVertexBuffer({context:t,typedArray:e._positions,usage:_["a"].STATIC_DRAW}),n=h["a"].createVertexBuffer({context:t,typedArray:e._vertexBatchIds,usage:_["a"].STATIC_DRAW}),a=h["a"].createIndexBuffer({context:t,typedArray:e._indices,usage:_["a"].DYNAMIC_DRAW,indexDatatype:2===e._indices.BYTES_PER_ELEMENT?u["a"].UNSIGNED_SHORT:u["a"].UNSIGNED_INT}),s=[{index:0,vertexBuffer:i,componentDatatype:o["a"].fromTypedArray(e._positions),componentsPerAttribute:3},{index:1,vertexBuffer:n,componentDatatype:o["a"].fromTypedArray(e._vertexBatchIds),componentsPerAttribute:1}];e._va=new y["a"]({context:t,attributes:s,indexBuffer:a}),t.webgl2&&(e._vaSwap=new y["a"]({context:t,attributes:s,indexBuffer:h["a"].createIndexBuffer({context:t,sizeInBytes:a.sizeInBytes,usage:_["a"].DYNAMIC_DRAW,indexDatatype:a.indexDatatype})})),e._batchedPositions=void 0,e._transferrableBatchIds=void 0,e._vertexBatchIds=void 0,e._verticesPromise=void 0}function N(e,t){if(Object(r["a"])(e._sp))return;const i=e._batchTable,n=Object(s["a"])(e._attributeLocations,D);let a=e._pickId;const o=e._vertexShaderSource;let c=e._fragmentShaderSource;if(Object(r["a"])(o))return e._sp=b["a"].fromCache({context:t,vertexShaderSource:o,fragmentShaderSource:c,attributeLocations:n}),e._spStencil=e._sp,c=g["a"].replaceMain(c,"czm_non_pick_main"),c=c+"void main() \n{ \n    czm_non_pick_main(); \n"+`    gl_FragColor = ${a}; \n} \n`,void(e._spPick=b["a"].fromCache({context:t,vertexShaderSource:o,fragmentShaderSource:c,attributeLocations:n}));const u=i.getVertexShaderCallback(!1,"a_batchId",void 0)(v["a"]);let l=i.getFragmentShaderCallback(!1,void 0,!0)(O["a"]);a=i.getPickId();let d=new g["a"]({sources:[u]}),h=new g["a"]({defines:["VECTOR_TILE"],sources:[l]});e._sp=b["a"].fromCache({context:t,vertexShaderSource:d,fragmentShaderSource:h,attributeLocations:n}),d=new g["a"]({sources:[v["a"]]}),h=new g["a"]({defines:["VECTOR_TILE"],sources:[O["a"]]}),e._spStencil=b["a"].fromCache({context:t,vertexShaderSource:d,fragmentShaderSource:h,attributeLocations:n}),l=g["a"].replaceMain(l,"czm_non_pick_main"),l=l+"\nvoid main() \n{ \n    czm_non_pick_main(); \n"+`    gl_FragColor = ${a}; \n} \n`;const _=new g["a"]({sources:[u]}),f=new g["a"]({defines:["VECTOR_TILE"],sources:[l]});e._spPick=b["a"].fromCache({context:t,vertexShaderSource:_,fragmentShaderSource:f,attributeLocations:n})}function k(e){const t=e?A["a"].EQUAL:A["a"].ALWAYS;return{colorMask:{red:!1,green:!1,blue:!1,alpha:!1},stencilTest:{enabled:!0,frontFunction:t,frontOperation:{fail:P["a"].KEEP,zFail:P["a"].DECREMENT_WRAP,zPass:P["a"].KEEP},backFunction:t,backOperation:{fail:P["a"].KEEP,zFail:P["a"].INCREMENT_WRAP,zPass:P["a"].KEEP},reference:w["a"].CESIUM_3D_TILE_MASK,mask:w["a"].CESIUM_3D_TILE_MASK},stencilMask:w["a"].CLASSIFICATION_MASK,depthTest:{enabled:!0,func:S["a"].LESS_OR_EQUAL},depthMask:!1}}const B={stencilTest:{enabled:!0,frontFunction:A["a"].NOT_EQUAL,frontOperation:{fail:P["a"].ZERO,zFail:P["a"].ZERO,zPass:P["a"].ZERO},backFunction:A["a"].NOT_EQUAL,backOperation:{fail:P["a"].ZERO,zFail:P["a"].ZERO,zPass:P["a"].ZERO},reference:0,mask:w["a"].CLASSIFICATION_MASK},stencilMask:w["a"].CLASSIFICATION_MASK,depthTest:{enabled:!1},depthMask:!1,blending:T["a"].PRE_MULTIPLIED_ALPHA_BLEND},F={stencilTest:{enabled:!0,frontFunction:A["a"].NOT_EQUAL,frontOperation:{fail:P["a"].ZERO,zFail:P["a"].ZERO,zPass:P["a"].ZERO},backFunction:A["a"].NOT_EQUAL,backOperation:{fail:P["a"].ZERO,zFail:P["a"].ZERO,zPass:P["a"].ZERO},reference:0,mask:w["a"].CLASSIFICATION_MASK},stencilMask:w["a"].CLASSIFICATION_MASK,depthTest:{enabled:!1},depthMask:!1};function M(e){Object(r["a"])(e._rsStencilDepthPass)||(e._rsStencilDepthPass=m["a"].fromCache(k(!1)),e._rsStencilDepthPass3DTiles=m["a"].fromCache(k(!0)),e._rsColorPass=m["a"].fromCache(B),e._rsPickPass=m["a"].fromCache(F))}const R=new l["a"],H=new n["a"];function U(e,t){if(Object(r["a"])(e._uniformMap))return;const i={u_modifiedModelViewProjection:function(){const i=t.uniformState.view,n=t.uniformState.projection;return l["a"].clone(i,R),l["a"].multiplyByPoint(R,e._center,H),l["a"].setTranslation(R,H,R),l["a"].multiply(n,R,R),R},u_highlightColor:function(){return e._highlightColor}};e._uniformMap=e._batchTable.getUniformMapCallback()(i)}function V(e,t,i,n,a,o,s){const r=e.constructor.BYTES_PER_ELEMENT,c=o.length;for(let u=0;u<c;++u){const c=o[u],l=s[c],d=n[l],h=a[l],_=new e.constructor(e.buffer,r*d,h);t.set(_,i),n[l]=i,i+=h}return i}function W(e,t){const i=e._indices,n=e._indexOffsets,o=e._indexCounts,s=e._batchIdLookUp,r=new i.constructor(i.length);let c=t.pop();const u=[c];let l=V(i,r,0,n,o,c.batchIds,s);c.offset=0,c.count=l;while(t.length>0){const e=t.pop();if(a["a"].equals(e.color,c.color))l=V(i,r,l,n,o,e.batchIds,s),c.batchIds=c.batchIds.concat(e.batchIds),c.count=l-c.offset;else{const t=l;l=V(i,r,l,n,o,e.batchIds,s),e.offset=t,e.count=l-t,u.push(e),c=e}}e._va.indexBuffer.copyFromArrayView(r),e._indices=r,e._batchedIndices=u}function G(e,t,i,n,a,o,s){const r=e.bytesPerIndex,c=o.length;for(let u=0;u<c;++u){const c=o[u],l=s[c],d=n[l],h=a[l];t.copyFromBuffer(e,d*r,i*r,h*r),n[l]=i,i+=h}return i}function z(e,t){const i=e._indexOffsets,n=e._indexCounts,o=e._batchIdLookUp;let s=t.pop();const r=[s],c=e._va.indexBuffer,u=e._vaSwap.indexBuffer;let l=G(c,u,0,i,n,s.batchIds,o);s.offset=0,s.count=l;while(t.length>0){const e=t.pop();if(a["a"].equals(e.color,s.color))l=G(c,u,l,i,n,e.batchIds,o),s.batchIds=s.batchIds.concat(e.batchIds),s.count=l-s.offset;else{const t=l;l=G(c,u,l,i,n,e.batchIds,o),e.offset=t,e.count=l-t,r.push(e),s=e}}const d=e._va;e._va=e._vaSwap,e._vaSwap=d,e._batchedIndices=r}function Y(e,t){return t.color.toRgba()-e.color.toRgba()}function Z(e,t){if(!e._batchDirty)return!1;const i=e._batchedIndices,n=i.length;let a=!1;const o={};for(let s=0;s<n;++s){const e=i[s].color,t=e.toRgba();if(Object(r["a"])(o[t])){a=!0;break}o[t]=!0}return a?a&&!e.forceRebatch&&e._framesSinceLastRebatch<120?void++e._framesSinceLastRebatch:(i.sort(Y),t.webgl2?z(e,i):W(e,i),e._framesSinceLastRebatch=0,e._batchDirty=!1,e._pickCommandsDirty=!0,e._wireframeDirty=!0,!0):(e._batchDirty=!1,!1)}function X(e,t){const i=Z(e,t),n=e._commands,a=e._batchedIndices,o=a.length,c=2*o;if(Object(r["a"])(n)&&!i&&n.length===c)return;n.length=c;const u=e._va,d=e._sp,h=Object(s["a"])(e._modelMatrix,l["a"].IDENTITY),_=e._uniformMap,m=e._boundingVolume;for(let s=0;s<o;++s){const t=a[s].offset,i=a[s].count;let o=n[2*s];Object(r["a"])(o)||(o=n[2*s]=new f["a"]({owner:e})),o.vertexArray=u,o.modelMatrix=h,o.offset=t,o.count=i,o.renderState=e._rsStencilDepthPass,o.shaderProgram=d,o.uniformMap=_,o.boundingVolume=m,o.cull=!1,o.pass=p["a"].TERRAIN_CLASSIFICATION;const c=f["a"].shallowClone(o,o.derivedCommands.tileset);c.renderState=e._rsStencilDepthPass3DTiles,c.pass=p["a"].CESIUM_3D_TILE_CLASSIFICATION,o.derivedCommands.tileset=c;let l=n[2*s+1];Object(r["a"])(l)||(l=n[2*s+1]=new f["a"]({owner:e})),l.vertexArray=u,l.modelMatrix=h,l.offset=t,l.count=i,l.renderState=e._rsColorPass,l.shaderProgram=d,l.uniformMap=_,l.boundingVolume=m,l.cull=!1,l.pass=p["a"].TERRAIN_CLASSIFICATION;const b=f["a"].shallowClone(l,l.derivedCommands.tileset);b.pass=p["a"].CESIUM_3D_TILE_CLASSIFICATION,l.derivedCommands.tileset=b}e._commandsDirty=!0}function K(e,t){if(e.classificationType===C["a"].TERRAIN||!t.invertClassification||Object(r["a"])(e._commandsIgnoreShow)&&!e._commandsDirty)return;const i=e._commands,n=e._commandsIgnoreShow,a=e._spStencil,o=i.length,s=n.length=o/2;let c=0;for(let r=0;r<s;++r){const e=n[r]=f["a"].shallowClone(i[c],n[r]);e.shaderProgram=a,e.pass=p["a"].CESIUM_3D_TILE_CLASSIFICATION_IGNORE_SHOW,c+=2}e._commandsDirty=!1}function q(e){if(!e._pickCommandsDirty)return;const t=e._indexOffsets.length,i=e._pickCommands;i.length=2*t;const n=e._va,a=e._spStencil,o=e._spPick,c=Object(s["a"])(e._modelMatrix,l["a"].IDENTITY),u=e._uniformMap;for(let s=0;s<t;++s){const t=e._indexOffsets[s],l=e._indexCounts[s],d=Object(r["a"])(e._boundingVolumes)?e._boundingVolumes[s]:e.boundingVolume;let h=i[2*s];Object(r["a"])(h)||(h=i[2*s]=new f["a"]({owner:e,pickOnly:!0})),h.vertexArray=n,h.modelMatrix=c,h.offset=t,h.count=l,h.renderState=e._rsStencilDepthPass,h.shaderProgram=a,h.uniformMap=u,h.boundingVolume=d,h.pass=p["a"].TERRAIN_CLASSIFICATION;const _=f["a"].shallowClone(h,h.derivedCommands.tileset);_.renderState=e._rsStencilDepthPass3DTiles,_.pass=p["a"].CESIUM_3D_TILE_CLASSIFICATION,h.derivedCommands.tileset=_;let m=i[2*s+1];Object(r["a"])(m)||(m=i[2*s+1]=new f["a"]({owner:e,pickOnly:!0})),m.vertexArray=n,m.modelMatrix=c,m.offset=t,m.count=l,m.renderState=e._rsPickPass,m.shaderProgram=o,m.uniformMap=u,m.boundingVolume=d,m.pass=p["a"].TERRAIN_CLASSIFICATION;const b=f["a"].shallowClone(m,m.derivedCommands.tileset);b.pass=p["a"].CESIUM_3D_TILE_CLASSIFICATION,m.derivedCommands.tileset=b}e._pickCommandsDirty=!1}function J(e,t){e._updatingAllCommands=!0;const i=e._batchIds;let n,o=i.length;for(n=0;n<o;++n){const e=i[n],o=t[e];o.show=!0,o.color=a["a"].WHITE}const s=e._batchedIndices;for(o=s.length,n=0;n<o;++n)s[n].color=a["a"].clone(a["a"].WHITE);e._updatingAllCommands=!1,e._batchDirty=!0}L.prototype.createFeatures=function(e,t){const i=this._batchIds,n=i.length;for(let a=0;a<n;++a){const n=i[a];t[n]=new I["a"](e,n)}},L.prototype.applyDebugSettings=function(e,t){this._highlightColor=e?t:this._constantColor};const Q=new a["a"],$=a["a"].WHITE,ee=!0,te=/\$/;function ie(e,t,i,n){const a=e.classificationType,o=a!==C["a"].CESIUM_3D_TILE,s=a!==C["a"].TERRAIN,c=t.commandList;let u,l,d=i.length;for(l=0;l<d;++l)o&&(u=i[l],u.pass=p["a"].TERRAIN_CLASSIFICATION,c.push(u)),s&&(u=i[l].derivedCommands.tileset,u.pass=p["a"].CESIUM_3D_TILE_CLASSIFICATION,c.push(u));if(t.invertClassification&&Object(r["a"])(n))for(d=n.length,l=0;l<d;++l)c.push(n[l])}function ne(e,t){const i=e.commandList,n=t.length;for(let a=0;a<n;a+=2){const e=t[a+1];e.pass=p["a"].OPAQUE,i.push(e)}}function ae(e){let t,i,n=e.debugWireframe===e._debugWireframe;if(n=n&&!(e.debugWireframe&&e._wireframeDirty),n)return;Object(r["a"])(e._rsWireframe)||(e._rsWireframe=m["a"].fromCache({})),e.debugWireframe?(t=e._rsWireframe,i=d["a"].LINES):(t=e._rsColorPass,i=d["a"].TRIANGLES);const a=e._commands,o=a.length;for(let s=0;s<o;s+=2){const e=a[s+1];e.renderState=t,e.primitiveType=i}e._debugWireframe=e.debugWireframe,e._wireframeDirty=!1}L.prototype.applyStyle=function(e,t){if(!Object(r["a"])(e))return void J(this,t);const i=e.color,n=i instanceof x["a"]&&!te.test(i.expression);this._updatingAllCommands=n;const o=this._batchIds;let s,c=o.length;for(s=0;s<c;++s){const i=o[s],n=t[i];n.color=Object(r["a"])(e.color)?e.color.evaluateColor(n,Q):$,n.show=Object(r["a"])(e.show)?e.show.evaluate(n):ee}if(n){const e=this._batchedIndices;for(c=e.length,s=0;s<c;++s)e[s].color=a["a"].clone(a["a"].WHITE);this._updatingAllCommands=!1,this._batchDirty=!0}},L.prototype.updateCommands=function(e,t){if(this._updatingAllCommands)return;const i=this._batchIdLookUp,n=i[e];if(!Object(r["a"])(n))return;const o=this._indexOffsets,s=this._indexCounts,c=o[n],u=s[n],l=this._batchedIndices,d=l.length;let h;for(h=0;h<d;++h){const e=l[h].offset,t=l[h].count;if(c>=e&&c<e+t)break}l.push(new E["a"]({color:a["a"].clone(t),offset:c,count:u,batchIds:[e]}));const _=[],f=[],p=l[h].batchIds,m=p.length;for(let a=0;a<m;++a){const t=p[a];if(t===e)continue;const n=i[t];o[n]<c?_.push(t):f.push(t)}0!==f.length&&l.push(new E["a"]({color:a["a"].clone(l[h].color),offset:c+u,count:l[h].offset+l[h].count-(c+u),batchIds:f})),0!==_.length?(l[h].count=c-l[h].offset,l[h].batchIds=_):l.splice(h,1),this._batchDirty=!0},L.prototype.update=function(e){const t=e.context;j(this,t),N(this,t),M(this),U(this,t);const i=e.passes;i.render&&(X(this,t),K(this,e),ae(this),this._debugWireframe?ne(e,this._commands):ie(this,e,this._commands,this._commandsIgnoreShow)),i.pick&&(q(this),ie(this,e,this._pickCommands))},L.prototype.isDestroyed=function(){return!1},L.prototype.destroy=function(){return this._va=this._va&&this._va.destroy(),this._sp=this._sp&&this._sp.destroy(),this._spPick=this._spPick&&this._spPick.destroy(),this._vaSwap=this._vaSwap&&this._vaSwap.destroy(),Object(c["a"])(this)},t["a"]=L},"364c":function(e,t,i){"use strict";var n=i("be18"),a=i("535a"),o=i("2f63"),s=i("7d62"),r=i("c52f"),c=i("e856"),u=i("abab"),l=i("93da"),d=i("52f0"),h=i("eace"),_=i("283e"),f=i("6596"),p=i("9889"),m=i("670c"),b=i("bd8d"),g=i("aee6"),y=i("6dfc"),O=i("6a29"),v=i("8f7c"),T=i("7950"),I=i("f61d"),C=i("04e1"),S=i("4626"),x=i("4082"),w=i("05e5");function A(e){this._positions=e.positions,this._batchTable=e.batchTable,this._batchIds=e.batchIds,this._rectangle=e.rectangle,this._minHeight=e.minimumHeight,this._maxHeight=e.maximumHeight,this._billboardCollection=new v["a"]({batchTable:e.batchTable}),this._labelCollection=new C["a"]({batchTable:e.batchTable}),this._polylineCollection=new x["a"],this._polylineCollection._useHighlightColor=!0,this._verticesPromise=void 0,this._packedBuffer=void 0,this._ready=!1,this._update=function(e,t){},this._readyPromise=W(this)}function P(e,t){const i=e._rectangle,n=e._minHeight,a=e._maxHeight,o=2+h["a"].packedLength+r["a"].packedLength,s=new Float64Array(o);let c=0;return s[c++]=n,s[c++]=a,h["a"].pack(i,s,c),c+=h["a"].packedLength,r["a"].pack(t,s,c),s}Object.defineProperties(A.prototype,{pointsLength:{get:function(){return this._billboardCollection.length}},texturesByteLength:{get:function(){const e=this._billboardCollection.textureAtlas.texture.sizeInBytes,t=this._labelCollection._textureAtlas.texture.sizeInBytes;return e+t}},readyPromise:{get:function(){return this._readyPromise}}});const E=new O["a"]("createVectorTilePoints",5),L=new n["a"];function D(e,t){let i;if(!Object(o["a"])(e._verticesPromise)){i=e._positions;let a=e._packedBuffer;Object(o["a"])(a)||(i=e._positions=i.slice(),e._batchIds=e._batchIds.slice(),a=e._packedBuffer=P(e,t));const s=[i.buffer,a.buffer],r={positions:i.buffer,packedBuffer:a.buffer},c=e._verticesPromise=E.scheduleTask(r,s);if(!Object(o["a"])(c))return;return c.then((function(t){e._positions=new Float64Array(t.positions);const a=e._billboardCollection,o=e._labelCollection,s=e._polylineCollection;i=e._positions;const r=e._batchIds,c=i.length/3;for(let e=0;e<c;++e){const t=r[e],c=n["a"].unpack(i,3*e,L),u=a.add();u.position=c,u._batchIndex=t;const l=o.add();l.text=" ",l.position=c,l._batchIndex=t;const d=s.add();d.positions=[n["a"].clone(c),n["a"].clone(c)]}e._positions=void 0,e._packedBuffer=void 0,e._ready=!0}))}}function j(e,t){const i=e._batchIds,n=i.length;for(let a=0;a<n;++a){const e=i[a],n=t[e];n.show=!0,n.pointSize=T["a"].defaultPointSize,n.color=T["a"].defaultColor,n.pointOutlineColor=T["a"].defaultPointOutlineColor,n.pointOutlineWidth=T["a"].defaultPointOutlineWidth,n.labelColor=b["a"].WHITE,n.labelOutlineColor=b["a"].WHITE,n.labelOutlineWidth=1,n.font="30px sans-serif",n.labelStyle=S["a"].FILL,n.labelText=void 0,n.backgroundColor=new b["a"](.165,.165,.165,.8),n.backgroundPadding=new m["a"](7,5),n.backgroundEnabled=!1,n.scaleByDistance=void 0,n.translucencyByDistance=void 0,n.distanceDisplayCondition=void 0,n.heightOffset=0,n.anchorLineEnabled=!1,n.anchorLineColor=b["a"].WHITE,n.image=void 0,n.disableDepthTestDistance=0,n.horizontalOrigin=I["a"].CENTER,n.verticalOrigin=w["a"].CENTER,n.labelHorizontalOrigin=I["a"].RIGHT,n.labelVerticalOrigin=w["a"].BASELINE}}A.prototype.createFeatures=function(e,t){const i=this._billboardCollection,n=this._labelCollection,a=this._polylineCollection,o=this._batchIds,s=o.length;for(let r=0;r<s;++r){const s=o[r],c=i.get(r),u=n.get(r),l=a.get(r);t[s]=new T["a"](e,s,c,u,l)}},A.prototype.applyDebugSettings=function(e,t){e?(b["a"].clone(t,this._billboardCollection._highlightColor),b["a"].clone(t,this._labelCollection._highlightColor),b["a"].clone(t,this._polylineCollection._highlightColor)):(b["a"].clone(b["a"].WHITE,this._billboardCollection._highlightColor),b["a"].clone(b["a"].WHITE,this._labelCollection._highlightColor),b["a"].clone(b["a"].WHITE,this._polylineCollection._highlightColor))};const N=new b["a"],k=new b["a"],B=new b["a"],F=new b["a"],M=new b["a"],R=new b["a"],H=new y["a"],U=new y["a"],V=new g["a"];function W(e){return new Promise((function(t,i){e._update=function(e,n){const a=D(e,n.mapProjection.ellipsoid);e._ready&&(e._polylineCollection.update(n),e._billboardCollection.update(n),e._labelCollection.update(n)),Object(o["a"])(a)&&a.then((function(){t()})).catch((function(e){i(e)}))}}))}A.prototype.applyStyle=function(e,t){if(!Object(o["a"])(e))return void j(this,t);const i=this._batchIds,n=i.length;for(let a=0;a<n;++a){const n=i[a],s=t[n];if(Object(o["a"])(e.show)&&(s.show=e.show.evaluate(s)),Object(o["a"])(e.pointSize)&&(s.pointSize=e.pointSize.evaluate(s)),Object(o["a"])(e.color)&&(s.color=e.color.evaluateColor(s,N)),Object(o["a"])(e.pointOutlineColor)&&(s.pointOutlineColor=e.pointOutlineColor.evaluateColor(s,k)),Object(o["a"])(e.pointOutlineWidth)&&(s.pointOutlineWidth=e.pointOutlineWidth.evaluate(s)),Object(o["a"])(e.labelColor)&&(s.labelColor=e.labelColor.evaluateColor(s,B)),Object(o["a"])(e.labelOutlineColor)&&(s.labelOutlineColor=e.labelOutlineColor.evaluateColor(s,F)),Object(o["a"])(e.labelOutlineWidth)&&(s.labelOutlineWidth=e.labelOutlineWidth.evaluate(s)),Object(o["a"])(e.font)&&(s.font=e.font.evaluate(s)),Object(o["a"])(e.labelStyle)&&(s.labelStyle=e.labelStyle.evaluate(s)),Object(o["a"])(e.labelText)?s.labelText=e.labelText.evaluate(s):s.labelText=void 0,Object(o["a"])(e.backgroundColor)&&(s.backgroundColor=e.backgroundColor.evaluateColor(s,M)),Object(o["a"])(e.backgroundPadding)&&(s.backgroundPadding=e.backgroundPadding.evaluate(s)),Object(o["a"])(e.backgroundEnabled)&&(s.backgroundEnabled=e.backgroundEnabled.evaluate(s)),Object(o["a"])(e.scaleByDistance)){const t=e.scaleByDistance.evaluate(s);H.near=t.x,H.nearValue=t.y,H.far=t.z,H.farValue=t.w,s.scaleByDistance=H}else s.scaleByDistance=void 0;if(Object(o["a"])(e.translucencyByDistance)){const t=e.translucencyByDistance.evaluate(s);U.near=t.x,U.nearValue=t.y,U.far=t.z,U.farValue=t.w,s.translucencyByDistance=U}else s.translucencyByDistance=void 0;if(Object(o["a"])(e.distanceDisplayCondition)){const t=e.distanceDisplayCondition.evaluate(s);V.near=t.x,V.far=t.y,s.distanceDisplayCondition=V}else s.distanceDisplayCondition=void 0;Object(o["a"])(e.heightOffset)&&(s.heightOffset=e.heightOffset.evaluate(s)),Object(o["a"])(e.anchorLineEnabled)&&(s.anchorLineEnabled=e.anchorLineEnabled.evaluate(s)),Object(o["a"])(e.anchorLineColor)&&(s.anchorLineColor=e.anchorLineColor.evaluateColor(s,R)),Object(o["a"])(e.image)?s.image=e.image.evaluate(s):s.image=void 0,Object(o["a"])(e.disableDepthTestDistance)&&(s.disableDepthTestDistance=e.disableDepthTestDistance.evaluate(s)),Object(o["a"])(e.horizontalOrigin)&&(s.horizontalOrigin=e.horizontalOrigin.evaluate(s)),Object(o["a"])(e.verticalOrigin)&&(s.verticalOrigin=e.verticalOrigin.evaluate(s)),Object(o["a"])(e.labelHorizontalOrigin)&&(s.labelHorizontalOrigin=e.labelHorizontalOrigin.evaluate(s)),Object(o["a"])(e.labelVerticalOrigin)&&(s.labelVerticalOrigin=e.labelVerticalOrigin.evaluate(s))}},A.prototype.update=function(e){this._update(this,e)},A.prototype.isDestroyed=function(){return!1},A.prototype.destroy=function(){return this._billboardCollection=this._billboardCollection&&this._billboardCollection.destroy(),this._labelCollection=this._labelCollection&&this._labelCollection.destroy(),this._polylineCollection=this._polylineCollection&&this._polylineCollection.destroy(),Object(s["a"])(this)};var G=A,z=i("0123"),Y=i("78e5"),Z=i("5a6c"),X=i("d8f6"),K=i("27aa");function q(e){this._batchTable=e.batchTable,this._batchIds=e.batchIds,this._positions=e.positions,this._counts=e.counts,this._indices=e.indices,this._indexCounts=e.indexCounts,this._indexOffsets=void 0,this._batchTableColors=void 0,this._packedBuffer=void 0,this._batchedPositions=void 0,this._transferrableBatchIds=void 0,this._vertexBatchIds=void 0,this._ellipsoid=Object(a["a"])(e.ellipsoid,r["a"].WGS84),this._minimumHeight=e.minimumHeight,this._maximumHeight=e.maximumHeight,this._polygonMinimumHeights=e.polygonMinimumHeights,this._polygonMaximumHeights=e.polygonMaximumHeights,this._center=Object(a["a"])(e.center,n["a"].ZERO),this._rectangle=e.rectangle,this._center=void 0,this._boundingVolume=e.boundingVolume,this._boundingVolumes=void 0,this._batchedIndices=void 0,this._ready=!1,this._update=function(e,t){},this._readyPromise=ne(this),this._verticesPromise=void 0,this._primitive=void 0,this.debugWireframe=!1,this.forceRebatch=!1,this.classificationType=Z["a"].BOTH}function J(e){const t=new Float64Array(3+n["a"].packedLength+r["a"].packedLength+h["a"].packedLength);let i=0;return t[i++]=e._indices.BYTES_PER_ELEMENT,t[i++]=e._minimumHeight,t[i++]=e._maximumHeight,n["a"].pack(e._center,t,i),i+=n["a"].packedLength,r["a"].pack(e._ellipsoid,t,i),i+=r["a"].packedLength,h["a"].pack(e._rectangle,t,i),t}function Q(e,t){let i=1;const n=t[i++],a=e._boundingVolumes=new Array(n);for(let r=0;r<n;++r)a[r]=Y["a"].unpack(t,i),i+=Y["a"].packedLength;const o=t[i++],s=e._batchedIndices=new Array(o);for(let r=0;r<o;++r){const e=b["a"].unpack(t,i);i+=b["a"].packedLength;const n=t[i++],a=t[i++],o=t[i++],c=new Array(o);for(let s=0;s<o;++s)c[s]=t[i++];s[r]=new X["a"]({color:e,offset:n,count:a,batchIds:c})}}Object.defineProperties(q.prototype,{trianglesLength:{get:function(){return Object(o["a"])(this._primitive)?this._primitive.trianglesLength:0}},geometryByteLength:{get:function(){return Object(o["a"])(this._primitive)?this._primitive.geometryByteLength:0}},readyPromise:{get:function(){return this._readyPromise}}});const $=new O["a"]("createVectorTilePolygons",5),ee=new b["a"];function te(e){if(!Object(o["a"])(e._primitive)&&!Object(o["a"])(e._verticesPromise)){let t=e._positions,i=e._counts,n=e._indexCounts,a=e._indices,s=e._transferrableBatchIds,r=e._batchTableColors,c=e._packedBuffer;if(!Object(o["a"])(r)){t=e._positions=e._positions.slice(),i=e._counts=e._counts.slice(),n=e._indexCounts=e._indexCounts.slice(),a=e._indices=e._indices.slice(),e._center=e._ellipsoid.cartographicToCartesian(h["a"].center(e._rectangle)),s=e._transferrableBatchIds=new Uint32Array(e._batchIds),r=e._batchTableColors=new Uint32Array(s.length);const o=e._batchTable,u=r.length;for(let e=0;e<u;++e){const t=o.getColor(e,ee);r[e]=t.toRgba()}c=e._packedBuffer=J(e)}const u=[t.buffer,i.buffer,n.buffer,a.buffer,s.buffer,r.buffer,c.buffer],l={packedBuffer:c.buffer,positions:t.buffer,counts:i.buffer,indexCounts:n.buffer,indices:a.buffer,batchIds:s.buffer,batchTableColors:r.buffer};let d=e._polygonMinimumHeights,_=e._polygonMaximumHeights;Object(o["a"])(d)&&Object(o["a"])(_)&&(d=d.slice(),_=_.slice(),u.push(d.buffer,_.buffer),l.minimumHeights=d,l.maximumHeights=_);const f=e._verticesPromise=$.scheduleTask(l,u);if(!Object(o["a"])(f))return;return f.then((function(t){e._positions=void 0,e._counts=void 0,e._polygonMinimumHeights=void 0,e._polygonMaximumHeights=void 0;const i=new Float64Array(t.packedBuffer),n=i[0];Q(e,i),e._indices=2===z["a"].getSizeInBytes(n)?new Uint16Array(t.indices):new Uint32Array(t.indices),e._indexOffsets=new Uint32Array(t.indexOffsets),e._indexCounts=new Uint32Array(t.indexCounts),e._batchedPositions=new Float32Array(t.positions),e._vertexBatchIds=new Uint16Array(t.batchIds),e._ready=!0}))}}function ie(e){e._ready&&!Object(o["a"])(e._primitive)&&(e._primitive=new K["a"]({batchTable:e._batchTable,positions:e._batchedPositions,batchIds:e._batchIds,vertexBatchIds:e._vertexBatchIds,indices:e._indices,indexOffsets:e._indexOffsets,indexCounts:e._indexCounts,batchedIndices:e._batchedIndices,boundingVolume:e._boundingVolume,boundingVolumes:e._boundingVolumes,center:e._center}),e._batchTable=void 0,e._batchIds=void 0,e._positions=void 0,e._counts=void 0,e._indices=void 0,e._indexCounts=void 0,e._indexOffsets=void 0,e._batchTableColors=void 0,e._packedBuffer=void 0,e._batchedPositions=void 0,e._transferrableBatchIds=void 0,e._vertexBatchIds=void 0,e._ellipsoid=void 0,e._minimumHeight=void 0,e._maximumHeight=void 0,e._polygonMinimumHeights=void 0,e._polygonMaximumHeights=void 0,e._center=void 0,e._rectangle=void 0,e._boundingVolume=void 0,e._boundingVolumes=void 0,e._batchedIndices=void 0,e._verticesPromise=void 0)}function ne(e){return new Promise((function(t,i){e._update=function(e,n){const a=te(e);e._ready&&(e._primitive.debugWireframe=e.debugWireframe,e._primitive.forceRebatch=e.forceRebatch,e._primitive.classificationType=e.classificationType,e._primitive.update(n)),Object(o["a"])(a)&&a.then((function(){ie(e),t(e)})).catch((function(e){i(e)}))}}))}q.prototype.createFeatures=function(e,t){this._primitive.createFeatures(e,t)},q.prototype.applyDebugSettings=function(e,t){this._primitive.applyDebugSettings(e,t)},q.prototype.applyStyle=function(e,t){this._primitive.applyStyle(e,t)},q.prototype.updateCommands=function(e,t){this._primitive.updateCommands(e,t)},q.prototype.update=function(e){this._update(this,e)},q.prototype.isDestroyed=function(){return!1},q.prototype.destroy=function(){return this._primitive=this._primitive&&this._primitive.destroy(),Object(s["a"])(this)};var ae=q,oe=i("5e57"),se=i("f20a"),re=i("8b68"),ce=i("a894"),ue=i("d289"),le=i("6dc0"),de=i("e90c"),he=i("5770"),_e=i("7c5e"),fe=i("b71e"),pe=i("95fe"),me=i("b7c8"),be=i("5af0");function ge(e){this._positions=e.positions,this._widths=e.widths,this._counts=e.counts,this._batchIds=e.batchIds,this._ellipsoid=Object(a["a"])(e.ellipsoid,r["a"].WGS84),this._minimumHeight=e.minimumHeight,this._maximumHeight=e.maximumHeight,this._center=e.center,this._rectangle=e.rectangle,this._boundingVolume=e.boundingVolume,this._batchTable=e.batchTable,this._va=void 0,this._sp=void 0,this._rs=void 0,this._uniformMap=void 0,this._command=void 0,this._transferrableBatchIds=void 0,this._packedBuffer=void 0,this._keepDecodedPositions=e.keepDecodedPositions,this._decodedPositions=void 0,this._decodedPositionOffsets=void 0,this._currentPositions=void 0,this._previousPositions=void 0,this._nextPositions=void 0,this._expandAndWidth=void 0,this._vertexBatchIds=void 0,this._indices=void 0,this._constantColor=b["a"].clone(b["a"].WHITE),this._highlightColor=this._constantColor,this._trianglesLength=0,this._geometryByteLength=0,this._ready=!1,this._update=function(e,t){},this._readyPromise=ke(this),this._verticesPromise=void 0}function ye(e){const t=e._rectangle,i=e._minimumHeight,a=e._maximumHeight,o=e._ellipsoid,s=e._center,c=2+h["a"].packedLength+r["a"].packedLength+n["a"].packedLength,u=new Float64Array(c);let l=0;return u[l++]=i,u[l++]=a,h["a"].pack(t,u,l),l+=h["a"].packedLength,r["a"].pack(o,u,l),l+=r["a"].packedLength,n["a"].pack(s,u,l),u}Object.defineProperties(ge.prototype,{trianglesLength:{get:function(){return this._trianglesLength}},geometryByteLength:{get:function(){return this._geometryByteLength}},readyPromise:{get:function(){return this._readyPromise}}});const Oe=new O["a"]("createVectorTilePolylines",5),ve={previousPosition:0,currentPosition:1,nextPosition:2,expandAndWidth:3,a_batchId:4};function Te(e,t){if(!Object(o["a"])(e._va)&&!Object(o["a"])(e._verticesPromise)){let t=e._positions,i=e._widths,n=e._counts,a=e._transferrableBatchIds,s=e._packedBuffer;Object(o["a"])(s)||(t=e._positions=t.slice(),i=e._widths=i.slice(),n=e._counts=n.slice(),a=e._transferrableBatchIds=e._batchIds.slice(),s=e._packedBuffer=ye(e));const r=[t.buffer,i.buffer,n.buffer,a.buffer,s.buffer],c={positions:t.buffer,widths:i.buffer,counts:n.buffer,batchIds:a.buffer,packedBuffer:s.buffer,keepDecodedPositions:e._keepDecodedPositions},u=e._verticesPromise=Oe.scheduleTask(c,r);if(!Object(o["a"])(u))return;return u.then((function(t){e._keepDecodedPositions&&(e._decodedPositions=new Float64Array(t.decodedPositions),e._decodedPositionOffsets=new Uint32Array(t.decodedPositionOffsets)),e._currentPositions=new Float32Array(t.currentPositions),e._previousPositions=new Float32Array(t.previousPositions),e._nextPositions=new Float32Array(t.nextPositions),e._expandAndWidth=new Float32Array(t.expandAndWidth),e._vertexBatchIds=new Uint16Array(t.batchIds);const i=t.indexDatatype;e._indices=i===z["a"].UNSIGNED_SHORT?new Uint16Array(t.indices):new Uint32Array(t.indices),e._ready=!0}))}}function Ie(e,t){if(e._ready&&!Object(o["a"])(e._va)){const i=e._currentPositions,n=e._previousPositions,a=e._nextPositions,o=e._expandAndWidth,s=e._vertexBatchIds,r=e._indices;let c=n.byteLength+i.byteLength+a.byteLength;c+=o.byteLength+s.byteLength+r.byteLength,e._trianglesLength=r.length/3,e._geometryByteLength=c;const l=se["a"].createVertexBuffer({context:t,typedArray:n,usage:re["a"].STATIC_DRAW}),d=se["a"].createVertexBuffer({context:t,typedArray:i,usage:re["a"].STATIC_DRAW}),h=se["a"].createVertexBuffer({context:t,typedArray:a,usage:re["a"].STATIC_DRAW}),_=se["a"].createVertexBuffer({context:t,typedArray:o,usage:re["a"].STATIC_DRAW}),f=se["a"].createVertexBuffer({context:t,typedArray:s,usage:re["a"].STATIC_DRAW}),p=se["a"].createIndexBuffer({context:t,typedArray:r,usage:re["a"].STATIC_DRAW,indexDatatype:2===r.BYTES_PER_ELEMENT?z["a"].UNSIGNED_SHORT:z["a"].UNSIGNED_INT}),m=[{index:ve.previousPosition,vertexBuffer:l,componentDatatype:u["a"].FLOAT,componentsPerAttribute:3},{index:ve.currentPosition,vertexBuffer:d,componentDatatype:u["a"].FLOAT,componentsPerAttribute:3},{index:ve.nextPosition,vertexBuffer:h,componentDatatype:u["a"].FLOAT,componentsPerAttribute:3},{index:ve.expandAndWidth,vertexBuffer:_,componentDatatype:u["a"].FLOAT,componentsPerAttribute:2},{index:ve.a_batchId,vertexBuffer:f,componentDatatype:u["a"].UNSIGNED_SHORT,componentsPerAttribute:1}];e._va=new _e["a"]({context:t,attributes:m,indexBuffer:p}),e._positions=void 0,e._widths=void 0,e._counts=void 0,e._ellipsoid=void 0,e._minimumHeight=void 0,e._maximumHeight=void 0,e._rectangle=void 0,e._transferrableBatchIds=void 0,e._packedBuffer=void 0,e._currentPositions=void 0,e._previousPositions=void 0,e._nextPositions=void 0,e._expandAndWidth=void 0,e._vertexBatchIds=void 0,e._indices=void 0}}const Ce=new d["a"],Se=new n["a"];function xe(e,t){Object(o["a"])(e._uniformMap)||(e._uniformMap={u_modifiedModelView:function(){const i=t.uniformState.view;return d["a"].clone(i,Ce),d["a"].multiplyByPoint(Ce,e._center,Se),d["a"].setTranslation(Ce,Se,Ce),Ce},u_highlightColor:function(){return e._highlightColor}})}function we(e){if(Object(o["a"])(e._rs))return;const t={enabled:!0,factor:-5,units:-5};e._rs=le["a"].fromCache({blending:me["a"].ALPHA_BLEND,depthMask:!1,depthTest:{enabled:!0},polygonOffset:t})}const Ae="uniform vec4 u_highlightColor; \nvoid main()\n{\n    gl_FragColor = u_highlightColor;\n}\n";function Pe(e,t){if(Object(o["a"])(e._sp))return;const i=e._batchTable,n=i.getVertexShaderCallback(!1,"a_batchId",void 0)(pe["a"]),a=i.getFragmentShaderCallback(!1,void 0,!1)(Ae),s=new he["a"]({defines:["VECTOR_TILE",oe["a"].isInternetExplorer()?"":"CLIP_POLYLINE"],sources:[fe["a"],n]}),r=new he["a"]({defines:["VECTOR_TILE"],sources:[a]});e._sp=de["a"].fromCache({context:t,vertexShaderSource:s,fragmentShaderSource:r,attributeLocations:ve})}function Ee(e,t){if(!Object(o["a"])(e._command)){const t=e._batchTable.getUniformMapCallback()(e._uniformMap);e._command=new ce["a"]({owner:e,vertexArray:e._va,renderState:e._rs,shaderProgram:e._sp,uniformMap:t,boundingVolume:e._boundingVolume,pass:ue["a"].TRANSLUCENT,pickId:e._batchTable.getPickId()})}t.commandList.push(e._command)}function Le(e,t){const i=e._batchIds,n=i.length;for(let a=0;a<n;++a){const e=i[a],n=t[e];n.show=!0,n.color=b["a"].WHITE}}ge.getPolylinePositions=function(e,t){const i=e._batchIds,n=e._decodedPositions,a=e._decodedPositionOffsets;if(!Object(o["a"])(i)||!Object(o["a"])(n))return;let s,r;const c=i.length;let u=0,l=0;for(s=0;s<c;++s)i[s]===t&&(u+=a[s+1]-a[s]);if(0===u)return;const d=new Float64Array(3*u);for(s=0;s<c;++s)if(i[s]===t){const e=a[s],t=a[s+1]-e;for(r=0;r<t;++r){const t=3*(e+r);d[l++]=n[t],d[l++]=n[t+1],d[l++]=n[t+2]}}return d},ge.prototype.getPositions=function(e){return ge.getPolylinePositions(this,e)},ge.prototype.createFeatures=function(e,t){const i=this._batchIds,n=i.length;for(let a=0;a<n;++a){const n=i[a];t[n]=new be["a"](e,n)}},ge.prototype.applyDebugSettings=function(e,t){this._highlightColor=e?t:this._constantColor};const De=new b["a"],je=b["a"].WHITE,Ne=!0;function ke(e){return new Promise((function(t,i){e._update=function(e,n){const a=n.context,s=Te(e,a);if(xe(e,a),Pe(e,a),we(e),e._ready){const t=n.passes;(t.render||t.pick)&&Ee(e,n)}Object(o["a"])(s)&&s.then((function(){Ie(e,a),t()})).catch((function(e){i(e)}))}}))}ge.prototype.applyStyle=function(e,t){if(!Object(o["a"])(e))return void Le(this,t);const i=this._batchIds,n=i.length;for(let a=0;a<n;++a){const n=i[a],s=t[n];s.color=Object(o["a"])(e.color)?e.color.evaluateColor(s,De):je,s.show=Object(o["a"])(e.show)?e.show.evaluate(s):Ne}},ge.prototype.update=function(e){this._update(this,e)},ge.prototype.isDestroyed=function(){return!1},ge.prototype.destroy=function(){return this._va=this._va&&this._va.destroy(),this._sp=this._sp&&this._sp.destroy(),Object(s["a"])(this)};var Be=ge,Fe=i("dd06"),Me=i("28ac"),Re=i("3e7b"),He=i("29ab"),Ue=i("3626"),Ve=i("6102"),We=i("25ef");function Ge(e){this._positions=e.positions,this._widths=e.widths,this._counts=e.counts,this._batchIds=e.batchIds,this._ellipsoid=Object(a["a"])(e.ellipsoid,r["a"].WGS84),this._minimumHeight=e.minimumHeight,this._maximumHeight=e.maximumHeight,this._center=e.center,this._rectangle=e.rectangle,this._batchTable=e.batchTable,this._va=void 0,this._sp=void 0,this._rs=void 0,this._uniformMap=void 0,this._command=void 0,this._transferrableBatchIds=void 0,this._packedBuffer=void 0,this._minimumMaximumVectorHeights=new m["a"](Fe["a"]._defaultMinTerrainHeight,Fe["a"]._defaultMaxTerrainHeight),this._boundingVolume=Y["a"].fromRectangle(e.rectangle,Fe["a"]._defaultMinTerrainHeight,Fe["a"]._defaultMaxTerrainHeight,this._ellipsoid),this._classificationType=e.classificationType,this._keepDecodedPositions=e.keepDecodedPositions,this._decodedPositions=void 0,this._decodedPositionOffsets=void 0,this._startEllipsoidNormals=void 0,this._endEllipsoidNormals=void 0,this._startPositionAndHeights=void 0,this._startFaceNormalAndVertexCornerIds=void 0,this._endPositionAndHeights=void 0,this._endFaceNormalAndHalfWidths=void 0,this._vertexBatchIds=void 0,this._indices=void 0,this._constantColor=b["a"].clone(b["a"].WHITE),this._highlightColor=this._constantColor,this._trianglesLength=0,this._geometryByteLength=0,this._ready=!1,this._update=function(e,t){},this._readyPromise=ct(this),this._verticesPromise=void 0}function ze(e,t,i){const n=Fe["a"].getMinimumMaximumHeights(t,i),a=n.minimumTerrainHeight,o=n.maximumTerrainHeight,s=e._minimumMaximumVectorHeights;s.x=a,s.y=o;const r=e._boundingVolume,c=e._rectangle;Y["a"].fromRectangle(c,a,o,i,r)}function Ye(e){const t=e._rectangle,i=e._minimumHeight,a=e._maximumHeight,o=e._ellipsoid,s=e._center,c=2+h["a"].packedLength+r["a"].packedLength+n["a"].packedLength,u=new Float64Array(c);let l=0;return u[l++]=i,u[l++]=a,h["a"].pack(t,u,l),l+=h["a"].packedLength,r["a"].pack(o,u,l),l+=r["a"].packedLength,n["a"].pack(s,u,l),u}Object.defineProperties(Ge.prototype,{trianglesLength:{get:function(){return this._trianglesLength}},geometryByteLength:{get:function(){return this._geometryByteLength}},readyPromise:{get:function(){return this._readyPromise}}});const Ze=new O["a"]("createVectorTileClampedPolylines"),Xe={startEllipsoidNormal:0,endEllipsoidNormal:1,startPositionAndHeight:2,endPositionAndHeight:3,startFaceNormalAndVertexCorner:4,endFaceNormalAndHalfWidth:5,a_batchId:6};function Ke(e,t){if(!Object(o["a"])(e._va)&&!Object(o["a"])(e._verticesPromise)){let t=e._positions,i=e._widths,n=e._counts,a=e._transferrableBatchIds,s=e._packedBuffer;Object(o["a"])(s)||(t=e._positions=t.slice(),i=e._widths=i.slice(),n=e._counts=n.slice(),a=e._transferrableBatchIds=e._batchIds.slice(),s=e._packedBuffer=Ye(e));const r=[t.buffer,i.buffer,n.buffer,a.buffer,s.buffer],c={positions:t.buffer,widths:i.buffer,counts:n.buffer,batchIds:a.buffer,packedBuffer:s.buffer,keepDecodedPositions:e._keepDecodedPositions},u=e._verticesPromise=Ze.scheduleTask(c,r);if(!Object(o["a"])(u))return;return u.then((function(t){e._keepDecodedPositions&&(e._decodedPositions=new Float64Array(t.decodedPositions),e._decodedPositionOffsets=new Uint32Array(t.decodedPositionOffsets)),e._startEllipsoidNormals=new Float32Array(t.startEllipsoidNormals),e._endEllipsoidNormals=new Float32Array(t.endEllipsoidNormals),e._startPositionAndHeights=new Float32Array(t.startPositionAndHeights),e._startFaceNormalAndVertexCornerIds=new Float32Array(t.startFaceNormalAndVertexCornerIds),e._endPositionAndHeights=new Float32Array(t.endPositionAndHeights),e._endFaceNormalAndHalfWidths=new Float32Array(t.endFaceNormalAndHalfWidths),e._vertexBatchIds=new Uint16Array(t.vertexBatchIds);const i=t.indexDatatype;e._indices=i===z["a"].UNSIGNED_SHORT?new Uint16Array(t.indices):new Uint32Array(t.indices),e._ready=!0}))}}function qe(e,t){if(e._ready&&!Object(o["a"])(e._va)){const i=e._startEllipsoidNormals,n=e._endEllipsoidNormals,a=e._startPositionAndHeights,o=e._endPositionAndHeights,s=e._startFaceNormalAndVertexCornerIds,r=e._endFaceNormalAndHalfWidths,c=e._vertexBatchIds,l=e._indices;let d=i.byteLength+n.byteLength;d+=a.byteLength+o.byteLength,d+=s.byteLength+r.byteLength,d+=c.byteLength+l.byteLength,e._trianglesLength=l.length/3,e._geometryByteLength=d;const h=se["a"].createVertexBuffer({context:t,typedArray:i,usage:re["a"].STATIC_DRAW}),_=se["a"].createVertexBuffer({context:t,typedArray:n,usage:re["a"].STATIC_DRAW}),f=se["a"].createVertexBuffer({context:t,typedArray:a,usage:re["a"].STATIC_DRAW}),p=se["a"].createVertexBuffer({context:t,typedArray:o,usage:re["a"].STATIC_DRAW}),m=se["a"].createVertexBuffer({context:t,typedArray:s,usage:re["a"].STATIC_DRAW}),b=se["a"].createVertexBuffer({context:t,typedArray:r,usage:re["a"].STATIC_DRAW}),g=se["a"].createVertexBuffer({context:t,typedArray:c,usage:re["a"].STATIC_DRAW}),y=se["a"].createIndexBuffer({context:t,typedArray:l,usage:re["a"].STATIC_DRAW,indexDatatype:2===l.BYTES_PER_ELEMENT?z["a"].UNSIGNED_SHORT:z["a"].UNSIGNED_INT}),O=[{index:Xe.startEllipsoidNormal,vertexBuffer:h,componentDatatype:u["a"].FLOAT,componentsPerAttribute:3},{index:Xe.endEllipsoidNormal,vertexBuffer:_,componentDatatype:u["a"].FLOAT,componentsPerAttribute:3},{index:Xe.startPositionAndHeight,vertexBuffer:f,componentDatatype:u["a"].FLOAT,componentsPerAttribute:4},{index:Xe.endPositionAndHeight,vertexBuffer:p,componentDatatype:u["a"].FLOAT,componentsPerAttribute:4},{index:Xe.startFaceNormalAndVertexCorner,vertexBuffer:m,componentDatatype:u["a"].FLOAT,componentsPerAttribute:4},{index:Xe.endFaceNormalAndHalfWidth,vertexBuffer:b,componentDatatype:u["a"].FLOAT,componentsPerAttribute:4},{index:Xe.a_batchId,vertexBuffer:g,componentDatatype:u["a"].UNSIGNED_SHORT,componentsPerAttribute:1}];e._va=new _e["a"]({context:t,attributes:O,indexBuffer:y}),e._positions=void 0,e._widths=void 0,e._counts=void 0,e._ellipsoid=void 0,e._minimumHeight=void 0,e._maximumHeight=void 0,e._rectangle=void 0,e._transferrableBatchIds=void 0,e._packedBuffer=void 0,e._startEllipsoidNormals=void 0,e._endEllipsoidNormals=void 0,e._startPositionAndHeights=void 0,e._startFaceNormalAndVertexCornerIds=void 0,e._endPositionAndHeights=void 0,e._endFaceNormalAndHalfWidths=void 0,e._vertexBatchIds=void 0,e._indices=void 0}}const Je=new d["a"],Qe=new n["a"];function $e(e,t){Object(o["a"])(e._uniformMap)||(e._uniformMap={u_modifiedModelView:function(){const i=t.uniformState.view;return d["a"].clone(i,Je),d["a"].multiplyByPoint(Je,e._center,Qe),d["a"].setTranslation(Je,Qe,Je),Je},u_highlightColor:function(){return e._highlightColor},u_minimumMaximumVectorHeights:function(){return e._minimumMaximumVectorHeights}})}function et(e){return le["a"].fromCache({cull:{enabled:!0,face:He["a"].FRONT},blending:me["a"].PRE_MULTIPLIED_ALPHA_BLEND,depthMask:!1,stencilTest:{enabled:e,frontFunction:Ve["a"].EQUAL,frontOperation:{fail:We["a"].KEEP,zFail:We["a"].KEEP,zPass:We["a"].KEEP},backFunction:Ve["a"].EQUAL,backOperation:{fail:We["a"].KEEP,zFail:We["a"].KEEP,zPass:We["a"].KEEP},reference:Ue["a"].CESIUM_3D_TILE_MASK,mask:Ue["a"].CESIUM_3D_TILE_MASK}})}function tt(e){Object(o["a"])(e._rs)||(e._rs=et(!1),e._rs3DTiles=et(!0))}function it(e,t){if(Object(o["a"])(e._sp))return;const i=e._batchTable,n=i.getVertexShaderCallback(!1,"a_batchId",void 0)(Me["a"]),a=i.getFragmentShaderCallback(!1,void 0,!0)(Re["a"]),s=new he["a"]({defines:["VECTOR_TILE",oe["a"].isInternetExplorer()?"":"CLIP_POLYLINE"],sources:[fe["a"],n]}),r=new he["a"]({defines:["VECTOR_TILE"],sources:[a]});e._sp=de["a"].fromCache({context:t,vertexShaderSource:s,fragmentShaderSource:r,attributeLocations:Xe})}function nt(e,t){let i=e._command;if(!Object(o["a"])(e._command)){const t=e._batchTable.getUniformMapCallback()(e._uniformMap);i=e._command=new ce["a"]({owner:e,vertexArray:e._va,renderState:e._rs,shaderProgram:e._sp,uniformMap:t,boundingVolume:e._boundingVolume,pass:ue["a"].TERRAIN_CLASSIFICATION,pickId:e._batchTable.getPickId()});const n=ce["a"].shallowClone(i,i.derivedCommands.tileset);n.renderState=e._rs3DTiles,n.pass=ue["a"].CESIUM_3D_TILE_CLASSIFICATION,i.derivedCommands.tileset=n}const n=e._classificationType;n!==Z["a"].TERRAIN&&n!==Z["a"].BOTH||t.commandList.push(i),n!==Z["a"].CESIUM_3D_TILE&&n!==Z["a"].BOTH||t.commandList.push(i.derivedCommands.tileset)}function at(e,t){const i=e._batchIds,n=i.length;for(let a=0;a<n;++a){const e=i[a],n=t[e];n.show=!0,n.color=b["a"].WHITE}}Ge.prototype.getPositions=function(e){return Be.getPolylinePositions(this,e)},Ge.prototype.createFeatures=function(e,t){const i=this._batchIds,n=i.length;for(let a=0;a<n;++a){const n=i[a];t[n]=new be["a"](e,n)}},Ge.prototype.applyDebugSettings=function(e,t){this._highlightColor=e?t:this._constantColor};const ot=new b["a"],st=b["a"].WHITE,rt=!0;function ct(e){return Fe["a"].initialize().then((function(){return ze(e,e._rectangle,e._ellipsoid),new Promise((function(t,i){e._update=function(e,n){const a=n.context,s=Ke(e,a);if($e(e,a),it(e,a),tt(e),e._ready){const t=n.passes;(t.render||t.pick)&&nt(e,n)}Object(o["a"])(s)&&s.then((function(){qe(e,a),t(e)})).catch((function(e){i(e)}))}}))}))}Ge.prototype.applyStyle=function(e,t){if(!Object(o["a"])(e))return void at(this,t);const i=this._batchIds,n=i.length;for(let a=0;a<n;++a){const n=i[a],s=t[n];s.color=Object(o["a"])(e.color)?e.color.evaluateColor(s,ot):st,s.show=Object(o["a"])(e.show)?e.show.evaluate(s):rt}},Ge.prototype.update=function(e){this._update(this,e)},Ge.prototype.isDestroyed=function(){return!1},Ge.prototype.destroy=function(){return this._va=this._va&&this._va.destroy(),this._sp=this._sp&&this._sp.destroy(),Object(s["a"])(this)};var ut=Ge,lt=i("713c");function dt(e,t,i,n,a){this._tileset=e,this._tile=t,this._resource=i,this._polygons=void 0,this._polylines=void 0,this._points=void 0,this._metadata=void 0,this._batchTable=void 0,this._features=void 0,this.featurePropertiesDirty=!1,this._group=void 0,bt(this,n,a)}function ht(e){return function(t,i){Object(o["a"])(e._polygons)&&e._polygons.updateCommands(t,i)}}function _t(e,t){let i,n,s,r;const c=Object(a["a"])(e.POLYGONS_LENGTH,0),u=Object(a["a"])(e.POLYLINES_LENGTH,0),l=Object(a["a"])(e.POINTS_LENGTH,0);if(c>0&&Object(o["a"])(e.POLYGON_BATCH_IDS)){const n=t.byteOffset+e.POLYGON_BATCH_IDS.byteOffset;i=new Uint16Array(t.buffer,n,c)}if(u>0&&Object(o["a"])(e.POLYLINE_BATCH_IDS)){const i=t.byteOffset+e.POLYLINE_BATCH_IDS.byteOffset;n=new Uint16Array(t.buffer,i,u)}if(l>0&&Object(o["a"])(e.POINT_BATCH_IDS)){const i=t.byteOffset+e.POINT_BATCH_IDS.byteOffset;s=new Uint16Array(t.buffer,i,l)}const d=Object(o["a"])(i)||Object(o["a"])(n)||Object(o["a"])(s),h=c>0&&!Object(o["a"])(i)||u>0&&!Object(o["a"])(n)||l>0&&!Object(o["a"])(s);if(d&&h)throw new _["a"]("If one group of batch ids is defined, then all batch ids must be defined.");const f=!Object(o["a"])(i)&&!Object(o["a"])(n)&&!Object(o["a"])(s);if(f){let e=0;if(!Object(o["a"])(i)&&c>0)for(i=new Uint16Array(c),r=0;r<c;++r)i[r]=e++;if(!Object(o["a"])(n)&&u>0)for(n=new Uint16Array(u),r=0;r<u;++r)n[r]=e++;if(!Object(o["a"])(s)&&l>0)for(s=new Uint16Array(l),r=0;r<l;++r)s[r]=e++}return{polygons:i,polylines:n,points:s}}Object.defineProperties(dt.prototype,{featuresLength:{get:function(){return Object(o["a"])(this._batchTable)?this._batchTable.featuresLength:0}},pointsLength:{get:function(){return Object(o["a"])(this._points)?this._points.pointsLength:0}},trianglesLength:{get:function(){let e=0;return Object(o["a"])(this._polygons)&&(e+=this._polygons.trianglesLength),Object(o["a"])(this._polylines)&&(e+=this._polylines.trianglesLength),e}},geometryByteLength:{get:function(){let e=0;return Object(o["a"])(this._polygons)&&(e+=this._polygons.geometryByteLength),Object(o["a"])(this._polylines)&&(e+=this._polylines.geometryByteLength),e}},texturesByteLength:{get:function(){return Object(o["a"])(this._points)?this._points.texturesByteLength:0}},batchTableByteLength:{get:function(){return Object(o["a"])(this._batchTable)?this._batchTable.batchTableByteLength:0}},innerContents:{get:function(){}},readyPromise:{get:function(){const e=Object(o["a"])(this._points)?this._points.readyPromise:void 0,t=Object(o["a"])(this._polygons)?this._polygons.readyPromise:void 0,i=Object(o["a"])(this._polylines)?this._polylines.readyPromise:void 0,n=this;return Promise.all([e,t,i]).then((function(){return n}))}},tileset:{get:function(){return this._tileset}},tile:{get:function(){return this._tile}},url:{get:function(){return this._resource.getUrlComponent(!0)}},metadata:{get:function(){return this._metadata},set:function(e){this._metadata=e}},batchTable:{get:function(){return this._batchTable}},group:{get:function(){return this._group},set:function(e){this._group=e}}});const ft=Uint32Array.BYTES_PER_ELEMENT;function pt(e){return new Be(e)}function mt(e){return new ut(e)}function bt(e,t,i){i=Object(a["a"])(i,0);const s=new Uint8Array(t),m=new DataView(t);i+=ft;const b=m.getUint32(i,!0);if(1!==b)throw new _["a"](`Only Vector tile version 1 is supported.  Version ${b} is not.`);i+=ft;const g=m.getUint32(i,!0);if(i+=ft,0===g)return Promise.resolve(e);const y=m.getUint32(i,!0);if(i+=ft,0===y)throw new _["a"]("Feature table must have a byte length greater than zero");const O=m.getUint32(i,!0);i+=ft;const v=m.getUint32(i,!0);i+=ft;const T=m.getUint32(i,!0);i+=ft;const I=m.getUint32(i,!0);i+=ft;const C=m.getUint32(i,!0);i+=ft;const S=m.getUint32(i,!0);i+=ft;const x=m.getUint32(i,!0);i+=ft;const w=Object(c["a"])(s,i,y);i+=y;const A=new Uint8Array(t,i,O);let P,E;i+=O,v>0&&(P=Object(c["a"])(s,i,v),i+=v,T>0&&(E=new Uint8Array(t,i,T),E=new Uint8Array(E),i+=T));const L=Object(a["a"])(w.POLYGONS_LENGTH,0),D=Object(a["a"])(w.POLYLINES_LENGTH,0),j=Object(a["a"])(w.POINTS_LENGTH,0),N=L+D+j,k=new f["a"](e,N,P,E,ht(e));if(e._batchTable=k,0===N)return;const B=new p["a"](w,A),F=B.getGlobalProperty("REGION");if(!Object(o["a"])(F))throw new _["a"]("Feature table global property: REGION must be defined");const M=h["a"].unpack(F),R=F[4],H=F[5],U=e._tile.computedTransform;let V=B.getGlobalProperty("RTC_CENTER",u["a"].FLOAT,3);Object(o["a"])(V)?(V=n["a"].unpack(V),d["a"].multiplyByPoint(U,V,V)):(V=h["a"].center(M),V.height=l["a"].lerp(R,H,.5),V=r["a"].WGS84.cartographicToCartesian(V));const W=_t(w,A);if(i+=(4-i%4)%4,L>0){B.featuresLength=L;const n=Object(a["a"])(B.getPropertyArray("POLYGON_COUNTS",u["a"].UNSIGNED_INT,1),B.getPropertyArray("POLYGON_COUNT",u["a"].UNSIGNED_INT,1));if(!Object(o["a"])(n))throw new _["a"]("Feature table property: POLYGON_COUNTS must be defined when POLYGONS_LENGTH is greater than 0");const s=Object(a["a"])(B.getPropertyArray("POLYGON_INDEX_COUNTS",u["a"].UNSIGNED_INT,1),B.getPropertyArray("POLYGON_INDEX_COUNT",u["a"].UNSIGNED_INT,1));if(!Object(o["a"])(s))throw new _["a"]("Feature table property: POLYGON_INDEX_COUNTS must be defined when POLYGONS_LENGTH is greater than 0");const r=n.reduce((function(e,t){return e+2*t}),0),c=s.reduce((function(e,t){return e+t}),0),l=new Uint32Array(t,i,c);i+=I;const d=new Uint16Array(t,i,r);let h,f;i+=C,Object(o["a"])(w.POLYGON_MINIMUM_HEIGHTS)&&Object(o["a"])(w.POLYGON_MAXIMUM_HEIGHTS)&&(h=B.getPropertyArray("POLYGON_MINIMUM_HEIGHTS",u["a"].FLOAT,1),f=B.getPropertyArray("POLYGON_MAXIMUM_HEIGHTS",u["a"].FLOAT,1)),e._polygons=new ae({positions:d,counts:n,indexCounts:s,indices:l,minimumHeight:R,maximumHeight:H,polygonMinimumHeights:h,polygonMaximumHeights:f,center:V,rectangle:M,boundingVolume:e.tile.boundingVolume.boundingVolume,batchTable:k,batchIds:W.polygons,modelMatrix:U})}if(D>0){B.featuresLength=D;const n=Object(a["a"])(B.getPropertyArray("POLYLINE_COUNTS",u["a"].UNSIGNED_INT,1),B.getPropertyArray("POLYLINE_COUNT",u["a"].UNSIGNED_INT,1));if(!Object(o["a"])(n))throw new _["a"]("Feature table property: POLYLINE_COUNTS must be defined when POLYLINES_LENGTH is greater than 0");let s=B.getPropertyArray("POLYLINE_WIDTHS",u["a"].UNSIGNED_SHORT,1);if(!Object(o["a"])(s)){s=new Uint16Array(D);for(let e=0;e<D;++e)s[e]=2}const c=n.reduce((function(e,t){return e+3*t}),0),l=new Uint16Array(t,i,c);i+=S;const d=e._tileset,h=d.examineVectorLinesFunction;if(Object(o["a"])(h)){const t=Object(lt["a"])(new Uint16Array(l),M,R,H,r["a"].WGS84);yt(t,n,W.polylines,k,e.url,h)}let f=pt;Object(o["a"])(d.classificationType)&&(f=mt),e._polylines=f({positions:l,widths:s,counts:n,batchIds:W.polylines,minimumHeight:R,maximumHeight:H,center:V,rectangle:M,boundingVolume:e.tile.boundingVolume.boundingVolume,batchTable:k,classificationType:d.classificationType,keepDecodedPositions:d.vectorKeepDecodedPositions})}if(j>0){const n=new Uint16Array(t,i,3*j);i+=x,e._points=new G({positions:n,batchIds:W.points,minimumHeight:R,maximumHeight:H,rectangle:M,batchTable:k})}return Promise.resolve(e)}function gt(e){const t=e.featuresLength;if(!Object(o["a"])(e._features)&&t>0){const i=new Array(t);Object(o["a"])(e._polygons)&&e._polygons.createFeatures(e,i),Object(o["a"])(e._polylines)&&e._polylines.createFeatures(e,i),Object(o["a"])(e._points)&&e._points.createFeatures(e,i),e._features=i}}function yt(e,t,i,n,a,o){const s=t.length;let r=0;for(let c=0;c<s;c++){const s=3*t[c],u=e.slice(r,r+s);r+=s,o(u,i[c],a,n)}}dt.prototype.hasProperty=function(e,t){return this._batchTable.hasProperty(e,t)},dt.prototype.getFeature=function(e){return gt(this),this._features[e]},dt.prototype.applyDebugSettings=function(e,t){Object(o["a"])(this._polygons)&&this._polygons.applyDebugSettings(e,t),Object(o["a"])(this._polylines)&&this._polylines.applyDebugSettings(e,t),Object(o["a"])(this._points)&&this._points.applyDebugSettings(e,t)},dt.prototype.applyStyle=function(e){gt(this),Object(o["a"])(this._polygons)&&this._polygons.applyStyle(e,this._features),Object(o["a"])(this._polylines)&&this._polylines.applyStyle(e,this._features),Object(o["a"])(this._points)&&this._points.applyStyle(e,this._features)},dt.prototype.update=function(e,t){let i=!0;Object(o["a"])(this._polygons)&&(this._polygons.classificationType=this._tileset.classificationType,this._polygons.debugWireframe=this._tileset.debugWireframe,this._polygons.update(t),i=i&&this._polygons._ready),Object(o["a"])(this._polylines)&&(this._polylines.update(t),i=i&&this._polylines._ready),Object(o["a"])(this._points)&&(this._points.update(t),i=i&&this._points._ready),Object(o["a"])(this._batchTable)&&i&&this._batchTable.update(e,t)},dt.prototype.getPolylinePositions=function(e){const t=this._polylines;if(Object(o["a"])(t))return t.getPositions(e)},dt.prototype.isDestroyed=function(){return!1},dt.prototype.destroy=function(){return this._polygons=this._polygons&&this._polygons.destroy(),this._polylines=this._polylines&&this._polylines.destroy(),this._points=this._points&&this._points.destroy(),this._batchTable=this._batchTable&&this._batchTable.destroy(),Object(s["a"])(this)};t["a"]=dt},"51a0":function(e,t,i){"use strict";var n=i("cef5"),a=i("be18"),o=i("bd8d"),s=i("535a"),r=i("2f63"),c=i("7d62"),u=i("52f0"),l=i("6a29"),d=i("5a6c"),h=i("d8f6"),_=i("27aa");function f(e){this._boxes=e.boxes,this._boxBatchIds=e.boxBatchIds,this._cylinders=e.cylinders,this._cylinderBatchIds=e.cylinderBatchIds,this._ellipsoids=e.ellipsoids,this._ellipsoidBatchIds=e.ellipsoidBatchIds,this._spheres=e.spheres,this._sphereBatchIds=e.sphereBatchIds,this._modelMatrix=e.modelMatrix,this._batchTable=e.batchTable,this._boundingVolume=e.boundingVolume,this._center=e.center,Object(r["a"])(this._center)||(Object(r["a"])(this._boundingVolume)?this._center=a["a"].clone(this._boundingVolume.center):this._center=a["a"].clone(a["a"].ZERO)),this._boundingVolumes=void 0,this._batchedIndices=void 0,this._indices=void 0,this._indexOffsets=void 0,this._indexCounts=void 0,this._positions=void 0,this._vertexBatchIds=void 0,this._batchIds=void 0,this._batchTableColors=void 0,this._packedBuffer=void 0,this._ready=!1,this._update=function(e,t){},this._readyPromise=v(this),this._verticesPromise=void 0,this._primitive=void 0,this.debugWireframe=!1,this.forceRebatch=!1,this.classificationType=d["a"].BOTH}function p(e){const t=new Float64Array(u["a"].packedLength+a["a"].packedLength);let i=0;return a["a"].pack(e._center,t,i),i+=a["a"].packedLength,u["a"].pack(e._modelMatrix,t,i),t}function m(e,t){let i=0;const a=t[i++],s=t[i++],r=e._boundingVolumes=new Array(s);for(let o=0;o<s;++o)r[o]=n["a"].unpack(t,i),i+=n["a"].packedLength;const c=t[i++],u=e._batchedIndices=new Array(c);for(let n=0;n<c;++n){const e=o["a"].unpack(t,i);i+=o["a"].packedLength;const a=t[i++],s=t[i++],r=t[i++],c=new Array(r);for(let n=0;n<r;++n)c[n]=t[i++];u[n]=new h["a"]({color:e,offset:a,count:s,batchIds:c})}return a}Object.defineProperties(f.prototype,{trianglesLength:{get:function(){return Object(r["a"])(this._primitive)?this._primitive.trianglesLength:0}},geometryByteLength:{get:function(){return Object(r["a"])(this._primitive)?this._primitive.geometryByteLength:0}},readyPromise:{get:function(){return this._readyPromise}}}),f.packedBoxLength=u["a"].packedLength+a["a"].packedLength,f.packedCylinderLength=u["a"].packedLength+2,f.packedEllipsoidLength=u["a"].packedLength+a["a"].packedLength,f.packedSphereLength=a["a"].packedLength+1;const b=new l["a"]("createVectorTileGeometries",5),g=new o["a"];function y(e){if(!Object(r["a"])(e._primitive)&&!Object(r["a"])(e._verticesPromise)){let t=e._boxes,i=e._boxBatchIds,n=e._cylinders,a=e._cylinderBatchIds,o=e._ellipsoids,s=e._ellipsoidBatchIds,c=e._spheres,u=e._sphereBatchIds,l=e._batchTableColors,d=e._packedBuffer;if(!Object(r["a"])(l)){let h=0;Object(r["a"])(e._boxes)&&(t=e._boxes=t.slice(),i=e._boxBatchIds=i.slice(),h+=i.length),Object(r["a"])(e._cylinders)&&(n=e._cylinders=n.slice(),a=e._cylinderBatchIds=a.slice(),h+=a.length),Object(r["a"])(e._ellipsoids)&&(o=e._ellipsoids=o.slice(),s=e._ellipsoidBatchIds=s.slice(),h+=s.length),Object(r["a"])(e._spheres)&&(c=e._sphere=c.slice(),u=e._sphereBatchIds=u.slice(),h+=u.length),l=e._batchTableColors=new Uint32Array(h);const _=e._batchTable;for(let e=0;e<h;++e){const t=_.getColor(e,g);l[e]=t.toRgba()}d=e._packedBuffer=p(e)}const h=[];Object(r["a"])(t)&&h.push(t.buffer,i.buffer),Object(r["a"])(n)&&h.push(n.buffer,a.buffer),Object(r["a"])(o)&&h.push(o.buffer,s.buffer),Object(r["a"])(c)&&h.push(c.buffer,u.buffer),h.push(l.buffer,d.buffer);const _={boxes:Object(r["a"])(t)?t.buffer:void 0,boxBatchIds:Object(r["a"])(t)?i.buffer:void 0,cylinders:Object(r["a"])(n)?n.buffer:void 0,cylinderBatchIds:Object(r["a"])(n)?a.buffer:void 0,ellipsoids:Object(r["a"])(o)?o.buffer:void 0,ellipsoidBatchIds:Object(r["a"])(o)?s.buffer:void 0,spheres:Object(r["a"])(c)?c.buffer:void 0,sphereBatchIds:Object(r["a"])(c)?u.buffer:void 0,batchTableColors:l.buffer,packedBuffer:d.buffer},f=e._verticesPromise=b.scheduleTask(_,h);if(!Object(r["a"])(f))return;return f.then((function(t){const i=new Float64Array(t.packedBuffer),n=m(e,i);e._indices=2===n?new Uint16Array(t.indices):new Uint32Array(t.indices),e._indexOffsets=new Uint32Array(t.indexOffsets),e._indexCounts=new Uint32Array(t.indexCounts),e._positions=new Float32Array(t.positions),e._vertexBatchIds=new Uint16Array(t.vertexBatchIds),e._batchIds=new Uint16Array(t.batchIds),e._ready=!0}))}}function O(e){e._ready&&!Object(r["a"])(e._primitive)&&(e._primitive=new _["a"]({batchTable:e._batchTable,positions:e._positions,batchIds:e._batchIds,vertexBatchIds:e._vertexBatchIds,indices:e._indices,indexOffsets:e._indexOffsets,indexCounts:e._indexCounts,batchedIndices:e._batchedIndices,boundingVolume:e._boundingVolume,boundingVolumes:e._boundingVolumes,center:e._center,pickObject:Object(s["a"])(e._pickObject,e)}),e._boxes=void 0,e._boxBatchIds=void 0,e._cylinders=void 0,e._cylinderBatchIds=void 0,e._ellipsoids=void 0,e._ellipsoidBatchIds=void 0,e._spheres=void 0,e._sphereBatchIds=void 0,e._center=void 0,e._modelMatrix=void 0,e._batchTable=void 0,e._boundingVolume=void 0,e._boundingVolumes=void 0,e._batchedIndices=void 0,e._indices=void 0,e._indexOffsets=void 0,e._indexCounts=void 0,e._positions=void 0,e._vertexBatchIds=void 0,e._batchIds=void 0,e._batchTableColors=void 0,e._packedBuffer=void 0,e._verticesPromise=void 0)}function v(e){return new Promise((function(t,i){e._update=function(e,n){const a=y(e);e._ready&&(e._primitive.debugWireframe=e.debugWireframe,e._primitive.forceRebatch=e.forceRebatch,e._primitive.classificationType=e.classificationType,e._primitive.update(n)),Object(r["a"])(a)&&a.then((function(){O(e),t(e)})).catch((function(e){i(e)}))}}))}f.prototype.createFeatures=function(e,t){this._primitive.createFeatures(e,t)},f.prototype.applyDebugSettings=function(e,t){this._primitive.applyDebugSettings(e,t)},f.prototype.applyStyle=function(e,t){this._primitive.applyStyle(e,t)},f.prototype.updateCommands=function(e,t){this._primitive.updateCommands(e,t)},f.prototype.update=function(e){this._update(this,e)},f.prototype.isDestroyed=function(){return!1},f.prototype.destroy=function(){return this._primitive=this._primitive&&this._primitive.destroy(),Object(c["a"])(this)},t["a"]=f},"619f":function(e,t,i){"use strict";var n=i("dc1c"),a=i("535a"),o=i("2f63"),s=i("55f9"),r=i("ddf7"),c=i("dd17"),u=i("3911"),l=i.n(u);function d(e,t,i,a,o,s,r,c,u,l){this._tweens=e,this._tweenjs=t,this._startObject=Object(n["a"])(i),this._stopObject=Object(n["a"])(a),this._duration=o,this._delay=s,this._easingFunction=r,this._update=c,this._complete=u,this.cancel=l,this.needsStart=!0}function h(){this._tweens=[]}Object.defineProperties(d.prototype,{startObject:{get:function(){return this._startObject}},stopObject:{get:function(){return this._stopObject}},duration:{get:function(){return this._duration}},delay:{get:function(){return this._delay}},easingFunction:{get:function(){return this._easingFunction}},update:{get:function(){return this._update}},complete:{get:function(){return this._complete}},tweenjs:{get:function(){return this._tweenjs}}}),d.prototype.cancelTween=function(){this._tweens.remove(this)},Object.defineProperties(h.prototype,{length:{get:function(){return this._tweens.length}}}),h.prototype.add=function(e){if(e=Object(a["a"])(e,a["a"].EMPTY_OBJECT),0===e.duration)return Object(o["a"])(e.complete)&&e.complete(),new d(this);const t=e.duration/c["a"].SECONDS_PER_MILLISECOND,i=Object(a["a"])(e.delay,0),r=i/c["a"].SECONDS_PER_MILLISECOND,u=Object(a["a"])(e.easingFunction,s["a"].LINEAR_NONE),h=e.startObject,_=new l.a.Tween(h);_.to(Object(n["a"])(e.stopObject),t),_.delay(r),_.easing(u),Object(o["a"])(e.update)&&_.onUpdate((function(){e.update(h)})),_.onComplete(Object(a["a"])(e.complete,null)),_.repeat(Object(a["a"])(e._repeat,0));const f=new d(this,_,e.startObject,e.stopObject,e.duration,i,u,e.update,e.complete,e.cancel);return this._tweens.push(f),f},h.prototype.addProperty=function(e){e=Object(a["a"])(e,a["a"].EMPTY_OBJECT);const t=e.object,i=e.property,n=e.startValue,o=e.stopValue;function s(e){t[i]=e.value}return this.add({startObject:{value:n},stopObject:{value:o},duration:Object(a["a"])(e.duration,3),delay:e.delay,easingFunction:e.easingFunction,update:s,complete:e.complete,cancel:e.cancel,_repeat:e._repeat})},h.prototype.addAlpha=function(e){e=Object(a["a"])(e,a["a"].EMPTY_OBJECT);const t=e.material,i=[];for(const a in t.uniforms)t.uniforms.hasOwnProperty(a)&&Object(o["a"])(t.uniforms[a])&&Object(o["a"])(t.uniforms[a].alpha)&&i.push(a);function n(e){const n=i.length;for(let a=0;a<n;++a)t.uniforms[i[a]].alpha=e.alpha}return this.add({startObject:{alpha:Object(a["a"])(e.startValue,0)},stopObject:{alpha:Object(a["a"])(e.stopValue,1)},duration:Object(a["a"])(e.duration,3),delay:e.delay,easingFunction:e.easingFunction,update:n,complete:e.complete,cancel:e.cancel})},h.prototype.addOffsetIncrement=function(e){e=Object(a["a"])(e,a["a"].EMPTY_OBJECT);const t=e.material,i=t.uniforms;return this.addProperty({object:i,property:"offset",startValue:i.offset,stopValue:i.offset+1,duration:e.duration,delay:e.delay,easingFunction:e.easingFunction,update:e.update,cancel:e.cancel,_repeat:1/0})},h.prototype.remove=function(e){if(!Object(o["a"])(e))return!1;const t=this._tweens.indexOf(e);return-1!==t&&(e.tweenjs.stop(),Object(o["a"])(e.cancel)&&e.cancel(),this._tweens.splice(t,1),!0)},h.prototype.removeAll=function(){const e=this._tweens;for(let t=0;t<e.length;++t){const i=e[t];i.tweenjs.stop(),Object(o["a"])(i.cancel)&&i.cancel()}e.length=0},h.prototype.contains=function(e){return Object(o["a"])(e)&&-1!==this._tweens.indexOf(e)},h.prototype.get=function(e){return this._tweens[e]},h.prototype.update=function(e){const t=this._tweens;let i=0;e=Object(o["a"])(e)?e/c["a"].SECONDS_PER_MILLISECOND:Object(r["a"])();while(i<t.length){const n=t[i],a=n.tweenjs;n.needsStart?(n.needsStart=!1,a.start(e)):a.update(e)?i++:(a.stop(),t.splice(i,1))}},t["a"]=h},a141:function(e,t,i){"use strict";var n=i("2f63");const a={POSITION:"POSITION",NORMAL:"NORMAL",TANGENT:"TANGENT",TEXCOORD:"TEXCOORD",COLOR:"COLOR",JOINTS:"JOINTS",WEIGHTS:"WEIGHTS",FEATURE_ID:"_FEATURE_ID"};function o(e){switch(e){case a.POSITION:return"positionMC";case a.NORMAL:return"normalMC";case a.TANGENT:return"tangentMC";case a.TEXCOORD:return"texCoord";case a.COLOR:return"color";case a.JOINTS:return"joints";case a.WEIGHTS:return"weights";case a.FEATURE_ID:return"featureId"}}a.hasSetIndex=function(e){switch(e){case a.POSITION:case a.NORMAL:case a.TANGENT:return!1;case a.TEXCOORD:case a.COLOR:case a.JOINTS:case a.WEIGHTS:case a.FEATURE_ID:return!0}},a.fromGltfSemantic=function(e){let t=e;const i=/^(\w+)_\d+$/,n=i.exec(e);switch(null!==n&&(t=n[1]),t){case"POSITION":return a.POSITION;case"NORMAL":return a.NORMAL;case"TANGENT":return a.TANGENT;case"TEXCOORD":return a.TEXCOORD;case"COLOR":return a.COLOR;case"JOINTS":return a.JOINTS;case"WEIGHTS":return a.WEIGHTS;case"_FEATURE_ID":return a.FEATURE_ID}},a.fromPntsSemantic=function(e){switch(e){case"POSITION":case"POSITION_QUANTIZED":return a.POSITION;case"RGBA":case"RGB":case"RGB565":return a.COLOR;case"NORMAL":case"NORMAL_OCT16P":return a.NORMAL;case"BATCH_ID":return a.FEATURE_ID}},a.getGlslType=function(e){switch(e){case a.POSITION:case a.NORMAL:case a.TANGENT:return"vec3";case a.TEXCOORD:return"vec2";case a.COLOR:return"vec4";case a.JOINTS:return"ivec4";case a.WEIGHTS:return"vec4";case a.FEATURE_ID:return"int"}},a.getVariableName=function(e,t){let i=o(e);return Object(n["a"])(t)&&(i+="_"+t),i},t["a"]=Object.freeze(a)},d8f6:function(e,t,i){"use strict";function n(e){this.offset=e.offset,this.count=e.count,this.color=e.color,this.batchIds=e.batchIds}t["a"]=n},e288:function(e,t,i){"use strict";var n=i("670c"),a=i("be18"),o=i("bef8"),s=i("2bb9"),r=i("8dfe"),c=i("535a"),u=i("2f63"),l=i("21d7"),d=i("3d7f"),h=i("93da"),_=i("eace"),f=i("d4ed"),p=i("d3a0"),m=i("64ac");const b=/{[^}]+}/g,g={x:L,y:j,z:B,s:F,reverseX:D,reverseY:N,reverseZ:k,westDegrees:R,southDegrees:H,eastDegrees:U,northDegrees:V,westProjected:G,southProjected:z,eastProjected:Y,northProjected:Z,width:X,height:K},y=Object(s["a"])(g,{i:q,j:J,reverseI:Q,reverseJ:$,longitudeDegrees:ne,latitudeDegrees:ae,longitudeProjected:oe,latitudeProjected:se,format:ue});function O(e){this._errorEvent=new l["a"],this._resource=void 0,this._urlSchemeZeroPadding=void 0,this._pickFeaturesResource=void 0,this._tileWidth=void 0,this._tileHeight=void 0,this._maximumLevel=void 0,this._minimumLevel=void 0,this._tilingScheme=void 0,this._rectangle=void 0,this._tileDiscardPolicy=void 0,this._credit=void 0,this._hasAlphaChannel=void 0,this._readyPromise=void 0,this._tags=void 0,this._pickFeaturesTags=void 0,this.defaultAlpha=void 0,this.defaultNightAlpha=void 0,this.defaultDayAlpha=void 0,this.defaultBrightness=void 0,this.defaultContrast=void 0,this.defaultHue=void 0,this.defaultSaturation=void 0,this.defaultGamma=void 0,this.defaultMinificationFilter=void 0,this.defaultMagnificationFilter=void 0,this.enablePickFeatures=!0,this.reinitialize(e)}Object.defineProperties(O.prototype,{url:{get:function(){return this._resource.url}},urlSchemeZeroPadding:{get:function(){return this._urlSchemeZeroPadding}},pickFeaturesUrl:{get:function(){return this._pickFeaturesResource.url}},proxy:{get:function(){return this._resource.proxy}},tileWidth:{get:function(){return this._tileWidth}},tileHeight:{get:function(){return this._tileHeight}},maximumLevel:{get:function(){return this._maximumLevel}},minimumLevel:{get:function(){return this._minimumLevel}},tilingScheme:{get:function(){return this._tilingScheme}},rectangle:{get:function(){return this._rectangle}},tileDiscardPolicy:{get:function(){return this._tileDiscardPolicy}},errorEvent:{get:function(){return this._errorEvent}},ready:{get:function(){return Object(u["a"])(this._resource)}},readyPromise:{get:function(){return this._readyPromise}},credit:{get:function(){return this._credit}},hasAlphaChannel:{get:function(){return this._hasAlphaChannel}}}),O.prototype.reinitialize=function(e){const t=this;t._readyPromise=Promise.resolve(e).then((function(e){const i=e.customTags,n=Object(s["a"])(g,i),a=Object(s["a"])(y,i),o=f["a"].createIfNeeded(e.url),l=f["a"].createIfNeeded(e.pickFeaturesUrl);t.enablePickFeatures=Object(c["a"])(e.enablePickFeatures,t.enablePickFeatures),t._urlSchemeZeroPadding=Object(c["a"])(e.urlSchemeZeroPadding,t.urlSchemeZeroPadding),t._tileDiscardPolicy=e.tileDiscardPolicy,t._getFeatureInfoFormats=e.getFeatureInfoFormats,t._subdomains=e.subdomains,Array.isArray(t._subdomains)?t._subdomains=t._subdomains.slice():Object(u["a"])(t._subdomains)&&t._subdomains.length>0?t._subdomains=t._subdomains.split(""):t._subdomains=["a","b","c"],t._tileWidth=Object(c["a"])(e.tileWidth,256),t._tileHeight=Object(c["a"])(e.tileHeight,256),t._minimumLevel=Object(c["a"])(e.minimumLevel,0),t._maximumLevel=e.maximumLevel,t._tilingScheme=Object(c["a"])(e.tilingScheme,new p["a"]({ellipsoid:e.ellipsoid})),t._rectangle=Object(c["a"])(e.rectangle,t._tilingScheme.rectangle),t._rectangle=_["a"].intersection(t._rectangle,t._tilingScheme.rectangle),t._hasAlphaChannel=Object(c["a"])(e.hasAlphaChannel,!0);let d=e.credit;return"string"===typeof d&&(d=new r["a"](d)),t._credit=d,t._resource=o,t._tags=n,t._pickFeaturesResource=l,t._pickFeaturesTags=a,!0}))},O.prototype.getTileCredits=function(e,t,i){},O.prototype.requestImage=function(e,t,i,n){return m["a"].loadImage(this,S(this,e,t,i,n))},O.prototype.pickFeatures=function(e,t,i,n,a){if(!this.enablePickFeatures||!Object(u["a"])(this._pickFeaturesResource)||0===this._getFeatureInfoFormats.length)return;let o=0;const s=this;function r(e,t){return e.callback(t)}function c(){if(o>=s._getFeatureInfoFormats.length)return Promise.resolve([]);const u=s._getFeatureInfoFormats[o],l=P(s,e,t,i,n,a,u.format);return++o,"json"===u.type?l.fetchJson().then(u.callback).catch(c):"xml"===u.type?l.fetchXML().then(u.callback).catch(c):"text"===u.type||"html"===u.type?l.fetchText().then(u.callback).catch(c):l.fetch({responseType:u.format}).then(r.bind(void 0,u)).catch(c)}return c()};let v=!1;const T=new _["a"];let I=!1;const C=new _["a"];function S(e,t,i,n,a){v=!1,I=!1;const o=e._resource,s=o.getUrlComponent(!0),r=e._tags,c={},l=s.match(b);return Object(u["a"])(l)&&l.forEach((function(a){const o=a.substring(1,a.length-1);Object(u["a"])(r[o])&&(c[o]=r[o](e,t,i,n))})),o.getDerivedResource({request:a,templateValues:c})}let x=!1;const w=new n["a"];let A=!1;function P(e,t,i,n,a,o,s){v=!1,I=!1,x=!1,A=!1;const r=e._pickFeaturesResource,c=r.getUrlComponent(!0),l=e._pickFeaturesTags,d={},h=c.match(b);return Object(u["a"])(h)&&h.forEach((function(r){const c=r.substring(1,r.length-1);Object(u["a"])(l[c])&&(d[c]=l[c](e,t,i,n,a,o,s))})),r.getDerivedResource({templateValues:d})}function E(e,t,i){if(e&&e.urlSchemeZeroPadding&&e.urlSchemeZeroPadding.hasOwnProperty(t)){const n=e.urlSchemeZeroPadding[t];if("string"===typeof n){const e=n.length;e>1&&(i=i.length>=e?i:new Array(e-i.toString().length+1).join("0")+i)}}return i}function L(e,t,i,n){return E(e,"{x}",t)}function D(e,t,i,n){const a=e.tilingScheme.getNumberOfXTilesAtLevel(n)-t-1;return E(e,"{reverseX}",a)}function j(e,t,i,n){return E(e,"{y}",i)}function N(e,t,i,n){const a=e.tilingScheme.getNumberOfYTilesAtLevel(n)-i-1;return E(e,"{reverseY}",a)}function k(e,t,i,n){const a=e.maximumLevel,o=Object(u["a"])(a)&&n<a?a-n-1:n;return E(e,"{reverseZ}",o)}function B(e,t,i,n){return E(e,"{z}",n)}function F(e,t,i,n){const a=(t+i+n)%e._subdomains.length;return e._subdomains[a]}function M(e,t,i,n){v||(e.tilingScheme.tileXYToRectangle(t,i,n,T),T.west=h["a"].toDegrees(T.west),T.south=h["a"].toDegrees(T.south),T.east=h["a"].toDegrees(T.east),T.north=h["a"].toDegrees(T.north),v=!0)}function R(e,t,i,n){return M(e,t,i,n),T.west}function H(e,t,i,n){return M(e,t,i,n),T.south}function U(e,t,i,n){return M(e,t,i,n),T.east}function V(e,t,i,n){return M(e,t,i,n),T.north}function W(e,t,i,n){I||(e.tilingScheme.tileXYToNativeRectangle(t,i,n,C),I=!0)}function G(e,t,i,n){return W(e,t,i,n),C.west}function z(e,t,i,n){return W(e,t,i,n),C.south}function Y(e,t,i,n){return W(e,t,i,n),C.east}function Z(e,t,i,n){return W(e,t,i,n),C.north}function X(e,t,i,n){return e.tileWidth}function K(e,t,i,n){return e.tileHeight}function q(e,t,i,n,a,o,s){return ie(e,t,i,n,a,o),w.x}function J(e,t,i,n,a,o,s){return ie(e,t,i,n,a,o),w.y}function Q(e,t,i,n,a,o,s){return ie(e,t,i,n,a,o),e.tileWidth-w.x-1}function $(e,t,i,n,a,o,s){return ie(e,t,i,n,a,o),e.tileHeight-w.y-1}const ee=new _["a"],te=new a["a"];function ie(e,t,i,n,a,o,s){if(x)return;ce(e,t,i,n,a,o);const r=te,c=e.tilingScheme.tileXYToNativeRectangle(t,i,n,ee);w.x=e.tileWidth*(r.x-c.west)/c.width|0,w.y=e.tileHeight*(c.north-r.y)/c.height|0,x=!0}function ne(e,t,i,n,a,o,s){return h["a"].toDegrees(a)}function ae(e,t,i,n,a,o,s){return h["a"].toDegrees(o)}function oe(e,t,i,n,a,o,s){return ce(e,t,i,n,a,o),te.x}function se(e,t,i,n,a,o,s){return ce(e,t,i,n,a,o),te.y}const re=new o["a"];function ce(e,t,i,n,a,o,s){if(!A){if(e.tilingScheme.projection instanceof d["a"])te.x=h["a"].toDegrees(a),te.y=h["a"].toDegrees(o);else{const t=re;t.longitude=a,t.latitude=o,e.tilingScheme.projection.project(t,te)}A=!0}}function ue(e,t,i,n,a,o,s){return s}t["a"]=O},ef77:function(e,t,i){"use strict";var n=i("77af"),a=i("be18"),o=i("2384"),s=i("2f63"),r=i("ddf7"),c=i("017a"),u=i("93da"),l=i("52f0"),d=i("f845"),h=i("d289"),_=i("00f8"),f=i("9dbf"),p=i("5e59"),m=i("6f08"),b=i("8004"),g=i("dd7f"),y=i("8773"),O=i("e0bc"),v=i("7fe1"),T=i("a307"),I=i("569f"),C=i("bd8d"),S=i("7d62"),x=i("e42d"),w=i("a894"),A=i("f630"),P=i("6ef5"),E=i("6dc0"),L=i("6c84"),D=i("5770"),j=i("a913"),N=i("e1f5"),k=i("6bd8"),B=i("b7c8"),F=i("3626"),M=i("6102");const R=!1;function H(e){this._drawClassificationFBO=new A["a"]({createDepthAttachments:!1}),this._accumulationFBO=new A["a"]({createDepthAttachments:!1}),this._packFBO=new A["a"],this._opaqueDepthStencilTexture=void 0,this._textureToComposite=void 0,this._translucentDepthStencilTexture=void 0,this._packDepthCommand=void 0,this._accumulateCommand=void 0,this._compositeCommand=void 0,this._copyCommand=void 0,this._clearColorCommand=new d["a"]({color:new C["a"](0,0,0,0),owner:this}),this._clearDepthStencilCommand=new d["a"]({depth:1,stencil:0,owner:this}),this._supported=e.depthTexture,this._viewport=new n["a"],this._rsDepth=void 0,this._rsAccumulate=void 0,this._rsComp=void 0,this._useScissorTest=void 0,this._scissorRectangle=void 0,this._hasTranslucentDepth=!1,this._frustumsDrawn=0}function U(e){e._textureToComposite=void 0,e._translucentDepthStencilTexture=e._translucentDepthStencilTexture&&!e._translucentDepthStencilTexture.isDestroyed()&&e._translucentDepthStencilTexture.destroy()}function V(e){e._drawClassificationFBO.destroy(),e._accumulationFBO.destroy(),e._packFBO.destroy()}function W(e,t,i,n){U(e),e._translucentDepthStencilTexture=new j["a"]({context:t,width:i,height:n,pixelFormat:x["a"].DEPTH_STENCIL,pixelDatatype:P["a"].UNSIGNED_INT_24_8,sampler:L["a"].NEAREST})}function G(e,t,i,n){V(e),e._drawClassificationFBO.setDepthStencilTexture(e._translucentDepthStencilTexture),e._drawClassificationFBO.update(t,i,n),e._accumulationFBO.setDepthStencilTexture(e._translucentDepthStencilTexture),e._accumulationFBO.update(t,i,n),e._packFBO.update(t,i,n)}function z(e,t,i,a){if(!e.isSupported())return;e._opaqueDepthStencilTexture=a;const o=e._opaqueDepthStencilTexture.width,r=e._opaqueDepthStencilTexture.height;let c,u;if(e._drawClassificationFBO.isDirty(o,r)&&(W(e,t,o,r),G(e,t,o,r)),Object(s["a"])(e._packDepthCommand)||(c=new D["a"]({sources:[N["a"]]}),u={u_opaqueDepthTexture:function(){return e._opaqueDepthStencilTexture},u_translucentDepthTexture:function(){return e._translucentDepthStencilTexture}},e._packDepthCommand=t.createViewportQuadCommand(c,{uniformMap:u,owner:e})),!Object(s["a"])(e._compositeCommand)){c=new D["a"]({sources:[k["a"]]}),u={colorTexture:function(){return e._textureToComposite}},R&&(c.defines=["DEBUG_SHOW_DEPTH"],u.u_packedTranslucentDepth=function(){return e._packFBO.getColorTexture()}),e._compositeCommand=t.createViewportQuadCommand(c,{uniformMap:u,owner:e});const i=e._compositeCommand,n=i.shaderProgram,a=t.shaderCache.createDerivedShaderProgram(n,"pick",{vertexShaderSource:n.vertexShaderSource,fragmentShaderSource:new D["a"]({sources:c.sources,defines:["PICK"]}),attributeLocations:n._attributeLocations}),o=w["a"].shallowClone(i);o.shaderProgram=a,i.derivedCommands.pick=o}Object(s["a"])(e._copyCommand)||(c=new D["a"]({sources:[k["a"]]}),u={colorTexture:function(){return e._drawClassificationFBO.getColorTexture()}},e._copyCommand=t.createViewportQuadCommand(c,{uniformMap:u,owner:e})),Object(s["a"])(e._accumulateCommand)||(c=new D["a"]({sources:[k["a"]]}),u={colorTexture:function(){return e._drawClassificationFBO.getColorTexture()}},e._accumulateCommand=t.createViewportQuadCommand(c,{uniformMap:u,owner:e})),e._viewport.width=o,e._viewport.height=r;const l=!n["a"].equals(e._viewport,i.viewport);let d=l!==e._useScissorTest;e._useScissorTest=l,n["a"].equals(e._scissorRectangle,i.viewport)||(e._scissorRectangle=n["a"].clone(i.viewport,e._scissorRectangle),d=!0),Object(s["a"])(e._rsDepth)&&n["a"].equals(e._viewport,e._rsDepth.viewport)&&!d||(e._rsDepth=E["a"].fromCache({viewport:e._viewport,scissorTest:{enabled:e._useScissorTest,rectangle:e._scissorRectangle}})),Object(s["a"])(e._packDepthCommand)&&(e._packDepthCommand.renderState=e._rsDepth),Object(s["a"])(e._rsAccumulate)&&n["a"].equals(e._viewport,e._rsAccumulate.viewport)&&!d||(e._rsAccumulate=E["a"].fromCache({viewport:e._viewport,scissorTest:{enabled:e._useScissorTest,rectangle:e._scissorRectangle},stencilTest:{enabled:!0,frontFunction:M["a"].EQUAL,reference:F["a"].CESIUM_3D_TILE_MASK}})),Object(s["a"])(e._accumulateCommand)&&(e._accumulateCommand.renderState=e._rsAccumulate),Object(s["a"])(e._rsComp)&&n["a"].equals(e._viewport,e._rsComp.viewport)&&!d||(e._rsComp=E["a"].fromCache({viewport:e._viewport,scissorTest:{enabled:e._useScissorTest,rectangle:e._scissorRectangle},blending:B["a"].ALPHA_BLEND})),Object(s["a"])(e._compositeCommand)&&(e._compositeCommand.renderState=e._rsComp,e._compositeCommand.derivedCommands.pick.renderState=e._rsComp)}function Y(e,t,i){if(!e._hasTranslucentDepth)return;const n=i.framebuffer;i.framebuffer=e._drawClassificationFBO.framebuffer,e._clearColorCommand.execute(t._context,i),i.framebuffer=n,e._frustumsDrawn>1&&(i.framebuffer=e._accumulationFBO.framebuffer,e._clearColorCommand.execute(t._context,i)),e._hasTranslucentDepth=!1,e._frustumsDrawn=0}Object.defineProperties(H.prototype,{hasTranslucentDepth:{get:function(){return this._hasTranslucentDepth}}}),H.prototype.executeTranslucentCommands=function(e,t,i,n,a){const o=n.length;let s,r;const c=e.frameState.useLogDepth,u=e.context,l=i.framebuffer;for(r=0;r<o;++r)if(s=n[r],s=c?s.derivedCommands.logDepth.command:s,s.depthForTranslucentClassification){this._hasTranslucentDepth=!0;break}if(this._hasTranslucentDepth){for(z(this,u,i,a),i.framebuffer=this._drawClassificationFBO.framebuffer,this._clearDepthStencilCommand.execute(u,i),r=0;r<o;++r){if(s=n[r],s=c?s.derivedCommands.logDepth.command:s,!s.depthForTranslucentClassification)continue;const a=s.derivedCommands.depth.depthOnlyCommand;t(a,e,u,i)}this._frustumsDrawn+=this._hasTranslucentDepth?1:0,this._hasTranslucentDepth&&(i.framebuffer=this._packFBO.framebuffer,this._packDepthCommand.execute(u,i)),i.framebuffer=l}},H.prototype.executeClassificationCommands=function(e,t,i,n){if(!this._hasTranslucentDepth)return;const a=e.context,o=a.uniformState,s=i.framebuffer;2===this._frustumsDrawn&&(i.framebuffer=this._accumulationFBO.framebuffer,this._copyCommand.execute(a,i)),i.framebuffer=this._drawClassificationFBO.framebuffer,this._frustumsDrawn>1&&this._clearColorCommand.execute(a,i),o.updatePass(h["a"].CESIUM_3D_TILE_CLASSIFICATION);const r=o.globeDepthTexture;o.globeDepthTexture=this._packFBO.getColorTexture();const c=n.commands[h["a"].CESIUM_3D_TILE_CLASSIFICATION],u=n.indices[h["a"].CESIUM_3D_TILE_CLASSIFICATION];for(let l=0;l<u;++l)t(c[l],e,a,i);o.globeDepthTexture=r,i.framebuffer=s,1!==this._frustumsDrawn&&(i.framebuffer=this._accumulationFBO.framebuffer,this._accumulateCommand.execute(a,i),i.framebuffer=s)},H.prototype.execute=function(e,t){if(!this._hasTranslucentDepth)return;1===this._frustumsDrawn?this._textureToComposite=this._drawClassificationFBO.getColorTexture():this._textureToComposite=this._accumulationFBO.getColorTexture();const i=e.frameState.passes.pick?this._compositeCommand.derivedCommands.pick:this._compositeCommand;i.execute(e.context,t),Y(this,e,t)},H.prototype.isSupported=function(){return this._supported},H.prototype.isDestroyed=function(){return!1},H.prototype.destroy=function(){return U(this),V(this),Object(s["a"])(this._compositeCommand)&&(this._compositeCommand.shaderProgram=this._compositeCommand.shaderProgram&&this._compositeCommand.shaderProgram.destroy()),Object(s["a"])(this._packDepthCommand)&&(this._packDepthCommand.shaderProgram=this._packDepthCommand.shaderProgram&&this._packDepthCommand.shaderProgram.destroy()),Object(S["a"])(this)};var Z=H;function X(){this.command=void 0,this.near=void 0,this.far=void 0}function K(e,t,i){const a=e.context;let o,s;a.depthTexture&&(o=new m["a"]),e._useOIT&&a.depthTexture&&(s=new g["a"](a));const r=new _["a"](a);r.viewport=n["a"].clone(i),this.camera=t,this._cameraClone=f["a"].clone(t),this._cameraStartFired=!1,this._cameraMovedTime=void 0,this.viewport=i,this.passState=r,this.pickFramebuffer=new O["a"](a),this.pickDepthFramebuffer=new y["a"],this.sceneFramebuffer=new v["a"],this.globeDepth=o,this.globeTranslucencyFramebuffer=new b["a"],this.oit=s,this.translucentTileClassification=new Z(a),this.pickDepths=[],this.frustumCommandsList=[],this.debugFrustumStatistics=void 0,this._commandExtents=[]}const q=new a["a"],J=new a["a"];function Q(e,t){const i=Math.max(Math.abs(e.x),Math.abs(t.x)),n=Math.max(Math.abs(e.y),Math.abs(t.y)),a=Math.max(Math.abs(e.z),Math.abs(t.z));return Math.max(Math.max(i,n),a)}function $(e,t,i){const n=1/Math.max(1,Q(e.position,t.position));return a["a"].multiplyByScalar(e.position,n,q),a["a"].multiplyByScalar(t.position,n,J),a["a"].equalsEpsilon(q,J,i)&&a["a"].equalsEpsilon(e.direction,t.direction,i)&&a["a"].equalsEpsilon(e.up,t.up,i)&&a["a"].equalsEpsilon(e.right,t.right,i)&&l["a"].equalsEpsilon(e.transform,t.transform,i)&&e.frustum.equalsEpsilon(t.frustum,i)}function ee(e,t,i,n){const a=t.frameState,o=a.camera,r=a.useLogDepth?t.logarithmicDepthFarToNearRatio:t.farToNearRatio,c=t.mode===T["a"].SCENE2D,l=t.nearToFarDistance2D;let d;n*=1+u["a"].EPSILON2,i=Math.min(Math.max(i,o.frustum.near),o.frustum.far),n=Math.max(Math.min(n,o.frustum.far),i),c?(n=Math.min(n,o.position.z+t.nearToFarDistance2D),i=Math.min(i,n),d=Math.ceil(Math.max(1,n-i)/t.nearToFarDistance2D)):d=Math.ceil(Math.log(n/i)/Math.log(r));const h=e.frustumCommandsList;h.length=d;for(let u=0;u<d;++u){let e,t;c?(e=Math.min(n-l,i+u*l),t=Math.min(n,e+l)):(e=Math.max(i,Math.pow(r,u)*i),t=Math.min(n,r*e));let a=h[u];Object(s["a"])(a)?(a.near=e,a.far=t):a=h[u]=new p["a"](e,t)}}function te(e,t,i,n,a){t.debugShowFrustums&&(i.debugOverlappingFrustums=0);const o=e.frustumCommandsList,r=o.length;for(let s=0;s<r;++s){const e=o[s],r=e.near,c=e.far;if(n>c)continue;if(a<r)break;const u=i.pass,l=e.indices[u]++;if(e.commands[u][l]=i,t.debugShowFrustums&&(i.debugOverlappingFrustums|=1<<s),i.executeInClosestFrustum)break}if(t.debugShowFrustums){const t=e.debugFrustumStatistics.commandsInFrustums;t[i.debugOverlappingFrustums]=Object(s["a"])(t[i.debugOverlappingFrustums])?t[i.debugOverlappingFrustums]+1:1,++e.debugFrustumStatistics.totalCommands}t.updateDerivedCommands(i)}K.prototype.checkForCameraUpdates=function(e){const t=this.camera,i=this._cameraClone;return $(t,i,u["a"].EPSILON15)?(this._cameraStartFired&&Object(r["a"])()-this._cameraMovedTime>e.cameraEventWaitTime&&(t.moveEnd.raiseEvent(),this._cameraStartFired=!1),!1):(this._cameraStartFired||(t.moveStart.raiseEvent(),this._cameraStartFired=!0),this._cameraMovedTime=Object(r["a"])(),f["a"].clone(t,i),!0)};const ie=new o["a"],ne=new c["a"];K.prototype.createPotentiallyVisibleSet=function(e){const t=e.frameState,i=t.camera,n=i.directionWC,a=i.positionWC,o=e._computeCommandList,r=e._overlayCommandList,c=t.commandList;e.debugShowFrustums&&(this.debugFrustumStatistics={totalCommands:0,commandsInFrustums:{}});const u=this.frustumCommandsList,l=u.length,_=h["a"].NUMBER_OF_PASSES;for(let s=0;s<l;++s)for(let e=0;e<_;++e)u[s].indices[e]=0;o.length=0,r.length=0;const f=this._commandExtents,p=f.length;let m=0,b=+Number.MAX_VALUE,g=-Number.MAX_VALUE;const y=t.shadowState.shadowsEnabled;let O=+Number.MAX_VALUE,v=-Number.MAX_VALUE,C=Number.MAX_VALUE;const S=t.mode===T["a"].SCENE3D?t.occluder:void 0;let x=t.cullingVolume;const w=ie.planes;for(let s=0;s<5;++s)w[s]=x.planes[s];x=ie;const A=c.length;for(let T=0;T<A;++T){const t=c[T],u=t.pass;if(u===h["a"].COMPUTE)o.push(t);else if(u===h["a"].OVERLAY)r.push(t);else{let o,r;const c=t.boundingVolume;if(Object(s["a"])(c)){if(!e.isVisible(t,x,S))continue;const i=c.computePlaneDistances(a,n,ne);if(o=i.start,r=i.stop,b=Math.min(b,o),g=Math.max(g,r),y&&t.receiveShadows&&o<I["a"].MAXIMUM_DISTANCE&&!(u===h["a"].GLOBE&&o<-100&&r>100)){const e=r-o;u!==h["a"].GLOBE&&o<100&&(C=Math.min(C,e)),O=Math.min(O,o),v=Math.max(v,r)}}else t instanceof d["a"]?(o=i.frustum.near,r=i.frustum.far):(o=i.frustum.near,r=i.frustum.far,b=Math.min(b,o),g=Math.max(g,r));let l=f[m];Object(s["a"])(l)||(l=f[m]=new X),l.command=t,l.near=o,l.far=r,m++}}let P,E;for(y&&(O=Math.min(Math.max(O,i.frustum.near),i.frustum.far),v=Math.max(Math.min(v,i.frustum.far),O)),y&&(t.shadowState.nearPlane=O,t.shadowState.farPlane=v,t.shadowState.closestObjectSize=C),ee(this,e,b,g),P=0;P<m;P++)E=f[P],te(this,e,E.command,E.near,E.far);if(m<p)for(P=m;P<p;P++){if(E=f[P],!Object(s["a"])(E.command))break;E.command=void 0}const L=u.length,D=t.frustumSplits;D.length=L+1;for(let s=0;s<L;++s)D[s]=u[s].near,s===L-1&&(D[s+1]=u[s].far)},K.prototype.destroy=function(){let e;this.pickFramebuffer=this.pickFramebuffer&&this.pickFramebuffer.destroy(),this.pickDepthFramebuffer=this.pickDepthFramebuffer&&this.pickDepthFramebuffer.destroy(),this.sceneFramebuffer=this.sceneFramebuffer&&this.sceneFramebuffer.destroy(),this.globeDepth=this.globeDepth&&this.globeDepth.destroy(),this.oit=this.oit&&this.oit.destroy(),this.translucentTileClassification=this.translucentTileClassification&&this.translucentTileClassification.destroy(),this.globeTranslucencyFramebuffer=this.globeTranslucencyFramebuffer&&this.globeTranslucencyFramebuffer.destroy();const t=this.pickDepths,i=t.length;for(e=0;e<i;++e)t[e].destroy()};t["a"]=K}}]);