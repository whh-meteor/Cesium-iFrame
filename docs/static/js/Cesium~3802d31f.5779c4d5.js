(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["Cesium~3802d31f"],{da97:function(e,t,i){"use strict";var s=i("77af"),a=i("cef5"),o=i("b482"),n=i("be18"),r=i("bef8"),c=i("dc1c"),u=i("bd8d"),m=i("9541"),d=i("71ce"),h=i("2384"),l=i("535a"),p=i("2f63"),f=i("7d62"),_=i("6cae"),g=i("21d7"),b=i("3d7f"),C=i("d940"),S=i("c1e2"),v=i("66bf"),w=i("5ed2"),D=i("93da"),y=i("52f0"),O=i("4b0f"),x=i("f0be"),T=i("713f"),E=i("c34a"),P=i("4e1a"),F=i("4dc8"),j=i("75b2"),I=i("6a29"),L=i("f806"),R=i("f845"),k=i("aec5"),M=i("de02"),A=i("b997"),V=i("d289"),N=i("6dc0"),B=i("1331"),W=i("9dbf"),U=i("d150"),G=i("56d3"),H=i("0b8f"),q=i("c965"),Q=i("81e1"),z=i("ed8b"),K=i("9cff"),J=i("0838"),X=i("f3b8"),Y=i("6b72"),Z=i("d57b"),$=i("4436"),ee=i("482f"),te=i("1b40"),ie=i("01c0"),se=i("3a8e"),ae=i("d572"),oe=i("9e4a"),ne=i("894b"),re=i("738d"),ce=i("a307"),ue=i("0c80"),me=i("059a"),de=i("59d5"),he=i("569f"),le=i("3626"),pe=i("e065"),fe=i("cdd6"),_e=i("619f"),ge=i("ef77"),be=i("8e47");const Ce=function(e){return function(){e.frameState.afterRender.push((function(){e.requestRender()}))}};function Se(e){e=Object(l["a"])(e,l["a"].EMPTY_OBJECT);const t=e.canvas;let i=e.creditContainer,a=e.creditViewport,o=Object(c["a"])(e.contextOptions);Object(p["a"])(o)||(o={}),Object(p["a"])(o.webgl)||(o.webgl={}),o.webgl.powerPreference=Object(l["a"])(o.webgl.powerPreference,"high-performance");const n=Object(p["a"])(i),r=new M["a"](t,o);n||(i=document.createElement("div"),i.style.position="absolute",i.style.bottom="0",i.style["text-shadow"]="0 0 2px #000000",i.style.color="#ffffff",i.style["font-size"]="10px",i.style["padding-right"]="5px",t.parentNode.appendChild(i)),Object(p["a"])(a)||(a=t.parentNode),this._id=Object(d["a"])(),this._jobScheduler=new $["a"],this._frameState=new X["a"](r,new H["a"](i," â€¢ ",a),this._jobScheduler),this._frameState.scene3DOnly=Object(l["a"])(e.scene3DOnly,!1),this._removeCreditContainer=!n,this._creditContainer=i,this._canvas=t,this._context=r,this._computeEngine=new k["a"](r),this._globe=void 0,this._globeTranslucencyState=new Y["a"],this._primitives=new re["a"],this._groundPrimitives=new re["a"],this._globeHeight=void 0,this._cameraUnderground=!1,this._logDepthBuffer=r.fragmentDepth,this._logDepthBufferDirty=!0,this._tweens=new _e["a"],this._shaderFrameCount=0,this._sunPostProcess=void 0,this._computeCommandList=[],this._overlayCommandList=[],this._useOIT=Object(l["a"])(e.orderIndependentTranslucency,!0),this._executeOITFunction=void 0,this._depthPlane=new Q["a"](e.depthPlaneEllipsoidOffset),this._clearColorCommand=new R["a"]({color:new u["a"],stencil:0,owner:this}),this._depthClearCommand=new R["a"]({depth:1,owner:this}),this._stencilClearCommand=new R["a"]({stencil:0}),this._classificationStencilClearCommand=new R["a"]({stencil:0,renderState:N["a"].fromCache({stencilMask:le["a"].CLASSIFICATION_MASK})}),this._depthOnlyRenderStateCache={},this._transitioner=new me["a"](this),this._preUpdate=new g["a"],this._postUpdate=new g["a"],this._renderError=new g["a"],this._preRender=new g["a"],this._postRender=new g["a"],this._minimumDisableDepthTestDistance=0,this._debugInspector=new be["a"],this._msaaSamples=Object(l["a"])(e.msaaSamples,1),this.rethrowRenderErrors=!1,this.completeMorphOnUserInput=!0,this.morphStart=new g["a"],this.morphComplete=new g["a"],this.skyBox=void 0,this.skyAtmosphere=void 0,this.sun=void 0,this.sunBloom=!0,this._sunBloom=void 0,this.moon=void 0,this.backgroundColor=u["a"].clone(u["a"].BLACK),this._mode=ce["a"].SCENE3D,this._mapProjection=Object(p["a"])(e.mapProjection)?e.mapProjection:new b["a"],this.morphTime=1,this.farToNearRatio=1e3,this.logarithmicDepthFarToNearRatio=1e9,this.nearToFarDistance2D=175e4,this.debugCommandFilter=void 0,this.debugShowCommands=!1,this.debugShowFrustums=!1,this.debugShowFramesPerSecond=!1,this.debugShowDepthFrustum=1,this.debugShowFrustumPlanes=!1,this._debugShowFrustumPlanes=!1,this._debugFrustumPlanes=void 0,this.useDepthPicking=!0,this.pickTranslucentDepth=!1,this.cameraEventWaitTime=500,this.fog=new J["a"],this._shadowMapCamera=new W["a"](this),this.shadowMap=new he["a"]({context:r,lightCamera:this._shadowMapCamera,enabled:Object(l["a"])(e.shadows,!1)}),this.invertClassification=!1,this.invertClassificationColor=u["a"].clone(u["a"].WHITE),this._actualInvertClassificationColor=u["a"].clone(this._invertClassificationColor),this._invertClassification=new Z["a"],this.focalLength=void 0,this.eyeSeparation=void 0,this.postProcessStages=new oe["a"],this._brdfLutGenerator=new B["a"],this._performanceDisplay=void 0,this._debugVolume=void 0,this._screenSpaceCameraController=new de["a"](this),this._cameraUnderground=!1,this._mapMode2D=Object(l["a"])(e.mapMode2D,ee["a"].INFINITE_SCROLL),this._environmentState={skyBoxCommand:void 0,skyAtmosphereCommand:void 0,sunDrawCommand:void 0,sunComputeCommand:void 0,moonCommand:void 0,isSunVisible:!1,isMoonVisible:!1,isReadyForAtmosphere:!1,isSkyAtmosphereVisible:!1,clearGlobeDepth:!1,useDepthPlane:!1,renderTranslucentDepthForPick:!1,originalFramebuffer:void 0,useGlobeDepthFramebuffer:!1,useOIT:!1,useInvertClassification:!1,usePostProcess:!1,usePostProcessSelected:!1,useWebVR:!1},this._useWebVR=!1,this._cameraVR=void 0,this._aspectRatioVR=void 0,this.requestRenderMode=Object(l["a"])(e.requestRenderMode,!1),this._renderRequested=!0,this.maximumRenderTimeChange=Object(l["a"])(e.maximumRenderTimeChange,0),this._lastRenderTime=void 0,this._frameRateMonitor=void 0,this._removeRequestListenerCallback=j["a"].requestCompletedEvent.addEventListener(Ce(this)),this._removeTaskProcessorListenerCallback=I["a"].taskCompletedEvent.addEventListener(Ce(this)),this._removeGlobeCallbacks=[];const m=new s["a"](0,0,r.drawingBufferWidth,r.drawingBufferHeight),h=new W["a"](this);this._logDepthBuffer&&(h.frustum.near=.1,h.frustum.far=1e10),this.preloadFlightCamera=new W["a"](this),this.preloadFlightCullingVolume=void 0,this._picking=new ae["a"](this),this._defaultView=new ge["a"](this,h,m),this._view=this._defaultView,this._hdr=void 0,this._hdrDirty=void 0,this.highDynamicRange=!1,this.gamma=2.2,this.sphericalHarmonicCoefficients=void 0,this.specularEnvironmentMaps=void 0,this._specularEnvironmentMapAtlas=void 0,this.light=new pe["a"],Fe(this,0,w["a"].now()),this.updateFrameState(),this.initializeFrame()}function ve(e,t){for(let s=0;s<e._removeGlobeCallbacks.length;++s)e._removeGlobeCallbacks[s]();e._removeGlobeCallbacks.length=0;const i=[];Object(p["a"])(t)&&(i.push(t.imageryLayersUpdatedEvent.addEventListener(Ce(e))),i.push(t.terrainProviderChanged.addEventListener(Ce(e)))),e._removeGlobeCallbacks=i}function we(e,t,i){const s=e._frameState,a=e._context,o=e._view.oit,n=s.shadowState.lightShadowMaps,r=s.shadowState.lightShadowsEnabled;let c=t.derivedCommands;Object(p["a"])(t.pickId)&&(c.picking=z["a"].createPickDerivedCommand(e,t,a,c.picking)),t.pickOnly||(c.depth=z["a"].createDepthOnlyDerivedCommand(e,t,a,c.depth)),c.originalCommand=t,e._hdr&&(c.hdr=z["a"].createHdrCommand(t,a,c.hdr),t=c.hdr.command,c=t.derivedCommands),r&&t.receiveShadows&&(c.shadows=he["a"].createReceiveDerivedCommand(n,t,i,a,c.shadows)),t.pass===V["a"].TRANSLUCENT&&Object(p["a"])(o)&&o.isSupported()&&(r&&t.receiveShadows?(c.oit=Object(p["a"])(c.oit)?c.oit:{},c.oit.shadows=o.createDerivedCommands(c.shadows.receiveCommand,a,c.oit.shadows)):c.oit=o.createDerivedCommands(t,a,c.oit))}Object.defineProperties(Se.prototype,{canvas:{get:function(){return this._canvas}},drawingBufferHeight:{get:function(){return this._context.drawingBufferHeight}},drawingBufferWidth:{get:function(){return this._context.drawingBufferWidth}},maximumAliasedLineWidth:{get:function(){return A["a"].maximumAliasedLineWidth}},maximumCubeMapSize:{get:function(){return A["a"].maximumCubeMapSize}},pickPositionSupported:{get:function(){return this._context.depthTexture}},sampleHeightSupported:{get:function(){return this._context.depthTexture}},clampToHeightSupported:{get:function(){return this._context.depthTexture}},invertClassificationSupported:{get:function(){return this._context.depthTexture}},specularEnvironmentMapsSupported:{get:function(){return te["a"].isSupported(this._context)}},globe:{get:function(){return this._globe},set:function(e){this._globe=this._globe&&this._globe.destroy(),this._globe=e,ve(this,e)}},primitives:{get:function(){return this._primitives}},groundPrimitives:{get:function(){return this._groundPrimitives}},camera:{get:function(){return this._view.camera},set:function(e){this._view.camera=e}},view:{get:function(){return this._view},set:function(e){this._view=e}},defaultView:{get:function(){return this._defaultView}},picking:{get:function(){return this._picking}},screenSpaceCameraController:{get:function(){return this._screenSpaceCameraController}},mapProjection:{get:function(){return this._mapProjection}},jobScheduler:{get:function(){return this._jobScheduler}},frameState:{get:function(){return this._frameState}},environmentState:{get:function(){return this._environmentState}},tweens:{get:function(){return this._tweens}},imageryLayers:{get:function(){if(Object(p["a"])(this.globe))return this.globe.imageryLayers}},terrainProvider:{get:function(){if(Object(p["a"])(this.globe))return this.globe.terrainProvider},set:function(e){Object(p["a"])(this.globe)&&(this.globe.terrainProvider=e)}},terrainProviderChanged:{get:function(){if(Object(p["a"])(this.globe))return this.globe.terrainProviderChanged}},preUpdate:{get:function(){return this._preUpdate}},postUpdate:{get:function(){return this._postUpdate}},renderError:{get:function(){return this._renderError}},preRender:{get:function(){return this._preRender}},postRender:{get:function(){return this._postRender}},lastRenderTime:{get:function(){return this._lastRenderTime}},context:{get:function(){return this._context}},debugFrustumStatistics:{get:function(){return this._view.debugFrustumStatistics}},scene3DOnly:{get:function(){return this._frameState.scene3DOnly}},orderIndependentTranslucency:{get:function(){return this._useOIT}},id:{get:function(){return this._id}},mode:{get:function(){return this._mode},set:function(e){e===ce["a"].SCENE2D?this.morphTo2D(0):e===ce["a"].SCENE3D?this.morphTo3D(0):e===ce["a"].COLUMBUS_VIEW&&this.morphToColumbusView(0),this._mode=e}},frustumCommandsList:{get:function(){return this._view.frustumCommandsList}},numberOfFrustums:{get:function(){return this._view.frustumCommandsList.length}},useWebVR:{get:function(){return this._useWebVR},set:function(e){this._useWebVR=e,this._useWebVR?(this._frameState.creditDisplay.container.style.visibility="hidden",this._cameraVR=new W["a"](this),Object(p["a"])(this._deviceOrientationCameraController)||(this._deviceOrientationCameraController=new K["a"](this)),this._aspectRatioVR=this.camera.frustum.aspectRatio):(this._frameState.creditDisplay.container.style.visibility="visible",this._cameraVR=void 0,this._deviceOrientationCameraController=this._deviceOrientationCameraController&&!this._deviceOrientationCameraController.isDestroyed()&&this._deviceOrientationCameraController.destroy(),this.camera.frustum.aspectRatio=this._aspectRatioVR,this.camera.frustum.xOffset=0)}},mapMode2D:{get:function(){return this._mapMode2D}},splitPosition:{get:function(){return this._frameState.splitPosition},set:function(e){this._frameState.splitPosition=e}},minimumDisableDepthTestDistance:{get:function(){return this._minimumDisableDepthTestDistance},set:function(e){this._minimumDisableDepthTestDistance=e}},logarithmicDepthBuffer:{get:function(){return this._logDepthBuffer},set:function(e){e=this._context.fragmentDepth&&e,this._logDepthBuffer!==e&&(this._logDepthBuffer=e,this._logDepthBufferDirty=!0)}},gamma:{get:function(){return this._context.uniformState.gamma},set:function(e){this._context.uniformState.gamma=e}},highDynamicRange:{get:function(){return this._hdr},set:function(e){const t=this._context,i=e&&t.depthTexture&&(t.colorBufferFloat||t.colorBufferHalfFloat);this._hdrDirty=i!==this._hdr,this._hdr=i}},highDynamicRangeSupported:{get:function(){const e=this._context;return e.depthTexture&&(e.colorBufferFloat||e.colorBufferHalfFloat)}},cameraUnderground:{get:function(){return this._cameraUnderground}},msaaSamples:{get:function(){return this._msaaSamples},set:function(e){e=Math.min(e,A["a"].maximumSamples),this._msaaSamples=e}},msaaSupported:{get:function(){return this._context.msaa}},pixelRatio:{get:function(){return this._frameState.pixelRatio},set:function(e){this._frameState.pixelRatio=e}},opaqueFrustumNearOffset:{get:function(){return.9999}},globeHeight:{get:function(){return this._globeHeight}}}),Se.prototype.getCompressedTextureFormatSupported=function(e){const t=this.context;return("WEBGL_compressed_texture_s3tc"===e||"s3tc"===e)&&t.s3tc||("WEBGL_compressed_texture_pvrtc"===e||"pvrtc"===e)&&t.pvrtc||("WEBGL_compressed_texture_etc"===e||"etc"===e)&&t.etc||("WEBGL_compressed_texture_etc1"===e||"etc1"===e)&&t.etc1||("WEBGL_compressed_texture_astc"===e||"astc"===e)&&t.astc||("EXT_texture_compression_bptc"===e||"bc7"===e)&&t.bc7},Se.prototype.updateDerivedCommands=function(e){if(!Object(p["a"])(e.derivedCommands))return;const t=this._frameState,i=this._context;let s=!1;const a=t.shadowState.lastDirtyTime;e.lastDirtyTime!==a&&(e.lastDirtyTime=a,e.dirty=!0,s=!0);const o=t.useLogDepth,n=this._hdr,r=e.derivedCommands,c=Object(p["a"])(r.logDepth),u=Object(p["a"])(r.hdr),m=Object(p["a"])(r.originalCommand),d=o&&!c,h=n&&!u,l=(!o||!n)&&!m;if(e.dirty=e.dirty||d||h||l,e.dirty){e.dirty=!1;const a=t.shadowState.shadowMaps,o=t.shadowState.shadowsEnabled;o&&e.castShadows&&(r.shadows=he["a"].createCastDerivedCommand(a,e,s,i,r.shadows)),(c||d)&&(r.logDepth=z["a"].createLogDepthCommand(e,i,r.logDepth),we(this,r.logDepth.command,s)),(m||l)&&we(this,e,s)}};const De=new G["a"]({pass:U["a"].RENDER}),ye=new G["a"]({pass:U["a"].PRELOAD}),Oe=new G["a"]({pass:U["a"].PRELOAD_FLIGHT}),xe=new G["a"]({pass:U["a"].REQUEST_RENDER_MODE_DEFER_CHECK}),Te=new a["a"];let Ee;function Pe(e){const t=e.globe;if(e._mode===ce["a"].SCENE3D&&Object(p["a"])(t)&&t.show&&!e._cameraUnderground&&!e._globeTranslucencyState.translucent){const i=t.ellipsoid,s=e.frameState.minimumTerrainHeight;return Te.radius=i.minimumRadius+s,Ee=x["a"].fromBoundingSphere(Te,e.camera.positionWC,Ee),Ee}}function Fe(e,t,i){const s=e._frameState;s.frameNumber=t,s.time=w["a"].clone(i,s.time)}Se.prototype.clearPasses=function(e){e.render=!1,e.pick=!1,e.depth=!1,e.postProcess=!1,e.offscreen=!1},Se.prototype.updateFrameState=function(){const e=this.camera,t=this._frameState;t.commandList.length=0,t.shadowMaps.length=0,t.brdfLutGenerator=this._brdfLutGenerator,t.environmentMap=this.skyBox&&this.skyBox._cubeMap,t.mode=this._mode,t.morphTime=this.morphTime,t.mapProjection=this.mapProjection,t.camera=e,t.cullingVolume=e.frustum.computeCullingVolume(e.positionWC,e.directionWC,e.upWC),t.occluder=Pe(this),t.minimumTerrainHeight=0,t.minimumDisableDepthTestDistance=this._minimumDisableDepthTestDistance,t.invertClassification=this.invertClassification,t.useLogDepth=this._logDepthBuffer&&!(this.camera.frustum instanceof T["a"]||this.camera.frustum instanceof E["a"]),t.light=this.light,t.cameraUnderground=this._cameraUnderground,t.globeTranslucencyState=this._globeTranslucencyState,Object(p["a"])(this.globe)&&(t.terrainExaggeration=this.globe.terrainExaggeration,t.terrainExaggerationRelativeHeight=this.globe.terrainExaggerationRelativeHeight),Object(p["a"])(this._specularEnvironmentMapAtlas)&&this._specularEnvironmentMapAtlas.ready?(t.specularEnvironmentMaps=this._specularEnvironmentMapAtlas.texture,t.specularEnvironmentMapsMaximumLOD=this._specularEnvironmentMapAtlas.maximumMipmapLevel):(t.specularEnvironmentMaps=void 0,t.specularEnvironmentMapsMaximumLOD=void 0),t.sphericalHarmonicCoefficients=this.sphericalHarmonicCoefficients,this._actualInvertClassificationColor=u["a"].clone(this.invertClassificationColor,this._actualInvertClassificationColor),Z["a"].isTranslucencySupported(this._context)||(this._actualInvertClassificationColor.alpha=1),t.invertClassificationColor=this._actualInvertClassificationColor,Object(p["a"])(this.globe)?t.maximumScreenSpaceError=this.globe.maximumScreenSpaceError:t.maximumScreenSpaceError=2,this.clearPasses(t.passes),t.tilesetPassState=void 0},Se.prototype.isVisible=function(e,t,i){return Object(p["a"])(e)&&(!Object(p["a"])(e.boundingVolume)||!e.cull||t.computeVisibility(e.boundingVolume)!==v["a"].OUTSIDE&&(!Object(p["a"])(i)||!e.occlude||!e.boundingVolume.isOccluded(i)))};let je=new y["a"](0,0,1,0,1,0,0,0,0,1,0,0,0,0,0,1);function Ie(e,t,i,s){const a=t._frameState,r=a.context,c=e.boundingVolume;let u;Object(p["a"])(t._debugVolume)&&t._debugVolume.destroy();let d=n["a"].clone(c.center);if(a.mode!==ce["a"].SCENE3D){d=y["a"].multiplyByPoint(je,d,d);const e=a.mapProjection,t=e.unproject(d);d=e.ellipsoid.cartographicToCartesian(t)}if(Object(p["a"])(c.radius)){const e=c.radius;u=S["a"].toWireframe(_["a"].createGeometry(new _["a"]({radii:new n["a"](e,e,e),vertexFormat:se["a"].FLAT_VERTEX_FORMAT}))),t._debugVolume=new ne["a"]({geometryInstances:new C["a"]({geometry:u,modelMatrix:y["a"].fromTranslation(d),attributes:{color:new m["a"](1,0,0,1)}}),appearance:new se["a"]({flat:!0,translucent:!1}),asynchronous:!1})}else{const e=c.halfAxes;u=S["a"].toWireframe(o["a"].createGeometry(o["a"].fromDimensions({dimensions:new n["a"](2,2,2),vertexFormat:se["a"].FLAT_VERTEX_FORMAT}))),t._debugVolume=new ne["a"]({geometryInstances:new C["a"]({geometry:u,modelMatrix:y["a"].fromRotationTranslation(e,d,new y["a"]),attributes:{color:new m["a"](1,0,0,1)}}),appearance:new se["a"]({flat:!0,translucent:!1}),asynchronous:!1})}const h=a.commandList,l=a.commandList=[];if(t._debugVolume.update(a),e=l[0],a.useLogDepth){const t=z["a"].createLogDepthCommand(e,r);e=t.command}let f;Object(p["a"])(s)&&(f=i.framebuffer,i.framebuffer=s),e.execute(r,i),Object(p["a"])(f)&&(i.framebuffer=f),a.commandList=h}function Le(e,t,i,s,a){const o=t._frameState;if(Object(p["a"])(t.debugCommandFilter)&&!t.debugCommandFilter(e))return;if(e instanceof R["a"])return void e.execute(i,s);e.debugShowBoundingVolume&&Object(p["a"])(e.boundingVolume)&&Ie(e,t,s,a),o.useLogDepth&&Object(p["a"])(e.derivedCommands.logDepth)&&(e=e.derivedCommands.logDepth.command);const n=o.passes;if(!n.pick&&!n.depth&&t._hdr&&Object(p["a"])(e.derivedCommands)&&Object(p["a"])(e.derivedCommands.hdr)&&(e=e.derivedCommands.hdr.command),n.pick||n.depth){if(n.pick&&!n.depth&&Object(p["a"])(e.derivedCommands.picking))return e=e.derivedCommands.picking.pickCommand,void e.execute(i,s);if(Object(p["a"])(e.derivedCommands.depth))return e=e.derivedCommands.depth.depthOnlyCommand,void e.execute(i,s)}t.debugShowCommands||t.debugShowFrustums?t._debugInspector.executeDebugShowFrustumsCommand(t,e,s):o.shadowState.lightShadowsEnabled&&e.receiveShadows&&Object(p["a"])(e.derivedCommands.shadows)?e.derivedCommands.shadows.receiveCommand.execute(i,s):e.execute(i,s)}function Re(e,t,i,s){const a=t._frameState;let o=e.derivedCommands;Object(p["a"])(o)&&(a.useLogDepth&&Object(p["a"])(o.logDepth)&&(e=o.logDepth.command),o=e.derivedCommands,Object(p["a"])(o.picking)?(e=o.picking.pickCommand,e.execute(i,s)):Object(p["a"])(o.depth)&&(e=o.depth.depthOnlyCommand,e.execute(i,s)))}function ke(e,t,i){return t.boundingVolume.distanceSquaredTo(i)-e.boundingVolume.distanceSquaredTo(i)}function Me(e,t,i){return e.boundingVolume.distanceSquaredTo(i)-t.boundingVolume.distanceSquaredTo(i)+D["a"].EPSILON12}function Ae(e,t,i,s,a){const o=e.context;Object(O["a"])(s,ke,e.camera.positionWC),Object(p["a"])(a)&&t(a.unclassifiedCommand,e,o,i);const n=s.length;for(let r=0;r<n;++r)t(s[r],e,o,i)}function Ve(e,t,i,s,a){const o=e.context;Object(O["a"])(s,Me,e.camera.positionWC),Object(p["a"])(a)&&t(a.unclassifiedCommand,e,o,i);const n=s.length;for(let r=0;r<n;++r)t(s[r],e,o,i)}je=y["a"].inverseTransformation(je,je);const Ne=new P["a"],Be=new F["a"],We=new T["a"],Ue=new E["a"];function Ge(e,t){const i=e.camera,s=e.context,a=e.frameState,o=s.uniformState;let n;o.updateCamera(i),n=Object(p["a"])(i.frustum.fov)?i.frustum.clone(Ne):Object(p["a"])(i.frustum.infiniteProjectionMatrix)?i.frustum.clone(Be):Object(p["a"])(i.frustum.width)?i.frustum.clone(We):i.frustum.clone(Ue),n.near=i.frustum.near,n.far=i.frustum.far,o.updateFrustum(n),o.updatePass(V["a"].ENVIRONMENT);const r=a.passes,c=r.pick,u=e._environmentState,m=e._view,d=u.renderTranslucentDepthForPick,h=u.useWebVR;if(!c){const i=u.skyBoxCommand;if(Object(p["a"])(i)&&Le(i,e,s,t),u.isSkyAtmosphereVisible&&Le(u.skyAtmosphereCommand,e,s,t),u.isSunVisible&&(u.sunDrawCommand.execute(s,t),e.sunBloom&&!h)){let i;i=u.useGlobeDepthFramebuffer?m.globeDepth.framebuffer:u.usePostProcess?m.sceneFramebuffer.framebuffer:u.originalFramebuffer,e._sunPostProcess.execute(s),e._sunPostProcess.copy(s,i),t.framebuffer=i}u.isMoonVisible&&u.moonCommand.execute(s,t)}let l;u.useOIT?(Object(p["a"])(e._executeOITFunction)||(e._executeOITFunction=function(e,t,i,a,o){m.globeDepth.prepareColorTextures(s),m.oit.executeCommands(e,t,i,a,o)}),l=e._executeOITFunction):l=r.render?Ae:Ve;const f=m.frustumCommandsList,_=f.length,g=u.clearGlobeDepth,b=u.useDepthPlane,C=e._globeTranslucencyState,S=C.translucent,v=e._view.globeTranslucencyFramebuffer,w=e._depthClearCommand,D=e._stencilClearCommand,y=e._classificationStencilClearCommand,O=e._depthPlane,x=u.usePostProcessSelected,T=i.position.z;let E;for(let P=0;P<_;++P){const r=_-P-1,h=f[r];e.mode===ce["a"].SCENE2D?(i.position.z=T-h.near+1,n.far=Math.max(1,h.far-h.near),n.near=1,o.update(a),o.updateFrustum(n)):(n.near=0!==r?h.near*e.opaqueFrustumNearOffset:h.near,n.far=h.far,o.updateFrustum(n)),w.execute(s,t),s.stencilBuffer&&D.execute(s,t),o.updatePass(V["a"].GLOBE);let F=h.commands[V["a"].GLOBE],j=h.indices[V["a"].GLOBE];if(S)C.executeGlobeCommands(h,Le,v,e,t);else for(E=0;E<j;++E)Le(F[E],e,s,t);const I=m.globeDepth;if(Object(p["a"])(I)&&u.useGlobeDepthFramebuffer&&I.executeCopyDepth(s,t),!u.renderTranslucentDepthForPick)if(o.updatePass(V["a"].TERRAIN_CLASSIFICATION),F=h.commands[V["a"].TERRAIN_CLASSIFICATION],j=h.indices[V["a"].TERRAIN_CLASSIFICATION],S)C.executeGlobeClassificationCommands(h,Le,v,e,t);else for(E=0;E<j;++E)Le(F[E],e,s,t);if(g&&(w.execute(s,t),b&&O.execute(s,t)),!u.useInvertClassification||c||u.renderTranslucentDepthForPick){for(o.updatePass(V["a"].CESIUM_3D_TILE),F=h.commands[V["a"].CESIUM_3D_TILE],j=h.indices[V["a"].CESIUM_3D_TILE],E=0;E<j;++E)Le(F[E],e,s,t);if(j>0&&(Object(p["a"])(I)&&u.useGlobeDepthFramebuffer&&(I.prepareColorTextures(s,g),I.executeUpdateDepth(s,t,g,I.depthStencilTexture)),!u.renderTranslucentDepthForPick))for(o.updatePass(V["a"].CESIUM_3D_TILE_CLASSIFICATION),F=h.commands[V["a"].CESIUM_3D_TILE_CLASSIFICATION],j=h.indices[V["a"].CESIUM_3D_TILE_CLASSIFICATION],E=0;E<j;++E)Le(F[E],e,s,t)}else{e._invertClassification.clear(s,t);const i=t.framebuffer;for(t.framebuffer=e._invertClassification._fbo.framebuffer,o.updatePass(V["a"].CESIUM_3D_TILE),F=h.commands[V["a"].CESIUM_3D_TILE],j=h.indices[V["a"].CESIUM_3D_TILE],E=0;E<j;++E)Le(F[E],e,s,t);for(Object(p["a"])(I)&&u.useGlobeDepthFramebuffer&&(e._invertClassification.prepareTextures(s),I.executeUpdateDepth(s,t,g,e._invertClassification._fbo.getDepthStencilTexture())),o.updatePass(V["a"].CESIUM_3D_TILE_CLASSIFICATION_IGNORE_SHOW),F=h.commands[V["a"].CESIUM_3D_TILE_CLASSIFICATION_IGNORE_SHOW],j=h.indices[V["a"].CESIUM_3D_TILE_CLASSIFICATION_IGNORE_SHOW],E=0;E<j;++E)Le(F[E],e,s,t);for(t.framebuffer=i,e._invertClassification.executeClassified(s,t),1===a.invertClassificationColor.alpha&&e._invertClassification.executeUnclassified(s,t),j>0&&s.stencilBuffer&&y.execute(s,t),o.updatePass(V["a"].CESIUM_3D_TILE_CLASSIFICATION),F=h.commands[V["a"].CESIUM_3D_TILE_CLASSIFICATION],j=h.indices[V["a"].CESIUM_3D_TILE_CLASSIFICATION],E=0;E<j;++E)Le(F[E],e,s,t)}for(j>0&&s.stencilBuffer&&D.execute(s,t),o.updatePass(V["a"].OPAQUE),F=h.commands[V["a"].OPAQUE],j=h.indices[V["a"].OPAQUE],E=0;E<j;++E)Le(F[E],e,s,t);let L;0!==r&&e.mode!==ce["a"].SCENE2D&&(n.near=h.near,o.updateFrustum(n)),!c&&u.useInvertClassification&&a.invertClassificationColor.alpha<1&&(L=e._invertClassification),o.updatePass(V["a"].TRANSLUCENT),F=h.commands[V["a"].TRANSLUCENT],F.length=h.indices[V["a"].TRANSLUCENT],l(e,Le,t,F,L);const R=h.indices[V["a"].CESIUM_3D_TILE_CLASSIFICATION]>0;if(R&&m.translucentTileClassification.isSupported()&&(m.translucentTileClassification.executeTranslucentCommands(e,Le,t,F,I.depthStencilTexture),m.translucentTileClassification.executeClassificationCommands(e,Le,t,h)),s.depthTexture&&e.useDepthPicking&&(u.useGlobeDepthFramebuffer||d)){const i=I.depthStencilTexture,a=e._picking.getPickDepth(e,r);a.update(s,i),a.executeCopyDepth(s,t)}if(c||!x)continue;const k=t.framebuffer;if(t.framebuffer=m.sceneFramebuffer.getIdFramebuffer(),n.near=0!==r?h.near*e.opaqueFrustumNearOffset:h.near,n.far=h.far,o.updateFrustum(n),o.updatePass(V["a"].GLOBE),F=h.commands[V["a"].GLOBE],j=h.indices[V["a"].GLOBE],S)C.executeGlobeCommands(h,Re,v,e,t);else for(E=0;E<j;++E)Re(F[E],e,s,t);for(g&&(w.framebuffer=t.framebuffer,w.execute(s,t),w.framebuffer=void 0),g&&b&&O.execute(s,t),o.updatePass(V["a"].CESIUM_3D_TILE),F=h.commands[V["a"].CESIUM_3D_TILE],j=h.indices[V["a"].CESIUM_3D_TILE],E=0;E<j;++E)Re(F[E],e,s,t);for(o.updatePass(V["a"].OPAQUE),F=h.commands[V["a"].OPAQUE],j=h.indices[V["a"].OPAQUE],E=0;E<j;++E)Re(F[E],e,s,t);for(o.updatePass(V["a"].TRANSLUCENT),F=h.commands[V["a"].TRANSLUCENT],j=h.indices[V["a"].TRANSLUCENT],E=0;E<j;++E)Re(F[E],e,s,t);t.framebuffer=k}}function He(e){const t=e.context.uniformState;t.updatePass(V["a"].COMPUTE);const i=e._environmentState.sunComputeCommand;Object(p["a"])(i)&&i.execute(e._computeEngine);const s=e._computeCommandList,a=s.length;for(let o=0;o<a;++o)s[o].execute(e._computeEngine)}function qe(e,t){const i=e.context.uniformState;i.updatePass(V["a"].OVERLAY);const s=e.context,a=e._overlayCommandList,o=a.length;for(let n=0;n<o;++n)a[n].execute(s,t)}function Qe(e,t,i){const s=i.shadowMapCullingVolume,a=i.isPointLight,o=i.passes,n=o.length,r=t.length;for(let c=0;c<r;++c){const i=t[c];if(e.updateDerivedCommands(i),i.castShadows&&(i.pass===V["a"].GLOBE||i.pass===V["a"].CESIUM_3D_TILE||i.pass===V["a"].OPAQUE||i.pass===V["a"].TRANSLUCENT)&&e.isVisible(i,s))if(a)for(let e=0;e<n;++e)o[e].commandList.push(i);else if(1===n)o[0].commandList.push(i);else{let t=!1;for(let s=n-1;s>=0;--s){const a=o[s].cullingVolume;if(e.isVisible(i,a))o[s].commandList.push(i),t=!0;else if(t)break}}}}function ze(e){const t=e.frameState,i=t.shadowState.shadowMaps,s=i.length;if(!t.shadowState.shadowsEnabled)return;const a=e.context,o=a.uniformState;for(let n=0;n<s;++n){const t=i[n];if(t.outOfView)continue;const s=t.passes,r=s.length;for(let e=0;e<r;++e)s[e].commandList.length=0;const c=e.frameState.commandList;Qe(e,c,t);for(let i=0;i<r;++i){const s=t.passes[i];o.updateCamera(s.camera),t.updatePass(a,i);const r=s.commandList.length;for(let t=0;t<r;++t){const i=s.commandList[t];o.updatePass(i.pass),Le(i.derivedCommands.shadows.castCommands[n],e,a,s.passState)}}}}const Ke=new n["a"];function Je(e,t,i){const s=e._view,a=s.camera,o=e._environmentState,r=o.renderTranslucentDepthForPick;mt(e,t,i),ut(e),s.createPotentiallyVisibleSet(e),He(e),r||ze(e);const c=t.viewport;c.x=0,c.y=0,c.width=.5*c.width;const u=W["a"].clone(a,e._cameraVR);u.frustum=a.frustum;const m=a.frustum.near,d=m*Object(l["a"])(e.focalLength,5),h=Object(l["a"])(e.eyeSeparation,d/30),p=n["a"].multiplyByScalar(u.right,.5*h,Ke);a.frustum.aspectRatio=c.width/c.height;const f=.5*h*m/d;n["a"].add(u.position,p,a.position),a.frustum.xOffset=f,Ge(e,t),c.x=c.width,n["a"].subtract(u.position,p,a.position),a.frustum.xOffset=-f,Ge(e,t),W["a"].clone(u,a)}Se.prototype.updateAndExecuteCommands=function(e,t){const i=this._frameState,s=i.mode,a=this._environmentState.useWebVR;a?Je(this,e,t):s!==ce["a"].SCENE2D||this._mapMode2D===ee["a"].ROTATE?ot(!0,this,e,t):(mt(this,e,t),at(this,e))};const Xe=new r["a"](Math.PI,D["a"].PI_OVER_TWO),Ye=new n["a"],Ze=new n["a"],$e=new y["a"],et=new y["a"],tt=new n["a"],it=new n["a"],st=new s["a"];function at(e,t){const i=e.context,a=e.frameState,o=e.camera,r=t.viewport,c=s["a"].clone(r,st);t.viewport=c;const u=Xe,m=Ye,d=e.mapProjection;d.project(u,m);const h=n["a"].clone(o.position,Ze),l=y["a"].clone(o.transform,et),p=o.frustum.clone();o._setTransform(y["a"].IDENTITY);const f=y["a"].computeViewportTransformation(c,0,1,$e),_=o.frustum.projectionMatrix,g=o.positionWC.y,b=n["a"].fromElements(D["a"].sign(g)*m.x-g,0,-o.positionWC.x,tt),C=L["a"].pointToGLWindowCoordinates(_,f,b,it);C.x=Math.floor(C.x);const S=c.x,v=c.width;if(0===g||C.x<=S||C.x>=S+v)ot(!0,e,t);else if(Math.abs(S+.5*v-C.x)<1)c.width=C.x-c.x,o.position.x*=D["a"].sign(o.position.x),o.frustum.right=0,a.cullingVolume=o.frustum.computeCullingVolume(o.positionWC,o.directionWC,o.upWC),i.uniformState.update(a),ot(!0,e,t),c.x=C.x,o.position.x=-o.position.x,o.frustum.right=-o.frustum.left,o.frustum.left=0,a.cullingVolume=o.frustum.computeCullingVolume(o.positionWC,o.directionWC,o.upWC),i.uniformState.update(a),ot(!1,e,t);else if(C.x>S+.5*v){c.width=C.x-S;const s=o.frustum.right;o.frustum.right=m.x-g,a.cullingVolume=o.frustum.computeCullingVolume(o.positionWC,o.directionWC,o.upWC),i.uniformState.update(a),ot(!0,e,t),c.x=C.x,c.width=S+v-C.x,o.position.x=-o.position.x,o.frustum.left=-o.frustum.right,o.frustum.right=s-2*o.frustum.right,a.cullingVolume=o.frustum.computeCullingVolume(o.positionWC,o.directionWC,o.upWC),i.uniformState.update(a),ot(!1,e,t)}else{c.x=C.x,c.width=S+v-C.x;const s=o.frustum.left;o.frustum.left=-m.x-g,a.cullingVolume=o.frustum.computeCullingVolume(o.positionWC,o.directionWC,o.upWC),i.uniformState.update(a),ot(!0,e,t),c.x=S,c.width=C.x-S,o.position.x=-o.position.x,o.frustum.right=-o.frustum.left,o.frustum.left=s-2*o.frustum.left,a.cullingVolume=o.frustum.computeCullingVolume(o.positionWC,o.directionWC,o.upWC),i.uniformState.update(a),ot(!1,e,t)}o._setTransform(l),n["a"].clone(h,o.position),o.frustum=p.clone(),t.viewport=r}function ot(e,t,i,s){const a=t._environmentState,o=t._view,n=a.renderTranslucentDepthForPick;e||(t.frameState.commandList.length=0),ut(t),o.createPotentiallyVisibleSet(t),e&&(Object(p["a"])(s)&&mt(t,i,s),He(t),n||ze(t)),Ge(t,i)}const nt=new h["a"];function rt(e){const t=e._frameState;e.debugShowFrustumPlanes!==e._debugShowFrustumPlanes&&(e.debugShowFrustumPlanes?e._debugFrustumPlanes=new q["a"]({camera:e.camera,updateOnChange:!1,frustumSplits:t.frustumSplits}):e._debugFrustumPlanes=e._debugFrustumPlanes&&e._debugFrustumPlanes.destroy(),e._debugShowFrustumPlanes=e.debugShowFrustumPlanes),Object(p["a"])(e._debugFrustumPlanes)&&e._debugFrustumPlanes.update(t)}function ct(e){const t=e._frameState,i=t.shadowMaps,s=i.length,a=s>0&&!t.passes.pick&&e.mode===ce["a"].SCENE3D;if(a!==t.shadowState.shadowsEnabled&&(++t.shadowState.lastDirtyTime,t.shadowState.shadowsEnabled=a),t.shadowState.lightShadowsEnabled=!1,a){for(let e=0;e<s;++e)if(i[e]!==t.shadowState.shadowMaps[e]){++t.shadowState.lastDirtyTime;break}t.shadowState.shadowMaps.length=0,t.shadowState.lightShadowMaps.length=0;for(let e=0;e<s;++e){const s=i[e];s.update(t),t.shadowState.shadowMaps.push(s),s.fromLightSource&&(t.shadowState.lightShadowMaps.push(s),t.shadowState.lightShadowsEnabled=!0),s.dirty&&(++t.shadowState.lastDirtyTime,s.dirty=!1)}}}function ut(e){const t=e._frameState;e._groundPrimitives.update(t),e._primitives.update(t),rt(e),ct(e),e._globe&&e._globe.render(t)}function mt(e,t,i){const s=e._context,a=e._frameState,o=e._environmentState,n=e._view,r=e._frameState.passes,c=r.pick;Object(p["a"])(n.globeDepth)&&(n.globeDepth.picking=c);const m=o.useWebVR;o.originalFramebuffer=t.framebuffer,Object(p["a"])(e.sun)&&e.sunBloom!==e._sunBloom?(e.sunBloom&&!m?e._sunPostProcess=new fe["a"]:Object(p["a"])(e._sunPostProcess)&&(e._sunPostProcess=e._sunPostProcess.destroy()),e._sunBloom=e.sunBloom):!Object(p["a"])(e.sun)&&Object(p["a"])(e._sunPostProcess)&&(e._sunPostProcess=e._sunPostProcess.destroy(),e._sunBloom=!1);const d=e._clearColorCommand;u["a"].clone(i,d.color),d.execute(s,t);const h=o.useGlobeDepthFramebuffer=Object(p["a"])(n.globeDepth);h&&(n.globeDepth.update(s,t,n.viewport,e.msaaSamples,e._hdr,o.clearGlobeDepth),n.globeDepth.clear(s,t,i));const l=n.oit,f=o.useOIT=!c&&Object(p["a"])(l)&&l.isSupported();f&&(l.update(s,t,n.globeDepth.colorFramebufferManager,e._hdr,e.msaaSamples),l.clear(s,t,i),o.useOIT=l.isSupported());const _=e.postProcessStages;let g=o.usePostProcess=!c&&(e._hdr||_.length>0||_.ambientOcclusion.enabled||_.fxaa.enabled||_.bloom.enabled);o.usePostProcessSelected=!1,g&&(n.sceneFramebuffer.update(s,n.viewport,e._hdr,e.msaaSamples),n.sceneFramebuffer.clear(s,t,i),_.update(s,a.useLogDepth,e._hdr),_.clear(s),g=o.usePostProcess=_.ready,o.usePostProcessSelected=g&&_.hasSelected),o.isSunVisible&&e.sunBloom&&!m?(t.framebuffer=e._sunPostProcess.update(t),e._sunPostProcess.clear(s,t,i)):h?t.framebuffer=n.globeDepth.framebuffer:g&&(t.framebuffer=n.sceneFramebuffer.framebuffer),Object(p["a"])(t.framebuffer)&&d.execute(s,t);const b=o.useInvertClassification=!c&&Object(p["a"])(t.framebuffer)&&e.invertClassification;if(b){let i;if(1===e.frameState.invertClassificationColor.alpha&&o.useGlobeDepthFramebuffer&&(i=n.globeDepth.framebuffer),Object(p["a"])(i)||s.depthTexture){if(e._invertClassification.previousFramebuffer=i,e._invertClassification.update(s,e.msaaSamples,n.globeDepth.colorFramebufferManager),e._invertClassification.clear(s,t),e.frameState.invertClassificationColor.alpha<1&&f){const t=e._invertClassification.unclassifiedCommand,i=t.derivedCommands;i.oit=l.createDerivedCommands(t,s,i.oit)}}else o.useInvertClassification=!1}e._globeTranslucencyState.translucent&&n.globeTranslucencyFramebuffer.updateAndClear(e._hdr,n.viewport,s,t)}function dt(e){const t=e._frameState.afterRender;for(let i=0,s=t.length;i<s;++i)t[i](),e.requestRender();t.length=0}function ht(e){const t=e._globe,i=e.camera,s=i.positionCartographic;if(Object(p["a"])(t)&&t.show&&Object(p["a"])(s))return t.getHeight(s)}function lt(e){const t=e.camera,i=e._mode,s=e.globe,a=e._screenSpaceCameraController,o=t.positionCartographic;if(!Object(p["a"])(o))return!1;if(!a.onMap()&&o.height<0)return!0;if(!Object(p["a"])(s)||!s.show||i===ce["a"].SCENE2D||i===ce["a"].MORPHING)return!1;const n=e._globeHeight;return Object(p["a"])(n)&&o.height<n}function pt(e,t){if(e.debugShowFramesPerSecond){if(!Object(p["a"])(e._performanceDisplay)){const t=document.createElement("div");t.className="cesium-performanceDisplay-defaultContainer";const i=e._canvas.parentNode;i.appendChild(t);const s=new ie["a"]({container:t});e._performanceDisplay=s,e._performanceContainer=t}e._performanceDisplay.throttled=e.requestRenderMode,e._performanceDisplay.update(t)}else Object(p["a"])(e._performanceDisplay)&&(e._performanceDisplay=e._performanceDisplay&&e._performanceDisplay.destroy(),e._performanceContainer.parentNode.removeChild(e._performanceContainer))}function ft(e){e._jobScheduler.resetBudgets();const t=e._frameState,i=e.primitives;i.prePassesUpdate(t),Object(p["a"])(e.globe)&&e.globe.update(t),e._picking.update(),t.creditDisplay.update()}function _t(e){const t=e._frameState,i=e.primitives;i.postPassesUpdate(t),j["a"].update()}Se.prototype.updateEnvironment=function(){const e=this._frameState,t=this._view,i=this._environmentState,s=e.passes.render,a=e.passes.offscreen,o=this.skyAtmosphere,n=this.globe,r=this._globeTranslucencyState;if(!s||this._mode!==ce["a"].SCENE2D&&t.camera.frustum instanceof T["a"]||!r.environmentVisible)i.skyAtmosphereCommand=void 0,i.skyBoxCommand=void 0,i.sunDrawCommand=void 0,i.sunComputeCommand=void 0,i.moonCommand=void 0;else{Object(p["a"])(o)?(Object(p["a"])(n)&&(o.setDynamicAtmosphereColor(n.enableLighting&&n.dynamicAtmosphereLighting,n.dynamicAtmosphereLightingFromSun),i.isReadyForAtmosphere=i.isReadyForAtmosphere||n._surface._tilesToRender.length>0),i.skyAtmosphereCommand=o.update(e,n),Object(p["a"])(i.skyAtmosphereCommand)&&this.updateDerivedCommands(i.skyAtmosphereCommand)):i.skyAtmosphereCommand=void 0,i.skyBoxCommand=Object(p["a"])(this.skyBox)?this.skyBox.update(e,this._hdr):void 0;const s=Object(p["a"])(this.sun)?this.sun.update(e,t.passState,this._hdr):void 0;i.sunDrawCommand=Object(p["a"])(s)?s.drawCommand:void 0,i.sunComputeCommand=Object(p["a"])(s)?s.computeCommand:void 0,i.moonCommand=Object(p["a"])(this.moon)?this.moon.update(e):void 0}const c=i.clearGlobeDepth=Object(p["a"])(n)&&n.show&&(!n.depthTestAgainstTerrain||this.mode===ce["a"].SCENE2D),u=i.useDepthPlane=c&&this.mode===ce["a"].SCENE3D&&r.useDepthPlane;u&&this._depthPlane.update(e),i.renderTranslucentDepthForPick=!1,i.useWebVR=this._useWebVR&&this.mode!==ce["a"].SCENE2D&&!a;const m=e.mode!==ce["a"].SCENE3D||r.sunVisibleThroughGlobe?void 0:e.occluder;let d=e.cullingVolume;const h=nt.planes;for(let p=0;p<5;++p)h[p]=d.planes[p];d=nt,i.isSkyAtmosphereVisible=Object(p["a"])(i.skyAtmosphereCommand)&&i.isReadyForAtmosphere,i.isSunVisible=this.isVisible(i.sunDrawCommand,d,m),i.isMoonVisible=this.isVisible(i.moonCommand,d,m);const l=this.specularEnvironmentMaps;let f=this._specularEnvironmentMapAtlas;!Object(p["a"])(l)||Object(p["a"])(f)&&f.url===l?!Object(p["a"])(l)&&Object(p["a"])(f)&&(f.destroy(),this._specularEnvironmentMapAtlas=void 0):(f=f&&f.destroy(),this._specularEnvironmentMapAtlas=new te["a"](l)),Object(p["a"])(this._specularEnvironmentMapAtlas)&&this._specularEnvironmentMapAtlas.update(e)},Se.prototype.resolveFramebuffers=function(e){const t=this._context,i=this._environmentState,s=this._view,a=s.globeDepth;Object(p["a"])(a)&&a.prepareColorTextures(t);const o=i.useOIT,n=i.useGlobeDepthFramebuffer,r=i.usePostProcess,c=i.originalFramebuffer,u=n?a.colorFramebufferManager:void 0,m=s.sceneFramebuffer._colorFramebuffer,d=s.sceneFramebuffer.idFramebuffer;o&&(e.framebuffer=r?m.framebuffer:c,s.oit.execute(t,e));const h=s.translucentTileClassification;if(h.hasTranslucentDepth&&h.isSupported()&&h.execute(this,e),r){s.sceneFramebuffer.prepareColorTextures(t);let e=m;n&&!o&&(e=u);const i=this.postProcessStages,a=e.getColorTexture(0),r=d.getColorTexture(0),h=Object(l["a"])(u,m).getDepthStencilTexture();i.execute(t,a,h,r),i.copy(t,c)}o||r||!n||(e.framebuffer=c,a.executeCopyColor(t,e))},Se.prototype.initializeFrame=function(){120===this._shaderFrameCount++&&(this._shaderFrameCount=0,this._context.shaderCache.destroyReleasedShaderPrograms(),this._context.textureCache.destroyReleasedTextures()),this._tweens.update(),this._globeHeight=ht(this),this._cameraUnderground=lt(this),this._globeTranslucencyState.update(this),this._screenSpaceCameraController.update(),Object(p["a"])(this._deviceOrientationCameraController)&&this._deviceOrientationCameraController.update(),this.camera.update(this._mode),this.camera._updateCameraChanged()};const gt=new u["a"];function bt(e){const t=e._frameState,i=e.context,a=i.uniformState,o=e._defaultView;e._view=o,e.updateFrameState(),t.passes.render=!0,t.passes.postProcess=e.postProcessStages.hasSelected,t.tilesetPassState=De;let r=Object(l["a"])(e.backgroundColor,u["a"].BLACK);e._hdr&&(r=u["a"].clone(r,gt),r.red=Math.pow(r.red,e.gamma),r.green=Math.pow(r.green,e.gamma),r.blue=Math.pow(r.blue,e.gamma)),t.backgroundColor=r,e.fog.update(t),a.update(t);const c=e.shadowMap;Object(p["a"])(c)&&c.enabled&&(!Object(p["a"])(e.light)||e.light instanceof pe["a"]?n["a"].negate(a.sunDirectionWC,e._shadowMapCamera.direction):n["a"].clone(e.light.direction,e._shadowMapCamera.direction),t.shadowMaps.push(c)),e._computeCommandList.length=0,e._overlayCommandList.length=0;const m=o.viewport;m.x=0,m.y=0,m.width=i.drawingBufferWidth,m.height=i.drawingBufferHeight;const d=o.passState;d.framebuffer=void 0,d.blendingEnabled=void 0,d.scissorTest=void 0,d.viewport=s["a"].clone(m,d.viewport),Object(p["a"])(e.globe)&&e.globe.beginFrame(t),e.updateEnvironment(),e.updateAndExecuteCommands(d,r),e.resolveFramebuffers(d),d.framebuffer=void 0,qe(e,d),Object(p["a"])(e.globe)&&(e.globe.endFrame(t),e.globe.tilesLoaded||(e._renderRequested=!0)),i.endFrame()}function Ct(e,t){try{t(e)}catch(i){if(e._renderError.raiseEvent(e,i),e.rethrowRenderErrors)throw i}}function St(e){return e._picking.updateMostDetailedRayPicks(e)}function vt(e){const t=e._frameState;ye.camera=t.camera,ye.cullingVolume=t.cullingVolume;const i=e.primitives;i.updateForPass(t,ye)}function wt(e){const t=e._frameState,i=t.camera;if(!i.canPreloadFlight())return;Oe.camera=e.preloadFlightCamera,Oe.cullingVolume=e.preloadFlightCullingVolume;const s=e.primitives;s.updateForPass(t,Oe)}function Dt(e){e.primitives.updateForPass(e._frameState,xe)}Se.prototype.render=function(e){this._preUpdate.raiseEvent(this,e);const t=this._frameState;t.newFrame=!1,Object(p["a"])(e)||(e=w["a"].now());const i=this._view.checkForCameraUpdates(this);let s=!this.requestRenderMode||this._renderRequested||i||this._logDepthBufferDirty||this._hdrDirty||this.mode===ce["a"].MORPHING;if(!s&&Object(p["a"])(this.maximumRenderTimeChange)&&Object(p["a"])(this._lastRenderTime)){const t=Math.abs(w["a"].secondsDifference(this._lastRenderTime,e));s=s||t>this.maximumRenderTimeChange}if(s){this._lastRenderTime=w["a"].clone(e,this._lastRenderTime),this._renderRequested=!1,this._logDepthBufferDirty=!1,this._hdrDirty=!1;const i=D["a"].incrementWrap(t.frameNumber,15e6,1);Fe(this,i,e),t.newFrame=!0}Ct(this,ft),this.primitives.show&&(Ct(this,St),Ct(this,vt),Ct(this,wt),s||Ct(this,Dt)),this._postUpdate.raiseEvent(this,e),s&&(this._preRender.raiseEvent(this,e),t.creditDisplay.beginFrame(),Ct(this,bt)),pt(this,s),Ct(this,_t),dt(this),s&&(this._postRender.raiseEvent(this,e),t.creditDisplay.endFrame())},Se.prototype.forceRender=function(e){this._renderRequested=!0,this.render(e)},Se.prototype.requestRender=function(){this._renderRequested=!0},Se.prototype.clampLineWidth=function(e){return Math.max(A["a"].minimumAliasedLineWidth,Math.min(e,A["a"].maximumAliasedLineWidth))},Se.prototype.pick=function(e,t,i){return this._picking.pick(this,e,t,i)},Se.prototype.pickPositionWorldCoordinates=function(e,t){return this._picking.pickPositionWorldCoordinates(this,e,t)},Se.prototype.pickPosition=function(e,t){return this._picking.pickPosition(this,e,t)},Se.prototype.drillPick=function(e,t,i,s){return this._picking.drillPick(this,e,t,i,s)},Se.prototype.pickFromRay=function(e,t,i){return this._picking.pickFromRay(this,e,t,i)},Se.prototype.drillPickFromRay=function(e,t,i,s){return this._picking.drillPickFromRay(this,e,t,i,s)},Se.prototype.pickFromRayMostDetailed=function(e,t,i){return this._picking.pickFromRayMostDetailed(this,e,t,i)},Se.prototype.drillPickFromRayMostDetailed=function(e,t,i,s){return this._picking.drillPickFromRayMostDetailed(this,e,t,i,s)},Se.prototype.sampleHeight=function(e,t,i){return this._picking.sampleHeight(this,e,t,i)},Se.prototype.clampToHeight=function(e,t,i,s){return this._picking.clampToHeight(this,e,t,i,s)},Se.prototype.sampleHeightMostDetailed=function(e,t,i){return this._picking.sampleHeightMostDetailed(this,e,t,i)},Se.prototype.clampToHeightMostDetailed=function(e,t,i){return this._picking.clampToHeightMostDetailed(this,e,t,i)},Se.prototype.cartesianToCanvasCoordinates=function(e,t){return ue["a"].wgs84ToWindowCoordinates(this,e,t)},Se.prototype.completeMorph=function(){this._transitioner.completeMorph()},Se.prototype.morphTo2D=function(e){let t;const i=this.globe;t=Object(p["a"])(i)?i.ellipsoid:this.mapProjection.ellipsoid,e=Object(l["a"])(e,2),this._transitioner.morphTo2D(e,t)},Se.prototype.morphToColumbusView=function(e){let t;const i=this.globe;t=Object(p["a"])(i)?i.ellipsoid:this.mapProjection.ellipsoid,e=Object(l["a"])(e,2),this._transitioner.morphToColumbusView(e,t)},Se.prototype.morphTo3D=function(e){let t;const i=this.globe;t=Object(p["a"])(i)?i.ellipsoid:this.mapProjection.ellipsoid,e=Object(l["a"])(e,2),this._transitioner.morphTo3D(e,t)},Se.prototype.isDestroyed=function(){return!1},Se.prototype.destroy=function(){this._tweens.removeAll(),this._computeEngine=this._computeEngine&&this._computeEngine.destroy(),this._screenSpaceCameraController=this._screenSpaceCameraController&&this._screenSpaceCameraController.destroy(),this._deviceOrientationCameraController=this._deviceOrientationCameraController&&!this._deviceOrientationCameraController.isDestroyed()&&this._deviceOrientationCameraController.destroy(),this._primitives=this._primitives&&this._primitives.destroy(),this._groundPrimitives=this._groundPrimitives&&this._groundPrimitives.destroy(),this._globe=this._globe&&this._globe.destroy(),this.skyBox=this.skyBox&&this.skyBox.destroy(),this.skyAtmosphere=this.skyAtmosphere&&this.skyAtmosphere.destroy(),this._debugSphere=this._debugSphere&&this._debugSphere.destroy(),this.sun=this.sun&&this.sun.destroy(),this._sunPostProcess=this._sunPostProcess&&this._sunPostProcess.destroy(),this._depthPlane=this._depthPlane&&this._depthPlane.destroy(),this._transitioner=this._transitioner&&this._transitioner.destroy(),this._debugFrustumPlanes=this._debugFrustumPlanes&&this._debugFrustumPlanes.destroy(),this._brdfLutGenerator=this._brdfLutGenerator&&this._brdfLutGenerator.destroy(),this._picking=this._picking&&this._picking.destroy(),this._defaultView=this._defaultView&&this._defaultView.destroy(),this._view=void 0,this._removeCreditContainer&&this._canvas.parentNode.removeChild(this._creditContainer),this.postProcessStages=this.postProcessStages&&this.postProcessStages.destroy(),this._context=this._context&&this._context.destroy(),this._frameState.creditDisplay=this._frameState.creditDisplay&&this._frameState.creditDisplay.destroy(),Object(p["a"])(this._performanceDisplay)&&(this._performanceDisplay=this._performanceDisplay&&this._performanceDisplay.destroy(),this._performanceContainer.parentNode.removeChild(this._performanceContainer)),this._removeRequestListenerCallback(),this._removeTaskProcessorListenerCallback();for(let e=0;e<this._removeGlobeCallbacks.length;++e)this._removeGlobeCallbacks[e]();return this._removeGlobeCallbacks.length=0,Object(f["a"])(this)},t["a"]=Se}}]);