(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["Cesium~fa5071d0"],{"1deb":function(e,t,a){"use strict";var r=a("cef5"),i=a("7229"),n=a("be18"),o=a("bef8"),s=a("bd8d"),c=a("535a"),u=a("2f63"),l=a("7d62"),d=a("c52f"),h=a("204a"),p=a("21d7"),m=a("5410"),f=a("6dfc"),g=a("2ac3"),_=a("eace"),y=a("d4ed"),b=a("5770"),T=a("a913"),C=a("7b51"),S=a("a252"),A=a("b0df"),v=a("fe19"),x=a("fe57"),E=a("e90c"),O=a("0249"),D=a("a307");function F(e,t,a,r,i){this.numberOfDayTextures=e,this.flags=t,this.material=a,this.shaderProgram=r,this.clippingShaderState=i}function w(){this.baseVertexShaderSource=void 0,this.baseFragmentShaderSource=void 0,this._shadersByTexturesFlags=[],this.material=void 0}function R(e){const t="vec4 getPosition(vec3 position, float height, vec2 textureCoordinates) { return getPosition3DMode(position, height, textureCoordinates); }",a="vec4 getPosition(vec3 position, float height, vec2 textureCoordinates) { return getPositionColumbusViewMode(position, height, textureCoordinates); }",r="vec4 getPosition(vec3 position, float height, vec2 textureCoordinates) { return getPositionMorphingMode(position, height, textureCoordinates); }";let i;switch(e){case D["a"].SCENE3D:i=t;break;case D["a"].SCENE2D:case D["a"].COLUMBUS_VIEW:i=a;break;case D["a"].MORPHING:i=r;break}return i}function L(e){const t="float get2DYPositionFraction(vec2 textureCoordinates) { return get2DGeographicYPositionFraction(textureCoordinates); }",a="float get2DYPositionFraction(vec2 textureCoordinates) { return get2DMercatorYPositionFraction(textureCoordinates); }";return e?a:t}w.prototype.getShaderProgram=function(e){const t=e.frameState,a=e.surfaceTile,r=e.numberOfDayTextures,i=e.applyBrightness,n=e.applyContrast,o=e.applyHue,s=e.applySaturation,c=e.applyGamma,l=e.applyAlpha,d=e.applyDayNightAlpha,h=e.applySplit,p=e.showReflectiveOcean,m=e.showOceanWaves,f=e.enableLighting,g=e.dynamicAtmosphereLighting,_=e.dynamicAtmosphereLightingFromSun,y=e.showGroundAtmosphere,b=e.perFragmentGroundAtmosphere,T=e.hasVertexNormals,C=e.useWebMercatorProjection,S=e.enableFog,A=e.enableClippingPlanes,v=e.clippingPlanes,D=e.clippedByBoundaries,w=e.hasImageryLayerCutout,N=e.colorCorrect,M=e.highlightFillTile,P=e.colorToAlpha,I=e.hasGeodeticSurfaceNormals,B=e.hasExaggeration,j=e.showUndergroundColor,H=e.translucent;let k=0,U="";const G=a.renderedMesh,V=G.encoding,z=V.quantization;z===x["a"].BITS12&&(k=1,U="QUANTIZATION_BITS12");let W=0,Y="";D&&(W=1,Y="TILE_LIMIT_RECTANGLE");let q=0,K="";w&&(q=1,K="APPLY_IMAGERY_CUTOUT");const $=t.mode,Q=$|i<<2|n<<3|o<<4|s<<5|c<<6|l<<7|p<<8|m<<9|f<<10|g<<11|_<<12|y<<13|b<<14|T<<15|C<<16|S<<17|k<<18|h<<19|A<<20|W<<21|q<<22|N<<23|M<<24|P<<25|I<<26|B<<27|j<<28|H<<29|d<<30;let X=0;Object(u["a"])(v)&&v.length>0&&(X=A?v.clippingPlanesState:0);let Z=a.surfaceShader;if(Object(u["a"])(Z)&&Z.numberOfDayTextures===r&&Z.flags===Q&&Z.material===this.material&&Z.clippingShaderState===X)return Z.shaderProgram;let J=this._shadersByTexturesFlags[r];if(Object(u["a"])(J)||(J=this._shadersByTexturesFlags[r]=[]),Z=J[Q],!Object(u["a"])(Z)||Z.material!==this.material||Z.clippingShaderState!==X){const e=this.baseVertexShaderSource.clone(),a=this.baseFragmentShaderSource.clone();0!==X&&a.sources.unshift(Object(O["a"])(v,t.context)),e.defines.push(U),a.defines.push("TEXTURE_UNITS "+r,Y,K),i&&a.defines.push("APPLY_BRIGHTNESS"),n&&a.defines.push("APPLY_CONTRAST"),o&&a.defines.push("APPLY_HUE"),s&&a.defines.push("APPLY_SATURATION"),c&&a.defines.push("APPLY_GAMMA"),l&&a.defines.push("APPLY_ALPHA"),d&&a.defines.push("APPLY_DAY_NIGHT_ALPHA"),p&&(a.defines.push("SHOW_REFLECTIVE_OCEAN"),e.defines.push("SHOW_REFLECTIVE_OCEAN")),m&&a.defines.push("SHOW_OCEAN_WAVES"),P&&a.defines.push("APPLY_COLOR_TO_ALPHA"),j&&(e.defines.push("UNDERGROUND_COLOR"),a.defines.push("UNDERGROUND_COLOR")),H&&(e.defines.push("TRANSLUCENT"),a.defines.push("TRANSLUCENT")),f&&(T?(e.defines.push("ENABLE_VERTEX_LIGHTING"),a.defines.push("ENABLE_VERTEX_LIGHTING")):(e.defines.push("ENABLE_DAYNIGHT_SHADING"),a.defines.push("ENABLE_DAYNIGHT_SHADING"))),g&&(e.defines.push("DYNAMIC_ATMOSPHERE_LIGHTING"),a.defines.push("DYNAMIC_ATMOSPHERE_LIGHTING"),_&&(e.defines.push("DYNAMIC_ATMOSPHERE_LIGHTING_FROM_SUN"),a.defines.push("DYNAMIC_ATMOSPHERE_LIGHTING_FROM_SUN"))),y&&(e.defines.push("GROUND_ATMOSPHERE"),a.defines.push("GROUND_ATMOSPHERE"),b&&(e.defines.push("PER_FRAGMENT_GROUND_ATMOSPHERE"),a.defines.push("PER_FRAGMENT_GROUND_ATMOSPHERE"))),e.defines.push("INCLUDE_WEB_MERCATOR_Y"),a.defines.push("INCLUDE_WEB_MERCATOR_Y"),S&&(e.defines.push("FOG"),a.defines.push("FOG")),h&&a.defines.push("APPLY_SPLIT"),A&&a.defines.push("ENABLE_CLIPPING_PLANES"),N&&a.defines.push("COLOR_CORRECT"),M&&a.defines.push("HIGHLIGHT_FILL_TILE"),I&&e.defines.push("GEODETIC_SURFACE_NORMALS"),B&&e.defines.push("EXAGGERATION");let u="    vec4 computeDayColor(vec4 initialColor, vec3 textureCoordinates, float nightBlend)\n    {\n        vec4 color = initialColor;\n";w&&(u+="        vec4 cutoutAndColorResult;\n        bool texelUnclipped;\n");for(let t=0;t<r;++t)u+=w?`        cutoutAndColorResult = u_dayTextureCutoutRectangles[${t}];\n        texelUnclipped = v_textureCoordinates.x < cutoutAndColorResult.x || cutoutAndColorResult.z < v_textureCoordinates.x || v_textureCoordinates.y < cutoutAndColorResult.y || cutoutAndColorResult.w < v_textureCoordinates.y;\n        cutoutAndColorResult = sampleAndBlend(\n`:"        color = sampleAndBlend(\n",u+=`            color,\n            u_dayTextures[${t}],\n            u_dayTextureUseWebMercatorT[${t}] ? textureCoordinates.xz : textureCoordinates.xy,\n            u_dayTextureTexCoordsRectangle[${t}],\n            u_dayTextureTranslationAndScale[${t}],\n            ${l?`u_dayTextureAlpha[${t}]`:"1.0"},\n            ${d?`u_dayTextureNightAlpha[${t}]`:"1.0"},\n${d?`u_dayTextureDayAlpha[${t}]`:"1.0"},\n${i?`u_dayTextureBrightness[${t}]`:"0.0"},\n            ${n?`u_dayTextureContrast[${t}]`:"0.0"},\n            ${o?`u_dayTextureHue[${t}]`:"0.0"},\n            ${s?`u_dayTextureSaturation[${t}]`:"0.0"},\n            ${c?`u_dayTextureOneOverGamma[${t}]`:"0.0"},\n            ${h?`u_dayTextureSplit[${t}]`:"0.0"},\n            ${P?`u_colorsToAlpha[${t}]`:"vec4(0.0)"},\n        nightBlend        );\n`,w&&(u+="        color = czm_branchFreeTernary(texelUnclipped, cutoutAndColorResult, color);\n");u+="        return color;\n    }",a.sources.push(u),e.sources.push(R($)),e.sources.push(L(C));const x=E["a"].fromCache({context:t.context,vertexShaderSource:e,fragmentShaderSource:a,attributeLocations:V.getAttributeLocations()});Z=J[Q]=new F(r,Q,this.material,x,X)}return a.surfaceShader=Z,Z.shaderProgram},w.prototype.destroy=function(){let e,t;const a=this._shadersByTexturesFlags;for(const r in a)if(a.hasOwnProperty(r)){const i=a[r];if(!Object(u["a"])(i))continue;for(e in i)i.hasOwnProperty(e)&&(t=i[e],Object(u["a"])(t)&&t.shaderProgram.destroy())}return Object(l["a"])(this)};var N=w,M=a("b081"),P=a("670c"),I=a("a561"),B=a("dc1c"),j=a("9541"),H=a("2bb9"),k=a("d940"),U=a("c1e2"),G=a("0123"),V=a("66bf"),z=a("93da"),W=a("52f0"),Y=a("78e5"),q=a("713f"),K=a("1b8d"),$=a("98f6"),Q=a("c698"),X=a("2368"),Z=a("1184"),J=a("f20a"),ee=a("8b68"),te=a("b997"),ae=a("a894"),re=a("d289"),ie=a("6dc0"),ne=a("7c5e"),oe=a("b7c8"),se=a("43ee"),ce=a("06f0"),ue=a("2856"),le=a("ad4a"),de=a("dddf"),he=a("3a8e"),pe=a("894b"),me=a("f1b3"),fe=a("c86b"),ge=a("2221"),_e=a("4c22"),ye=a("1ec0"),be=a("ee78");function Te(e){this.lightingFadeOutDistance=65e5,this.lightingFadeInDistance=9e6,this.hasWaterMask=!1,this.oceanNormalMap=void 0,this.zoomedOutOceanSpecularIntensity=.5,this.enableLighting=!1,this.dynamicAtmosphereLighting=!1,this.dynamicAtmosphereLightingFromSun=!1,this.showGroundAtmosphere=!1,this.shadows=fe["a"].RECEIVE_ONLY,this.fillHighlightColor=void 0,this.hueShift=0,this.saturationShift=0,this.brightnessShift=0,this.showSkirts=!0,this.backFaceCulling=!0,this.undergroundColor=void 0,this.undergroundColorAlphaByDistance=void 0,this.lambertDiffuseMultiplier=0,this.materialUniformMap=void 0,this._materialUniformMap=void 0,this._quadtree=void 0,this._terrainProvider=e.terrainProvider,this._imageryLayers=e.imageryLayers,this._surfaceShaderSet=e.surfaceShaderSet,this._renderState=void 0,this._blendRenderState=void 0,this._disableCullingRenderState=void 0,this._disableCullingBlendRenderState=void 0,this._errorEvent=new p["a"],this._imageryLayers.layerAdded.addEventListener(Te.prototype._onLayerAdded,this),this._imageryLayers.layerRemoved.addEventListener(Te.prototype._onLayerRemoved,this),this._imageryLayers.layerMoved.addEventListener(Te.prototype._onLayerMoved,this),this._imageryLayers.layerShownOrHidden.addEventListener(Te.prototype._onLayerShownOrHidden,this),this._imageryLayersUpdatedEvent=new p["a"],this._layerOrderChanged=!1,this._tilesToRenderByTextureCount=[],this._drawCommands=[],this._uniformMaps=[],this._usedDrawCommands=0,this._vertexArraysToDestroy=[],this._debug={wireframe:!1,boundingSphereTile:void 0},this._baseColor=void 0,this._firstPassInitialColor=void 0,this.baseColor=new s["a"](0,0,.5,1),this._clippingPlanes=void 0,this.cartographicLimitRectangle=_["a"].clone(_["a"].MAX_VALUE),this._hasLoadedTilesThisFrame=!1,this._hasFillTilesThisFrame=!1,this._oldTerrainExaggeration=void 0,this._oldTerrainExaggerationRelativeHeight=void 0}function Ce(e,t){let a=e.loadingImagery;Object(u["a"])(a)||(a=e.readyImagery);let r=t.loadingImagery;return Object(u["a"])(r)||(r=t.readyImagery),a.imageryLayer._layerIndex-r.imageryLayer._layerIndex}function Se(e,t){const a=t.creditDisplay;e._terrainProvider.ready&&Object(u["a"])(e._terrainProvider.credit)&&a.addCredit(e._terrainProvider.credit);const r=e._imageryLayers;for(let i=0,n=r.length;i<n;++i){const e=r.get(i).imageryProvider;e.ready&&Object(u["a"])(e.credit)&&a.addCredit(e.credit)}}function Ae(e,t){const a=t.globeTranslucencyState;if(a.translucent){const r=e.renderState.blending.enabled;a.pushDerivedCommands(e,r,t)}else t.commandList.push(e)}Object.defineProperties(Te.prototype,{baseColor:{get:function(){return this._baseColor},set:function(e){this._baseColor=e,this._firstPassInitialColor=I["a"].fromColor(e,this._firstPassInitialColor)}},quadtree:{get:function(){return this._quadtree},set:function(e){this._quadtree=e}},ready:{get:function(){return this._terrainProvider.ready&&(0===this._imageryLayers.length||this._imageryLayers.get(0).imageryProvider.ready)}},tilingScheme:{get:function(){return this._terrainProvider.tilingScheme}},errorEvent:{get:function(){return this._errorEvent}},imageryLayersUpdatedEvent:{get:function(){return this._imageryLayersUpdatedEvent}},terrainProvider:{get:function(){return this._terrainProvider},set:function(e){this._terrainProvider!==e&&(this._terrainProvider=e,Object(u["a"])(this._quadtree)&&this._quadtree.invalidateAllTiles())}},clippingPlanes:{get:function(){return this._clippingPlanes},set:function(e){se["a"].setOwner(e,this,"_clippingPlanes")}}}),Te.prototype.update=function(e){this._imageryLayers._update()},Te.prototype.initialize=function(e){this._imageryLayers.queueReprojectionCommands(e),this._layerOrderChanged&&(this._layerOrderChanged=!1,this._quadtree.forEachLoadedTile((function(e){e.data.imagery.sort(Ce)}))),Se(this,e);const t=this._vertexArraysToDestroy,a=t.length;for(let r=0;r<a;++r)ue["a"]._freeVertexArray(t[r]);t.length=0},Te.prototype.beginUpdate=function(e){const t=this._tilesToRenderByTextureCount;for(let r=0,i=t.length;r<i;++r){const e=t[r];Object(u["a"])(e)&&(e.length=0)}const a=this._clippingPlanes;Object(u["a"])(a)&&a.enabled&&a.update(e),this._usedDrawCommands=0,this._hasLoadedTilesThisFrame=!1,this._hasFillTilesThisFrame=!1},Te.prototype.endUpdate=function(e){if(!Object(u["a"])(this._renderState)){this._renderState=ie["a"].fromCache({cull:{enabled:!0},depthTest:{enabled:!0,func:ce["a"].LESS}}),this._blendRenderState=ie["a"].fromCache({cull:{enabled:!0},depthTest:{enabled:!0,func:ce["a"].LESS_OR_EQUAL},blending:oe["a"].ALPHA_BLEND});let e=Object(B["a"])(this._renderState,!0);e.cull.enabled=!1,this._disableCullingRenderState=ie["a"].fromCache(e),e=Object(B["a"])(this._blendRenderState,!0),e.cull.enabled=!1,this._disableCullingBlendRenderState=ie["a"].fromCache(e)}this._hasFillTilesThisFrame&&this._hasLoadedTilesThisFrame&&ge["a"].updateFillTiles(this,this._quadtree._tilesToRender,e,this._vertexArraysToDestroy);const t=this.quadtree,a=e.terrainExaggeration,r=e.terrainExaggerationRelativeHeight,i=this._oldTerrainExaggeration!==a||this._oldTerrainExaggerationRelativeHeight!==r;this._oldTerrainExaggeration=a,this._oldTerrainExaggerationRelativeHeight=r,i&&t.forEachLoadedTile((function(a){const r=a.data;r.updateExaggeration(a,e,t)}));const n=this._tilesToRenderByTextureCount;for(let o=0,s=n.length;o<s;++o){const t=n[o];if(Object(u["a"])(t))for(let a=0,r=t.length;a<r;++a){const r=t[a],i=r.data.tileBoundingRegion;it(this,r,e),e.minimumTerrainHeight=Math.min(e.minimumTerrainHeight,i.minimumHeight)}}},Te.prototype.updateForPick=function(e){const t=this._drawCommands;for(let a=0,r=this._usedDrawCommands;a<r;++a)Ae(t[a],e)},Te.prototype.cancelReprojections=function(){this._imageryLayers.cancelReprojections()},Te.prototype.getLevelMaximumGeometricError=function(e){return this._terrainProvider.getLevelMaximumGeometricError(e)},Te.prototype.loadTile=function(e,t){let a,r=t.data,i=!0;Object(u["a"])(r)&&(i=r.boundingVolumeSourceTile!==t||t._lastSelectionResult===be["a"].CULLED_BUT_NEEDED,a=r.terrainState),ue["a"].processStateMachine(t,e,this.terrainProvider,this._imageryLayers,this.quadtree,this._vertexArraysToDestroy,i),r=t.data,i&&a!==t.data.terrainState&&this.computeTileVisibility(t,e,this.quadtree.occluders)!==X["a"].NONE&&r.boundingVolumeSourceTile===t&&(i=!1,ue["a"].processStateMachine(t,e,this.terrainProvider,this._imageryLayers,this.quadtree,this._vertexArraysToDestroy,i))};const ve=new r["a"],xe=new _["a"],Ee=new _["a"],Oe=new o["a"];function De(e,t){if(t.west<t.east)return t;const a=_["a"].clone(t,Ee),r=_["a"].center(e,Oe);return r.longitude>0?a.east=z["a"].PI:a.west=-z["a"].PI,a}function Fe(e,t){if(t.cameraUnderground)return!0;if(t.globeTranslucencyState.translucent)return!0;if(e.backFaceCulling)return!1;const a=e._clippingPlanes;return!(!Object(u["a"])(a)||!a.enabled)||!_["a"].equals(e.cartographicLimitRectangle,_["a"].MAX_VALUE)}Te.prototype.computeTileVisibility=function(e,t,a){const i=this.computeDistanceToTile(e,t);e._distance=i;const o=Fe(this,t);if(t.fog.enabled&&!o&&z["a"].fog(i,t.fog.density)>=1)return X["a"].NONE;const s=e.data,c=s.tileBoundingRegion;if(void 0===s.boundingVolumeSourceTile)return X["a"].PARTIAL;const l=t.cullingVolume;let d=c.boundingVolume;Object(u["a"])(d)||(d=c.boundingSphere),s.clippedByBoundaries=!1;const h=De(e.rectangle,this.cartographicLimitRectangle),p=_["a"].simpleIntersection(h,e.rectangle,xe);if(!Object(u["a"])(p))return X["a"].NONE;if(_["a"].equals(p,e.rectangle)||(s.clippedByBoundaries=!0),t.mode!==D["a"].SCENE3D&&(d=ve,r["a"].fromRectangleWithHeights2D(e.rectangle,t.mapProjection,c.minimumHeight,c.maximumHeight,d),n["a"].fromElements(d.center.z,d.center.x,d.center.y,d.center),t.mode===D["a"].MORPHING&&Object(u["a"])(s.renderedMesh)&&(d=r["a"].union(c.boundingSphere,d,d))),!Object(u["a"])(d))return X["a"].PARTIAL;const m=this._clippingPlanes;if(Object(u["a"])(m)&&m.enabled){const t=m.computeIntersectionWithBoundingVolume(d);if(e.isClipped=t!==V["a"].INSIDE,t===V["a"].OUTSIDE)return X["a"].NONE}let f;const g=l.computeVisibility(d);if(g===V["a"].OUTSIDE?f=X["a"].NONE:g===V["a"].INTERSECTING?f=X["a"].PARTIAL:g===V["a"].INSIDE&&(f=X["a"].FULL),f===X["a"].NONE)return f;const y=t.mode===D["a"].SCENE3D&&t.camera.frustum instanceof q["a"];if(t.mode===D["a"].SCENE3D&&!y&&Object(u["a"])(a)&&!o){const e=s.occludeePointInScaledSpace;return Object(u["a"])(e)?a.ellipsoid.isScaledSpacePointVisiblePossiblyUnderEllipsoid(e,c.minimumHeight)?f:X["a"].NONE:f}return f},Te.prototype.canRefine=function(e){if(Object(u["a"])(e.data.terrainData))return!0;const t=this.terrainProvider.getTileDataAvailable(2*e.x,2*e.y,e.level+1);return void 0!==t};const we=[],Re=[];Te.prototype.canRenderWithoutLosingDetail=function(e,t){const a=e.data,r=we;r.length=this._imageryLayers.length;let i,n,o,s=!1,c=!1;for(Object(u["a"])(a)&&(s=a.terrainState===_e["a"].READY,c=!0,i=a.imagery),n=0,o=r.length;n<o;++n)r[n]=c;if(Object(u["a"])(i))for(n=0,o=i.length;n<o;++n){const e=i[n],t=e.loadingImagery,a=!Object(u["a"])(t)||t.state===de["a"].FAILED||t.state===de["a"].INVALID,o=(e.loadingImagery||e.readyImagery).imageryLayer._layerIndex;r[o]=a&&r[o]}const l=this.quadtree._lastSelectionFrameNumber,d=Re;d.length=0,d.push(e.southwestChild,e.southeastChild,e.northwestChild,e.northeastChild);while(d.length>0){const e=d.pop(),t=e._lastSelectionResultFrame===l?e._lastSelectionResult:be["a"].NONE;if(t===be["a"].RENDERED){const t=e.data;if(!Object(u["a"])(t))continue;if(!s&&e.data.terrainState===_e["a"].READY)return!1;const a=e.data.imagery;for(n=0,o=a.length;n<o;++n){const e=a[n],t=e.loadingImagery,i=!Object(u["a"])(t)||t.state===de["a"].FAILED||t.state===de["a"].INVALID,o=(e.loadingImagery||e.readyImagery).imageryLayer._layerIndex;if(i&&!r[o])return!1}}else t===be["a"].REFINED&&d.push(e.southwestChild,e.southeastChild,e.northwestChild,e.northeastChild)}return!0};const Le=new n["a"];Te.prototype.computeTileLoadPriority=function(e,t){const a=e.data;if(void 0===a)return 0;const r=a.tileBoundingRegion.boundingVolume;if(void 0===r)return 0;const i=t.camera.positionWC,o=t.camera.directionWC,s=n["a"].subtract(r.center,i,Le),c=n["a"].magnitude(s);return c<z["a"].EPSILON5?0:(n["a"].divideByScalar(s,c,s),(1-n["a"].dot(s,o))*e._distance)};const Ne=new W["a"],Me=new W["a"],Pe=new I["a"],Ie=new I["a"],Be=new I["a"],je=new n["a"],He=new n["a"],ke=new n["a"],Ue=new n["a"];Te.prototype.showTileThisFrame=function(e,t){let a=0;const r=e.data.imagery;for(let s=0,c=r.length;s<c;++s){const e=r[s];Object(u["a"])(e.readyImagery)&&0!==e.readyImagery.imageryLayer.alpha&&++a}let i=this._tilesToRenderByTextureCount[a];Object(u["a"])(i)||(i=[],this._tilesToRenderByTextureCount[a]=i),i.push(e);const n=e.data;Object(u["a"])(n.vertexArray)?this._hasLoadedTilesThisFrame=!0:this._hasFillTilesThisFrame=!0;const o=this._debug;++o.tilesRendered,o.texturesRendered+=a};const Ge=[new n["a"],new n["a"],new n["a"],new n["a"]];function Ve(e,t,a,r,i,o){const s=e.quadtree._occluders.ellipsoid,c=s.ellipsoid,u=Ge;return n["a"].fromRadians(a.west,a.south,i,c,u[0]),n["a"].fromRadians(a.east,a.south,i,c,u[1]),n["a"].fromRadians(a.west,a.north,i,c,u[2]),n["a"].fromRadians(a.east,a.north,i,c,u[3]),s.computeHorizonCullingPointPossiblyUnderEllipsoid(t,u,r,o)}function ze(e,t,a){let i=e.data;void 0===i&&(i=e.data=new ue["a"]);const o=e.tilingScheme.ellipsoid;void 0===i.tileBoundingRegion&&(i.tileBoundingRegion=new ye["a"]({computeBoundingVolumes:!1,rectangle:e.rectangle,ellipsoid:o,minimumHeight:0,maximumHeight:0}));const s=i.tileBoundingRegion,c=s.minimumHeight,l=s.maximumHeight;let d=!1,h=e;const p=i.mesh,m=i.terrainData;if(void 0!==p&&void 0!==p.minimumHeight&&void 0!==p.maximumHeight)s.minimumHeight=p.minimumHeight,s.maximumHeight=p.maximumHeight,d=!0;else if(void 0!==m&&void 0!==m._minimumHeight&&void 0!==m._maximumHeight)s.minimumHeight=m._minimumHeight,s.maximumHeight=m._maximumHeight;else{s.minimumHeight=Number.NaN,s.maximumHeight=Number.NaN;let t=e.parent;while(void 0!==t){const e=t.data;if(void 0!==e){const t=e.mesh,a=e.terrainData;if(void 0!==t&&void 0!==t.minimumHeight&&void 0!==t.maximumHeight){s.minimumHeight=t.minimumHeight,s.maximumHeight=t.maximumHeight;break}if(void 0!==a&&void 0!==a._minimumHeight&&void 0!==a._maximumHeight){s.minimumHeight=a._minimumHeight,s.maximumHeight=a._maximumHeight;break}}t=t.parent}h=t}if(void 0!==h){const m=a.terrainExaggeration,f=a.terrainExaggerationRelativeHeight,g=1!==m;if(g&&(d=!1,s.minimumHeight=Q["a"].getHeight(s.minimumHeight,m,f),s.maximumHeight=Q["a"].getHeight(s.maximumHeight,m,f)),d)i.boundingVolumeIsFromMesh||(s._orientedBoundingBox=Y["a"].clone(p.orientedBoundingBox,s._orientedBoundingBox),s._boundingSphere=r["a"].clone(p.boundingSphere3D,s._boundingSphere),i.occludeePointInScaledSpace=n["a"].clone(p.occludeePointInScaledSpace,i.occludeePointInScaledSpace),Object(u["a"])(i.occludeePointInScaledSpace)||(i.occludeePointInScaledSpace=Ve(t,s._orientedBoundingBox.center,e.rectangle,s.minimumHeight,s.maximumHeight,i.occludeePointInScaledSpace)));else{const a=void 0===s._orientedBoundingBox||void 0===s._boundingSphere,r=s.minimumHeight!==c||s.maximumHeight!==l;(r||a)&&(s.computeBoundingVolumes(o),i.occludeePointInScaledSpace=Ve(t,s._orientedBoundingBox.center,e.rectangle,s.minimumHeight,s.maximumHeight,i.occludeePointInScaledSpace))}i.boundingVolumeSourceTile=h,i.boundingVolumeIsFromMesh=d}else i.boundingVolumeSourceTile=void 0,i.boundingVolumeIsFromMesh=!1}function We(e,t,a){return function(r){let i,n,o=-1;const s=r.data.imagery,l=s.length;let d;for(d=0;d<l;++d)if(i=s[d],n=Object(c["a"])(i.readyImagery,i.loadingImagery),n.imageryLayer===t){o=d;break}if(-1!==o){const l=o+e;if(i=s[l],n=Object(u["a"])(i)?Object(c["a"])(i.readyImagery,i.loadingImagery):void 0,!Object(u["a"])(n)||n.imageryLayer!==t)return!t._createTileImagerySkeletons(r,a,l);for(d=o;d<l;++d)s[d].freeResources();s.splice(o,e)}return!0}}Te.prototype.computeDistanceToTile=function(e,t){ze(e,this,t);const a=e.data,r=a.boundingVolumeSourceTile;if(void 0===r)return 9999999999;const i=a.tileBoundingRegion,n=i.minimumHeight,o=i.maximumHeight;if(a.boundingVolumeSourceTile!==e){const e=t.camera.positionCartographic.height,a=Math.abs(e-n),r=Math.abs(e-o);a>r?(i.minimumHeight=n,i.maximumHeight=n):(i.minimumHeight=o,i.maximumHeight=o)}const s=i.distanceToCamera(t);return i.minimumHeight=n,i.maximumHeight=o,s},Te.prototype.isDestroyed=function(){return!1},Te.prototype.destroy=function(){return this._tileProvider=this._tileProvider&&this._tileProvider.destroy(),this._clippingPlanes=this._clippingPlanes&&this._clippingPlanes.destroy(),Object(l["a"])(this)},Te.prototype._onLayerAdded=function(e,t){if(e.show){const t=this._terrainProvider,a=this,r=e.imageryProvider,i=this._imageryLayersUpdatedEvent;r._reload=function(){e._imageryCache={},a._quadtree.forEachLoadedTile((function(a){if(Object(u["a"])(a._loadedCallbacks[e._layerIndex]))return;let r;const i=a.data.imagery,n=i.length;let o=-1,s=0;for(r=0;r<n;++r){const t=i[r],a=Object(c["a"])(t.readyImagery,t.loadingImagery);if(a.imageryLayer===e)-1===o&&(o=r),++s;else if(-1!==o)break}if(-1===o)return;const l=o+s;e._createTileImagerySkeletons(a,t,l)&&(a._loadedCallbacks[e._layerIndex]=We(s,e,t),a.state=me["a"].LOADING)}))},this._quadtree.forEachLoadedTile((function(r){e._createTileImagerySkeletons(r,t)&&(r.state=me["a"].LOADING,0===r.level||r._lastSelectionResultFrame===a.quadtree._lastSelectionFrameNumber&&r._lastSelectionResult===be["a"].RENDERED||(r.renderable=!1))})),this._layerOrderChanged=!0,i.raiseEvent()}},Te.prototype._onLayerRemoved=function(e,t){this._quadtree.forEachLoadedTile((function(t){const a=t.data.imagery;let r=-1,i=0;for(let n=0,o=a.length;n<o;++n){const t=a[n];let o=t.loadingImagery;if(Object(u["a"])(o)||(o=t.readyImagery),o.imageryLayer===e)-1===r&&(r=n),t.freeResources(),++i;else if(-1!==r)break}-1!==r&&a.splice(r,i)})),Object(u["a"])(e.imageryProvider)&&(e.imageryProvider._reload=void 0),this._imageryLayersUpdatedEvent.raiseEvent()},Te.prototype._onLayerMoved=function(e,t,a){this._layerOrderChanged=!0,this._imageryLayersUpdatedEvent.raiseEvent()},Te.prototype._onLayerShownOrHidden=function(e,t,a){a?this._onLayerAdded(e,t):this._onLayerRemoved(e,t)};const Ye=new W["a"],qe=new W["a"];function Ke(e,t){const a={u_initialColor:function(){return this.properties.initialColor},u_fillHighlightColor:function(){return this.properties.fillHighlightColor},u_zoomedOutOceanSpecularIntensity:function(){return this.properties.zoomedOutOceanSpecularIntensity},u_oceanNormalMap:function(){return this.properties.oceanNormalMap},u_atmosphereLightIntensity:function(){return this.properties.atmosphereLightIntensity},u_atmosphereRayleighCoefficient:function(){return this.properties.atmosphereRayleighCoefficient},u_atmosphereMieCoefficient:function(){return this.properties.atmosphereMieCoefficient},u_atmosphereRayleighScaleHeight:function(){return this.properties.atmosphereRayleighScaleHeight},u_atmosphereMieScaleHeight:function(){return this.properties.atmosphereMieScaleHeight},u_atmosphereMieAnisotropy:function(){return this.properties.atmosphereMieAnisotropy},u_lightingFadeDistance:function(){return this.properties.lightingFadeDistance},u_nightFadeDistance:function(){return this.properties.nightFadeDistance},u_center3D:function(){return this.properties.center3D},u_terrainExaggerationAndRelativeHeight:function(){return this.properties.terrainExaggerationAndRelativeHeight},u_tileRectangle:function(){return this.properties.tileRectangle},u_modifiedModelView:function(){const t=e.context.uniformState.view,a=W["a"].multiplyByPoint(t,this.properties.rtc,He);return W["a"].setTranslation(t,a,Ne),Ne},u_modifiedModelViewProjection:function(){const t=e.context.uniformState.view,a=e.context.uniformState.projection,r=W["a"].multiplyByPoint(t,this.properties.rtc,He);return W["a"].setTranslation(t,r,Me),W["a"].multiply(a,Me,Me),Me},u_dayTextures:function(){return this.properties.dayTextures},u_dayTextureTranslationAndScale:function(){return this.properties.dayTextureTranslationAndScale},u_dayTextureTexCoordsRectangle:function(){return this.properties.dayTextureTexCoordsRectangle},u_dayTextureUseWebMercatorT:function(){return this.properties.dayTextureUseWebMercatorT},u_dayTextureAlpha:function(){return this.properties.dayTextureAlpha},u_dayTextureNightAlpha:function(){return this.properties.dayTextureNightAlpha},u_dayTextureDayAlpha:function(){return this.properties.dayTextureDayAlpha},u_dayTextureBrightness:function(){return this.properties.dayTextureBrightness},u_dayTextureContrast:function(){return this.properties.dayTextureContrast},u_dayTextureHue:function(){return this.properties.dayTextureHue},u_dayTextureSaturation:function(){return this.properties.dayTextureSaturation},u_dayTextureOneOverGamma:function(){return this.properties.dayTextureOneOverGamma},u_dayIntensity:function(){return this.properties.dayIntensity},u_southAndNorthLatitude:function(){return this.properties.southAndNorthLatitude},u_southMercatorYAndOneOverHeight:function(){return this.properties.southMercatorYAndOneOverHeight},u_waterMask:function(){return this.properties.waterMask},u_waterMaskTranslationAndScale:function(){return this.properties.waterMaskTranslationAndScale},u_minMaxHeight:function(){return this.properties.minMaxHeight},u_scaleAndBias:function(){return this.properties.scaleAndBias},u_dayTextureSplit:function(){return this.properties.dayTextureSplit},u_dayTextureCutoutRectangles:function(){return this.properties.dayTextureCutoutRectangles},u_clippingPlanes:function(){const a=t._clippingPlanes;return Object(u["a"])(a)&&Object(u["a"])(a.texture)?a.texture:e.context.defaultTexture},u_cartographicLimitRectangle:function(){return this.properties.localizedCartographicLimitRectangle},u_clippingPlanesMatrix:function(){const a=t._clippingPlanes,r=Object(u["a"])(a)?W["a"].multiply(e.context.uniformState.view,a.modelMatrix,Ye):W["a"].IDENTITY;return W["a"].inverseTranspose(r,qe)},u_clippingPlanesEdgeStyle:function(){const e=this.properties.clippingPlanesEdgeColor;return e.alpha=this.properties.clippingPlanesEdgeWidth,e},u_minimumBrightness:function(){return e.fog.minimumBrightness},u_hsbShift:function(){return this.properties.hsbShift},u_colorsToAlpha:function(){return this.properties.colorsToAlpha},u_frontFaceAlphaByDistance:function(){return this.properties.frontFaceAlphaByDistance},u_backFaceAlphaByDistance:function(){return this.properties.backFaceAlphaByDistance},u_translucencyRectangle:function(){return this.properties.localizedTranslucencyRectangle},u_undergroundColor:function(){return this.properties.undergroundColor},u_undergroundColorAlphaByDistance:function(){return this.properties.undergroundColorAlphaByDistance},u_lambertDiffuseMultiplier:function(){return this.properties.lambertDiffuseMultiplier},properties:{initialColor:new I["a"](0,0,.5,1),fillHighlightColor:new s["a"](0,0,0,0),zoomedOutOceanSpecularIntensity:.5,oceanNormalMap:void 0,lightingFadeDistance:new P["a"](65e5,9e6),nightFadeDistance:new P["a"](1e7,4e7),atmosphereLightIntensity:10,atmosphereRayleighCoefficient:new n["a"](55e-7,13e-6,284e-7),atmosphereMieCoefficient:new n["a"](21e-6,21e-6,21e-6),atmosphereRayleighScaleHeight:1e4,atmosphereMieScaleHeight:3200,atmosphereMieAnisotropy:.9,hsbShift:new n["a"],center3D:void 0,rtc:new n["a"],modifiedModelView:new W["a"],tileRectangle:new I["a"],terrainExaggerationAndRelativeHeight:new P["a"](1,0),dayTextures:[],dayTextureTranslationAndScale:[],dayTextureTexCoordsRectangle:[],dayTextureUseWebMercatorT:[],dayTextureAlpha:[],dayTextureNightAlpha:[],dayTextureDayAlpha:[],dayTextureBrightness:[],dayTextureContrast:[],dayTextureHue:[],dayTextureSaturation:[],dayTextureOneOverGamma:[],dayTextureSplit:[],dayTextureCutoutRectangles:[],dayIntensity:0,colorsToAlpha:[],southAndNorthLatitude:new P["a"],southMercatorYAndOneOverHeight:new P["a"],waterMask:void 0,waterMaskTranslationAndScale:new I["a"],minMaxHeight:new P["a"],scaleAndBias:new W["a"],clippingPlanesEdgeColor:s["a"].clone(s["a"].WHITE),clippingPlanesEdgeWidth:0,localizedCartographicLimitRectangle:new I["a"],frontFaceAlphaByDistance:new I["a"],backFaceAlphaByDistance:new I["a"],localizedTranslucencyRectangle:new I["a"],undergroundColor:s["a"].clone(s["a"].TRANSPARENT),undergroundColorAlphaByDistance:new I["a"],lambertDiffuseMultiplier:0}};return Object(u["a"])(t.materialUniformMap)?Object(H["a"])(a,t.materialUniformMap):a}function $e(e,t,a){const r=a.data;let i,n;if(Object(u["a"])(r.vertexArray)?(i=r.mesh,n=r.vertexArray):Object(u["a"])(r.fill)&&Object(u["a"])(r.fill.vertexArray)&&(i=r.fill.mesh,n=r.fill.vertexArray),Object(u["a"])(i)&&Object(u["a"])(n)){if(Object(u["a"])(r.wireframeVertexArray)){if(r.wireframeVertexArray.mesh===i)return;r.wireframeVertexArray.destroy(),r.wireframeVertexArray=void 0}r.wireframeVertexArray=Qe(e,n,i),r.wireframeVertexArray.mesh=i}}function Qe(e,t,a){const r=a.indices,i={indices:r,primitiveType:K["a"].TRIANGLES};U["a"].toWireframe(i);const n=i.indices,o=J["a"].createIndexBuffer({context:e,typedArray:n,usage:ee["a"].STATIC_DRAW,indexDatatype:G["a"].fromSizeInBytes(n.BYTES_PER_ELEMENT)});return new ne["a"]({context:e,attributes:t._attributes,indexBuffer:o})}let Xe,Ze,Je;(function(){const e=new k["a"]({geometry:M["a"].fromDimensions({dimensions:new n["a"](2,2,2)})}),t=new k["a"]({geometry:new $["a"]({radius:1})});let a,r,i=new W["a"];function o(e){return new pe["a"]({geometryInstances:e,appearance:new he["a"]({translucent:!1,flat:!0}),asynchronous:!1})}Xe=function(t,n){return t===a||(Je(),a=t,i=W["a"].fromRotationTranslation(t.halfAxes,t.center,i),e.modelMatrix=i,e.attributes.color=j["a"].fromColor(n),r=o(e)),r},Ze=function(e,n){return e===a||(Je(),a=e,i=W["a"].fromTranslation(e.center,i),i=W["a"].multiplyByUniformScale(i,e.radius,i),t.modelMatrix=i,t.attributes.color=j["a"].fromColor(n),r=o(t)),r},Je=function(){Object(u["a"])(r)&&(r.destroy(),r=void 0,a=void 0)}})();const et=new I["a"](0,0,0,0),tt={frameState:void 0,surfaceTile:void 0,numberOfDayTextures:void 0,applyBrightness:void 0,applyContrast:void 0,applyHue:void 0,applySaturation:void 0,applyGamma:void 0,applyAlpha:void 0,applyDayNightAlpha:void 0,applySplit:void 0,showReflectiveOcean:void 0,showOceanWaves:void 0,enableLighting:void 0,dynamicAtmosphereLighting:void 0,dynamicAtmosphereLightingFromSun:void 0,showGroundAtmosphere:void 0,perFragmentGroundAtmosphere:void 0,hasVertexNormals:void 0,useWebMercatorProjection:void 0,enableFog:void 0,enableClippingPlanes:void 0,clippingPlanes:void 0,clippedByBoundaries:void 0,hasImageryLayerCutout:void 0,colorCorrect:void 0,colorToAlpha:void 0,hasGeodeticSurfaceNormals:void 0,hasExaggeration:void 0},at=s["a"].TRANSPARENT,rt=new f["a"];function it(e,t,a){const i=t.data;Object(u["a"])(i.vertexArray)||(void 0===i.fill&&(i.fill=new ge["a"](t)),i.fill.update(e,a));const o=a.creditDisplay,l=i.terrainData;if(Object(u["a"])(l)&&Object(u["a"])(l.credits)){const e=l.credits;for(let t=0,a=e.length;t<a;++t)o.addCredit(e[t])}let d=te["a"].maximumTextureImageUnits,h=i.waterMaskTexture,p=i.waterMaskTranslationAndScale;!Object(u["a"])(h)&&Object(u["a"])(i.fill)&&(h=i.fill.waterMaskTexture,p=i.fill.waterMaskTranslationAndScale);const m=a.cameraUnderground,f=a.globeTranslucencyState,g=f.translucent,y=f.frontFaceAlphaByDistance,b=f.backFaceAlphaByDistance,T=f.rectangle,C=Object(c["a"])(e.undergroundColor,at),S=Object(c["a"])(e.undergroundColorAlphaByDistance,rt),A=Fe(e,a)&&a.mode===D["a"].SCENE3D&&C.alpha>0&&(S.nearValue>0||S.farValue>0),v=e.lambertDiffuseMultiplier,E=e.hasWaterMask&&Object(u["a"])(h),O=e.oceanNormalMap,F=E&&Object(u["a"])(O),w=e.terrainProvider.ready&&e.terrainProvider.hasVertexNormals,R=a.fog.enabled&&a.fog.renderable&&!m,L=e.showGroundAtmosphere&&a.mode===D["a"].SCENE3D,N=fe["a"].castShadows(e.shadows)&&!g,M=fe["a"].receiveShadows(e.shadows)&&!g,P=e.hueShift,B=e.saturationShift,j=e.brightnessShift;let H=!(z["a"].equalsEpsilon(P,0,z["a"].EPSILON7)&&z["a"].equalsEpsilon(B,0,z["a"].EPSILON7)&&z["a"].equalsEpsilon(j,0,z["a"].EPSILON7)),k=!1;if(L){const t=n["a"].magnitude(a.camera.positionWC),r=e.nightFadeOutDistance;k=t>r}E&&--d,F&&--d,Object(u["a"])(a.shadowState)&&a.shadowState.shadowsEnabled&&--d,Object(u["a"])(e.clippingPlanes)&&e.clippingPlanes.enabled&&--d,d-=f.numberOfTextureUniforms;const U=i.renderedMesh;let G=U.center;const V=U.encoding,q=i.tileBoundingRegion,$=a.terrainExaggeration,Q=a.terrainExaggerationRelativeHeight,X=1!==$,J=V.hasGeodeticSurfaceNormals,ee=Pe;let ie=0,ne=0,oe=0,se=0,ce=!1;if(a.mode!==D["a"].SCENE3D){const e=a.mapProjection,r=e.project(_["a"].southwest(t.rectangle),ke),i=e.project(_["a"].northeast(t.rectangle),Ue);if(ee.x=r.x,ee.y=r.y,ee.z=i.x,ee.w=i.y,a.mode!==D["a"].MORPHING&&(G=je,G.x=0,G.y=.5*(ee.z+ee.x),G.z=.5*(ee.w+ee.y),ee.x-=G.y,ee.y-=G.z,ee.z-=G.y,ee.w-=G.z),a.mode===D["a"].SCENE2D&&V.quantization===x["a"].BITS12){const e=1/(Math.pow(2,12)-1)*.5,t=(ee.z-ee.x)*e,a=(ee.w-ee.y)*e;ee.x-=t,ee.y-=a,ee.z+=t,ee.w+=a}e instanceof Z["a"]&&(ie=t.rectangle.south,ne=t.rectangle.north,oe=Z["a"].geodeticLatitudeToMercatorAngle(ie),se=1/(Z["a"].geodeticLatitudeToMercatorAngle(ne)-oe),ce=!0)}const ue=tt;ue.frameState=a,ue.surfaceTile=i,ue.showReflectiveOcean=E,ue.showOceanWaves=F,ue.enableLighting=e.enableLighting,ue.dynamicAtmosphereLighting=e.dynamicAtmosphereLighting,ue.dynamicAtmosphereLightingFromSun=e.dynamicAtmosphereLightingFromSun,ue.showGroundAtmosphere=L,ue.atmosphereLightIntensity=e.atmosphereLightIntensity,ue.atmosphereRayleighCoefficient=e.atmosphereRayleighCoefficient,ue.atmosphereMieCoefficient=e.atmosphereMieCoefficient,ue.atmosphereRayleighScaleHeight=e.atmosphereRayleighScaleHeight,ue.atmosphereMieScaleHeight=e.atmosphereMieScaleHeight,ue.atmosphereMieAnisotropy=e.atmosphereMieAnisotropy,ue.perFragmentGroundAtmosphere=k,ue.hasVertexNormals=w,ue.useWebMercatorProjection=ce,ue.clippedByBoundaries=i.clippedByBoundaries,ue.hasGeodeticSurfaceNormals=J,ue.hasExaggeration=X;const de=i.imagery;let he=0;const pe=de.length,me=e.showSkirts&&!m&&!g,_e=e.backFaceCulling&&!m&&!g,ye=_e?e._renderState:e._disableCullingRenderState,be=_e?e._blendRenderState:e._disableCullingBlendRenderState;let Te=ye,Ce=e._firstPassInitialColor;const Se=a.context;Object(u["a"])(e._debug.boundingSphereTile)||Je();const ve=e._materialUniformMap!==e.materialUniformMap;if(ve){e._materialUniformMap=e.materialUniformMap;const t=e._drawCommands.length;for(let r=0;r<t;++r)e._uniformMaps[r]=Ke(a,e)}do{let c,l,x=0;if(e._drawCommands.length<=e._usedDrawCommands?(c=new ae["a"],c.owner=t,c.cull=!1,c.boundingVolume=new r["a"],c.orientedBoundingBox=void 0,l=Ke(a,e),e._drawCommands.push(c),e._uniformMaps.push(l)):(c=e._drawCommands[e._usedDrawCommands],l=e._uniformMaps[e._usedDrawCommands]),c.owner=t,++e._usedDrawCommands,t===e._debug.boundingSphereTile){const e=q.boundingVolume,t=q.boundingSphere;Object(u["a"])(e)?Xe(e,s["a"].RED).update(a):Object(u["a"])(t)&&Ze(t,s["a"].RED).update(a)}const E=l.properties;I["a"].clone(Ce,E.initialColor),E.oceanNormalMap=O,E.lightingFadeDistance.x=e.lightingFadeOutDistance,E.lightingFadeDistance.y=e.lightingFadeInDistance,E.nightFadeDistance.x=e.nightFadeOutDistance,E.nightFadeDistance.y=e.nightFadeInDistance,E.atmosphereLightIntensity=e.atmosphereLightIntensity,E.atmosphereRayleighCoefficient=e.atmosphereRayleighCoefficient,E.atmosphereMieCoefficient=e.atmosphereMieCoefficient,E.atmosphereRayleighScaleHeight=e.atmosphereRayleighScaleHeight,E.atmosphereMieScaleHeight=e.atmosphereMieScaleHeight,E.atmosphereMieAnisotropy=e.atmosphereMieAnisotropy,E.zoomedOutOceanSpecularIntensity=e.zoomedOutOceanSpecularIntensity;const F=m?b:y,w=m?y:b;Object(u["a"])(F)&&(I["a"].fromElements(F.near,F.nearValue,F.far,F.farValue,E.frontFaceAlphaByDistance),I["a"].fromElements(w.near,w.nearValue,w.far,w.farValue,E.backFaceAlphaByDistance)),I["a"].fromElements(S.near,S.nearValue,S.far,S.farValue,E.undergroundColorAlphaByDistance),s["a"].clone(C,E.undergroundColor),E.lambertDiffuseMultiplier=v;const k=!Object(u["a"])(i.vertexArray)&&Object(u["a"])(e.fillHighlightColor)&&e.fillHighlightColor.alpha>0;k&&s["a"].clone(e.fillHighlightColor,E.fillHighlightColor),E.terrainExaggerationAndRelativeHeight.x=$,E.terrainExaggerationAndRelativeHeight.y=Q,E.center3D=U.center,n["a"].clone(G,E.rtc),I["a"].clone(ee,E.tileRectangle),E.southAndNorthLatitude.x=ie,E.southAndNorthLatitude.y=ne,E.southMercatorYAndOneOverHeight.x=oe,E.southMercatorYAndOneOverHeight.y=se;const X=Ie,Z=De(t.rectangle,e.cartographicLimitRectangle),J=Be,te=De(t.rectangle,T);n["a"].fromElements(P,B,j,E.hsbShift);const ce=t.rectangle,fe=1/ce.width,ge=1/ce.height;X.x=(Z.west-ce.west)*fe,X.y=(Z.south-ce.south)*ge,X.z=(Z.east-ce.west)*fe,X.w=(Z.north-ce.south)*ge,I["a"].clone(X,E.localizedCartographicLimitRectangle),J.x=(te.west-ce.west)*fe,J.y=(te.south-ce.south)*ge,J.z=(te.east-ce.west)*fe,J.w=(te.north-ce.south)*ge,I["a"].clone(J,E.localizedTranslucencyRectangle);const _e=R&&z["a"].fog(t._distance,a.fog.density)>z["a"].EPSILON3;H=H&&(_e||L);let ye=!1,ve=!1,Ee=!1,Oe=!1,Fe=!1,we=!1,Re=!1,Le=!1,Ne=!1,Me=!1;while(x<d&&he<pe){const e=de[he],a=e.readyImagery;if(++he,!Object(u["a"])(a)||0===a.imageryLayer.alpha)continue;const r=e.useWebMercatorT?a.textureWebMercator:a.texture,i=a.imageryLayer;Object(u["a"])(e.textureTranslationAndScale)||(e.textureTranslationAndScale=i._calculateTextureTranslationAndScale(t,e)),E.dayTextures[x]=r,E.dayTextureTranslationAndScale[x]=e.textureTranslationAndScale,E.dayTextureTexCoordsRectangle[x]=e.textureCoordinateRectangle,E.dayTextureUseWebMercatorT[x]=e.useWebMercatorT,E.dayTextureAlpha[x]=i.alpha,we=we||1!==E.dayTextureAlpha[x],E.dayTextureNightAlpha[x]=i.nightAlpha,Re=Re||1!==E.dayTextureNightAlpha[x],E.dayTextureDayAlpha[x]=i.dayAlpha,Re=Re||1!==E.dayTextureDayAlpha[x],E.dayTextureBrightness[x]=i.brightness,ye=ye||E.dayTextureBrightness[x]!==le["a"].DEFAULT_BRIGHTNESS,E.dayTextureContrast[x]=i.contrast,ve=ve||E.dayTextureContrast[x]!==le["a"].DEFAULT_CONTRAST,E.dayTextureHue[x]=i.hue,Ee=Ee||E.dayTextureHue[x]!==le["a"].DEFAULT_HUE,E.dayTextureSaturation[x]=i.saturation,Oe=Oe||E.dayTextureSaturation[x]!==le["a"].DEFAULT_SATURATION,E.dayTextureOneOverGamma[x]=1/i.gamma,Fe=Fe||E.dayTextureOneOverGamma[x]!==1/le["a"].DEFAULT_GAMMA,E.dayTextureSplit[x]=i.splitDirection,Le=Le||0!==E.dayTextureSplit[x];let n=E.dayTextureCutoutRectangles[x];if(Object(u["a"])(n)||(n=E.dayTextureCutoutRectangles[x]=new I["a"]),I["a"].clone(I["a"].ZERO,n),Object(u["a"])(i.cutoutRectangle)){const e=De(ce,i.cutoutRectangle),t=_["a"].simpleIntersection(e,ce,xe);Ne=Object(u["a"])(t)||Ne,n.x=(e.west-ce.west)*fe,n.y=(e.south-ce.south)*ge,n.z=(e.east-ce.west)*fe,n.w=(e.north-ce.south)*ge}let s=E.colorsToAlpha[x];Object(u["a"])(s)||(s=E.colorsToAlpha[x]=new I["a"]);const c=Object(u["a"])(i.colorToAlpha)&&i.colorToAlphaThreshold>0;if(Me=Me||c,c){const e=i.colorToAlpha;s.x=e.red,s.y=e.green,s.z=e.blue,s.w=i.colorToAlphaThreshold}else s.w=-1;if(Object(u["a"])(a.credits)){const e=a.credits;for(let t=0,a=e.length;t<a;++t)o.addCredit(e[t])}++x}E.dayTextures.length=x,E.waterMask=h,I["a"].clone(p,E.waterMaskTranslationAndScale),E.minMaxHeight.x=V.minimumHeight,E.minMaxHeight.y=V.maximumHeight,W["a"].clone(V.matrix,E.scaleAndBias);const Pe=e._clippingPlanes,je=Object(u["a"])(Pe)&&Pe.enabled&&t.isClipped;je&&(E.clippingPlanesEdgeColor=s["a"].clone(Pe.edgeColor,E.clippingPlanesEdgeColor),E.clippingPlanesEdgeWidth=Pe.edgeWidth),ue.numberOfDayTextures=x,ue.applyBrightness=ye,ue.applyContrast=ve,ue.applyHue=Ee,ue.applySaturation=Oe,ue.applyGamma=Fe,ue.applyAlpha=we,ue.applyDayNightAlpha=Re,ue.applySplit=Le,ue.enableFog=_e,ue.enableClippingPlanes=je,ue.clippingPlanes=Pe,ue.hasImageryLayerCutout=Ne,ue.colorCorrect=H,ue.highlightFillTile=k,ue.colorToAlpha=Me,ue.showUndergroundColor=A,ue.translucent=g;let He=i.renderedMesh.indices.length;me||(He=i.renderedMesh.indexCountWithoutSkirts),c.shaderProgram=e._surfaceShaderSet.getShaderProgram(ue),c.castShadows=N,c.receiveShadows=M,c.renderState=Te,c.primitiveType=K["a"].TRIANGLES,c.vertexArray=i.vertexArray||i.fill.vertexArray,c.count=He,c.uniformMap=l,c.pass=re["a"].GLOBE,e._debug.wireframe&&($e(Se,e,t),Object(u["a"])(i.wireframeVertexArray)&&(c.vertexArray=i.wireframeVertexArray,c.primitiveType=K["a"].LINES,c.count=2*He));let ke=c.boundingVolume;const Ue=c.orientedBoundingBox;a.mode!==D["a"].SCENE3D?(r["a"].fromRectangleWithHeights2D(t.rectangle,a.mapProjection,q.minimumHeight,q.maximumHeight,ke),n["a"].fromElements(ke.center.z,ke.center.x,ke.center.y,ke.center),a.mode===D["a"].MORPHING&&(ke=r["a"].union(q.boundingSphere,ke,ke))):(c.boundingVolume=r["a"].clone(q.boundingSphere,ke),c.orientedBoundingBox=Y["a"].clone(q.boundingVolume,Ue)),c.dirty=!0,g&&f.updateDerivedCommands(c,a),Ae(c,a),Te=be,Ce=et}while(he<pe)}var nt=Te;function ot(){this._enabled=!1,this._frontFaceAlpha=1,this._frontFaceAlphaByDistance=void 0,this._backFaceAlpha=1,this._backFaceAlphaByDistance=void 0,this._rectangle=_["a"].clone(_["a"].MAX_VALUE)}Object.defineProperties(ot.prototype,{enabled:{get:function(){return this._enabled},set:function(e){this._enabled=e}},frontFaceAlpha:{get:function(){return this._frontFaceAlpha},set:function(e){this._frontFaceAlpha=e}},frontFaceAlphaByDistance:{get:function(){return this._frontFaceAlphaByDistance},set:function(e){this._frontFaceAlphaByDistance=f["a"].clone(e,this._frontFaceAlphaByDistance)}},backFaceAlpha:{get:function(){return this._backFaceAlpha},set:function(e){this._backFaceAlpha=e}},backFaceAlphaByDistance:{get:function(){return this._backFaceAlphaByDistance},set:function(e){this._backFaceAlphaByDistance=f["a"].clone(e,this._backFaceAlphaByDistance)}},rectangle:{get:function(){return this._rectangle},set:function(e){Object(u["a"])(e)||(e=_["a"].clone(_["a"].MAX_VALUE)),_["a"].clone(e,this._rectangle)}}});var st=ot,ct=a("506f"),ut=a("c17f");function lt(e){e=Object(c["a"])(e,d["a"].WGS84);const t=new h["a"]({ellipsoid:e}),a=new ct["a"];this._ellipsoid=e,this._imageryLayerCollection=a,this._surfaceShaderSet=new N,this._material=void 0,this._surface=new ut["a"]({tileProvider:new nt({terrainProvider:t,imageryLayers:a,surfaceShaderSet:this._surfaceShaderSet})}),this._terrainProvider=t,this._terrainProviderChanged=new p["a"],this._undergroundColor=s["a"].clone(s["a"].BLACK),this._undergroundColorAlphaByDistance=new f["a"](e.maximumRadius/1e3,0,e.maximumRadius/5,1),this._translucency=new st,dt(this),this.show=!0,this._oceanNormalMapResourceDirty=!0,this._oceanNormalMapResource=new y["a"]({url:Object(i["a"])("Assets/Textures/waterNormalsSmall.jpg")}),this.maximumScreenSpaceError=2,this.tileCacheSize=100,this.loadingDescendantLimit=20,this.preloadAncestors=!0,this.preloadSiblings=!1,this.fillHighlightColor=void 0,this.enableLighting=!1,this.lambertDiffuseMultiplier=.9,this.dynamicAtmosphereLighting=!0,this.dynamicAtmosphereLightingFromSun=!1,this.showGroundAtmosphere=!0,this.atmosphereLightIntensity=10,this.atmosphereRayleighCoefficient=new n["a"](55e-7,13e-6,284e-7),this.atmosphereMieCoefficient=new n["a"](21e-6,21e-6,21e-6),this.atmosphereRayleighScaleHeight=1e4,this.atmosphereMieScaleHeight=3200,this.atmosphereMieAnisotropy=.9,this.lightingFadeOutDistance=1e7,this.lightingFadeInDistance=2e7,this.nightFadeOutDistance=1e7,this.nightFadeInDistance=5e7,this.showWaterEffect=!0,this.depthTestAgainstTerrain=!1,this.shadows=fe["a"].RECEIVE_ONLY,this.atmosphereHueShift=0,this.atmosphereSaturationShift=0,this.atmosphereBrightnessShift=0,this.terrainExaggeration=1,this.terrainExaggerationRelativeHeight=0,this.showSkirts=!0,this.backFaceCulling=!0,this._oceanNormalMap=void 0,this._zoomedOutOceanSpecularIntensity=void 0}function dt(e){const t=[],a=Object(u["a"])(e._material)&&(e._material.shaderSource.match(/slope/)||e._material.shaderSource.match("normalEC")),r=[A["a"],v["a"]];!Object(u["a"])(e._material)||a&&!e._terrainProvider.requestVertexNormals?e._surface._tileProvider.materialUniformMap=void 0:(r.push(e._material.shaderSource),t.push("APPLY_MATERIAL"),e._surface._tileProvider.materialUniformMap=e._material._uniforms),r.push(C["a"]),e._surfaceShaderSet.baseVertexShaderSource=new b["a"]({sources:[A["a"],v["a"],S["a"]],defines:t}),e._surfaceShaderSet.baseFragmentShaderSource=new b["a"]({sources:r,defines:t}),e._surfaceShaderSet.material=e._material}function ht(e){return function(t,a){const i=r["a"].distanceSquaredTo(t.pickBoundingSphere,e),n=r["a"].distanceSquaredTo(a.pickBoundingSphere,e);return i-n}}Object.defineProperties(lt.prototype,{ellipsoid:{get:function(){return this._ellipsoid}},imageryLayers:{get:function(){return this._imageryLayerCollection}},imageryLayersUpdatedEvent:{get:function(){return this._surface.tileProvider.imageryLayersUpdatedEvent}},tilesLoaded:{get:function(){return!Object(u["a"])(this._surface)||this._surface.tileProvider.ready&&0===this._surface._tileLoadQueueHigh.length&&0===this._surface._tileLoadQueueMedium.length&&0===this._surface._tileLoadQueueLow.length}},baseColor:{get:function(){return this._surface.tileProvider.baseColor},set:function(e){this._surface.tileProvider.baseColor=e}},clippingPlanes:{get:function(){return this._surface.tileProvider.clippingPlanes},set:function(e){this._surface.tileProvider.clippingPlanes=e}},cartographicLimitRectangle:{get:function(){return this._surface.tileProvider.cartographicLimitRectangle},set:function(e){Object(u["a"])(e)||(e=_["a"].clone(_["a"].MAX_VALUE)),this._surface.tileProvider.cartographicLimitRectangle=e}},oceanNormalMapUrl:{get:function(){return this._oceanNormalMapResource.url},set:function(e){this._oceanNormalMapResource.url=e,this._oceanNormalMapResourceDirty=!0}},terrainProvider:{get:function(){return this._terrainProvider},set:function(e){e!==this._terrainProvider&&(this._terrainProvider=e,this._terrainProviderChanged.raiseEvent(e),Object(u["a"])(this._material)&&dt(this))}},terrainProviderChanged:{get:function(){return this._terrainProviderChanged}},tileLoadProgressEvent:{get:function(){return this._surface.tileLoadProgressEvent}},material:{get:function(){return this._material},set:function(e){this._material!==e&&(this._material=e,dt(this))}},undergroundColor:{get:function(){return this._undergroundColor},set:function(e){this._undergroundColor=s["a"].clone(e,this._undergroundColor)}},undergroundColorAlphaByDistance:{get:function(){return this._undergroundColorAlphaByDistance},set:function(e){this._undergroundColorAlphaByDistance=f["a"].clone(e,this._undergroundColorAlphaByDistance)}},translucency:{get:function(){return this._translucency}}});const pt=[],mt={start:0,stop:0};lt.prototype.pickWorldCoordinates=function(e,t,a,i){a=Object(c["a"])(a,!0);const o=t.mode,s=t.mapProjection,l=pt;l.length=0;const d=this._surface._tilesToRender;let h,p,f,g=d.length;for(p=0;p<g;++p){h=d[p];const t=h.data;if(!Object(u["a"])(t))continue;let a=t.pickBoundingSphere;if(o!==D["a"].SCENE3D)t.pickBoundingSphere=a=r["a"].fromRectangleWithHeights2D(h.rectangle,s,t.tileBoundingRegion.minimumHeight,t.tileBoundingRegion.maximumHeight,a),n["a"].fromElements(a.center.z,a.center.x,a.center.y,a.center);else{if(!Object(u["a"])(t.renderedMesh))continue;r["a"].clone(t.tileBoundingRegion.boundingSphere,a)}const i=m["a"].raySphere(e,a,mt);Object(u["a"])(i)&&l.push(t)}for(l.sort(ht(e.origin)),g=l.length,p=0;p<g;++p)if(f=l[p].pick(e,t.mode,t.mapProjection,a,i),Object(u["a"])(f))break;return f};const ft=new o["a"];lt.prototype.pick=function(e,t,a){if(a=this.pickWorldCoordinates(e,t,!0,a),Object(u["a"])(a)&&t.mode!==D["a"].SCENE3D){a=n["a"].fromElements(a.y,a.z,a.x,a);const e=t.mapProjection.unproject(a,ft);a=t.globe.ellipsoid.cartographicToCartesian(e,a)}return a};const gt=new n["a"],_t=new n["a"],yt=new o["a"],bt=new g["a"];function Tt(e,t){return Object(u["a"])(e)&&_["a"].contains(e.rectangle,t)?e:void 0}lt.prototype.getHeight=function(e){const t=this._surface._levelZeroTiles;if(!Object(u["a"])(t))return;let a,r;const i=t.length;for(r=0;r<i;++r)if(a=t[r],_["a"].contains(a.rectangle,e))break;if(r>=i)return;let o=a;while(Object(u["a"])(a))a=Tt(a._southwestChild,e)||Tt(a._southeastChild,e)||Tt(a._northwestChild,e)||a._northeastChild,Object(u["a"])(a)&&Object(u["a"])(a.data)&&Object(u["a"])(a.data.renderedMesh)&&(o=a);if(a=o,!Object(u["a"])(a)||!Object(u["a"])(a.data)||!Object(u["a"])(a.data.renderedMesh))return;const s=this._surface._tileProvider.tilingScheme.projection,l=this._surface._tileProvider.tilingScheme.ellipsoid,d=n["a"].fromRadians(e.longitude,e.latitude,0,l,gt),h=bt,p=l.geodeticSurfaceNormal(d,h.direction),m=l.getSurfaceNormalIntersectionWithZAxis(d,11500,h.origin);if(!Object(u["a"])(m)){let e;Object(u["a"])(a.data.tileBoundingRegion)&&(e=a.data.tileBoundingRegion.minimumHeight);const t=Math.min(Object(c["a"])(e,0),-11500),r=n["a"].multiplyByScalar(p,Math.abs(t)+1,_t);n["a"].subtract(d,r,h.origin)}const f=a.data.pick(h,void 0,s,!1,_t);return Object(u["a"])(f)?l.cartesianToCartographic(f,yt).height:void 0},lt.prototype.update=function(e){this.show&&e.passes.render&&this._surface.update(e)},lt.prototype.beginFrame=function(e){const t=this._surface,a=t.tileProvider,r=this.terrainProvider,i=this.showWaterEffect&&r.ready&&r.hasWaterMask;if(i&&this._oceanNormalMapResourceDirty){this._oceanNormalMapResourceDirty=!1;const t=this._oceanNormalMapResource,a=t.url;if(Object(u["a"])(a)){const r=this;t.fetchImage().then((function(t){a===r._oceanNormalMapResource.url&&(r._oceanNormalMap=r._oceanNormalMap&&r._oceanNormalMap.destroy(),r._oceanNormalMap=new T["a"]({context:e.context,source:t}))}))}else this._oceanNormalMap=this._oceanNormalMap&&this._oceanNormalMap.destroy()}const n=e.passes,o=e.mode;n.render&&(this.showGroundAtmosphere?this._zoomedOutOceanSpecularIntensity=.4:this._zoomedOutOceanSpecularIntensity=.5,t.maximumScreenSpaceError=this.maximumScreenSpaceError,t.tileCacheSize=this.tileCacheSize,t.loadingDescendantLimit=this.loadingDescendantLimit,t.preloadAncestors=this.preloadAncestors,t.preloadSiblings=this.preloadSiblings,a.terrainProvider=this.terrainProvider,a.lightingFadeOutDistance=this.lightingFadeOutDistance,a.lightingFadeInDistance=this.lightingFadeInDistance,a.nightFadeOutDistance=this.nightFadeOutDistance,a.nightFadeInDistance=this.nightFadeInDistance,a.zoomedOutOceanSpecularIntensity=o===D["a"].SCENE3D?this._zoomedOutOceanSpecularIntensity:0,a.hasWaterMask=i,a.oceanNormalMap=this._oceanNormalMap,a.enableLighting=this.enableLighting,a.dynamicAtmosphereLighting=this.dynamicAtmosphereLighting,a.dynamicAtmosphereLightingFromSun=this.dynamicAtmosphereLightingFromSun,a.showGroundAtmosphere=this.showGroundAtmosphere,a.atmosphereLightIntensity=this.atmosphereLightIntensity,a.atmosphereRayleighCoefficient=this.atmosphereRayleighCoefficient,a.atmosphereMieCoefficient=this.atmosphereMieCoefficient,a.atmosphereRayleighScaleHeight=this.atmosphereRayleighScaleHeight,a.atmosphereMieScaleHeight=this.atmosphereMieScaleHeight,a.atmosphereMieAnisotropy=this.atmosphereMieAnisotropy,a.shadows=this.shadows,a.hueShift=this.atmosphereHueShift,a.saturationShift=this.atmosphereSaturationShift,a.brightnessShift=this.atmosphereBrightnessShift,a.fillHighlightColor=this.fillHighlightColor,a.showSkirts=this.showSkirts,a.backFaceCulling=this.backFaceCulling,a.undergroundColor=this._undergroundColor,a.undergroundColorAlphaByDistance=this._undergroundColorAlphaByDistance,a.lambertDiffuseMultiplier=this.lambertDiffuseMultiplier,t.beginFrame(e))},lt.prototype.render=function(e){this.show&&(Object(u["a"])(this._material)&&this._material.update(e.context),this._surface.render(e))},lt.prototype.endFrame=function(e){this.show&&e.passes.render&&this._surface.endFrame(e)},lt.prototype.isDestroyed=function(){return!1},lt.prototype.destroy=function(){return this._surfaceShaderSet=this._surfaceShaderSet&&this._surfaceShaderSet.destroy(),this._surface=this._surface&&this._surface.destroy(),this._oceanNormalMap=this._oceanNormalMap&&this._oceanNormalMap.destroy(),Object(l["a"])(this)};t["a"]=lt},2856:function(e,t,a){"use strict";var r=a("cef5"),i=a("be18"),n=a("a561"),o=a("bef8"),s=a("2f63"),c=a("0123"),u=a("5410"),l=a("e42d"),d=a("2ac3"),h=a("de66"),p=a("8a39"),m=a("b82e"),f=a("0769"),g=a("a89b"),_=a("f20a"),y=a("8b68"),b=a("6ef5"),T=a("6c84"),C=a("a913"),S=a("3022"),A=a("03f1"),v=a("23b6"),x=a("7c5e"),E=a("dddf"),O=a("f1b3"),D=a("a307"),F=a("4c22");function w(){this.imagery=[],this.waterMaskTexture=void 0,this.waterMaskTranslationAndScale=new n["a"](0,0,1,1),this.terrainData=void 0,this.vertexArray=void 0,this.tileBoundingRegion=void 0,this.occludeePointInScaledSpace=new i["a"],this.boundingVolumeSourceTile=void 0,this.boundingVolumeIsFromMesh=!1,this.terrainState=F["a"].UNLOADED,this.mesh=void 0,this.fill=void 0,this.pickBoundingSphere=new r["a"],this.surfaceShader=void 0,this.isClipped=!0,this.clippedByBoundaries=!1}Object.defineProperties(w.prototype,{eligibleForUnloading:{get:function(){const e=this.terrainState,t=e===F["a"].RECEIVING||e===F["a"].TRANSFORMING;let a=!t;const r=this.imagery;for(let i=0,n=r.length;a&&i<n;++i){const e=r[i];a=!Object(s["a"])(e.loadingImagery)||e.loadingImagery.state!==E["a"].TRANSITIONING}return a}},renderedMesh:{get:function(){return Object(s["a"])(this.vertexArray)?this.mesh:Object(s["a"])(this.fill)?this.fill.mesh:void 0}}});const R=new o["a"];function L(e,t,a,r,n,o){let c=e.getExaggeratedPosition(r,n,o);if(Object(s["a"])(t)&&t!==D["a"].SCENE3D){const e=a.ellipsoid,t=e.cartesianToCartographic(c,R);c=a.project(t,o),c=i["a"].fromElements(c.z,c.x,c.y,o)}return c}const N=new i["a"],M=new i["a"],P=new i["a"];function I(e,t,a,r){const i=e.renderedMesh,n=i.vertices,o=i.encoding,s=n.length/o.stride;let c=f["a"].clone(o);c.hasGeodeticSurfaceNormals=t,c=f["a"].clone(c);const u=c.stride,l=new Float32Array(s*u);t?o.addGeodeticSurfaceNormals(n,l,a):o.removeGeodeticSurfaceNormals(n,l),i.vertices=l,i.stride=u;const d=i!==e.mesh;d?(w._freeVertexArray(e.fill.vertexArray),e.fill.vertexArray=w._createVertexArrayForMesh(r.context,i)):(w._freeVertexArray(e.vertexArray),e.vertexArray=w._createVertexArrayForMesh(r.context,i)),w._freeVertexArray(e.wireframeVertexArray),e.wireframeVertexArray=void 0}function B(e,t,a){let r=t.getTileDataAvailable(e.x,e.y,e.level);if(!Object(s["a"])(r)&&Object(s["a"])(e.parent)){const t=e.parent,a=t.data;Object(s["a"])(a)&&Object(s["a"])(a.terrainData)&&(r=a.terrainData.isChildAvailable(t.x,t.y,e.x,e.y))}!1===r&&(e.data.terrainState=F["a"].FAILED);for(let i=0,n=a.length;i<n;++i){const r=a.get(i);r.show&&r._createTileImagerySkeletons(e,t)}}function j(e,t,a,r,i,n){const o=e.data,c=e.parent;if(o.terrainState===F["a"].FAILED&&void 0!==c){const e=void 0!==c.data&&void 0!==c.data.terrainData&&!1!==c.data.terrainData.canUpsample;e||w.processStateMachine(c,t,a,r,i,n,!0)}if(o.terrainState===F["a"].FAILED&&H(o,e,t,a,e.x,e.y,e.level),o.terrainState===F["a"].UNLOADED&&k(o,a,e.x,e.y,e.level),o.terrainState===F["a"].RECEIVED&&G(o,t,a,e.x,e.y,e.level),o.terrainState===F["a"].TRANSFORMED&&(V(o,t.context,a,e.x,e.y,e.level,n),o.updateExaggeration(e,t,i)),o.terrainState>=F["a"].RECEIVED&&void 0===o.waterMaskTexture&&a.hasWaterMask){const a=o.terrainData;if(void 0!==a.waterMask)W(t.context,o);else{const t=o._findAncestorTileWithTerrainData(e);Object(s["a"])(t)&&Object(s["a"])(t.data.waterMaskTexture)&&(o.waterMaskTexture=t.data.waterMaskTexture,++o.waterMaskTexture.referenceCount,o._computeWaterMaskTranslationAndScale(e,t,o.waterMaskTranslationAndScale))}}}function H(e,t,a,r,i,n,o){const c=t.parent;if(!c)return void(t.state=O["a"].FAILED);const u=c.data.terrainData,l=c.x,d=c.y,h=c.level;if(!Object(s["a"])(u))return;const p=u.upsample(r.tilingScheme,l,d,h,i,n,o);Object(s["a"])(p)&&(e.terrainState=F["a"].RECEIVING,Promise.resolve(p).then((function(t){e.terrainData=t,e.terrainState=F["a"].RECEIVED})).catch((function(){e.terrainState=F["a"].FAILED})))}function k(e,t,a,r,i){function n(t){e.terrainData=t,e.terrainState=F["a"].RECEIVED,e.request=void 0}function o(n){if(e.request.state===p["a"].CANCELLED)return e.terrainData=void 0,e.terrainState=F["a"].UNLOADED,void(e.request=void 0);e.terrainState=F["a"].FAILED,e.request=void 0;const o=`Failed to obtain terrain tile X: ${a} Y: ${r} Level: ${i}. Error message: "${n}"`;t._requestError=g["a"].reportError(t._requestError,t,t.errorEvent,o,a,r,i),t._requestError.retry&&c()}function c(){const c=new h["a"]({throttle:!1,throttleByServer:!0,type:m["a"].TERRAIN});e.request=c;const u=t.requestTileGeometry(a,r,i,c);Object(s["a"])(u)?(e.terrainState=F["a"].RECEIVING,Promise.resolve(u).then((function(e){n(e)})).catch((function(e){o(e)}))):(e.terrainState=F["a"].UNLOADED,e.request=void 0)}c()}w.prototype.pick=function(e,t,a,r,i){const n=this.renderedMesh;if(!Object(s["a"])(n))return;const o=n.vertices,c=n.indices,l=n.encoding,h=c.length;let p=Number.MAX_VALUE;for(let d=0;d<h;d+=3){const i=c[d],n=c[d+1],h=c[d+2],m=L(l,t,a,o,i,N),f=L(l,t,a,o,n,M),g=L(l,t,a,o,h,P),_=u["a"].rayTriangleParametric(e,m,f,g,r);Object(s["a"])(_)&&_<p&&_>=0&&(p=_)}return p!==Number.MAX_VALUE?d["a"].getPoint(e,p,i):void 0},w.prototype.freeResources=function(){Object(s["a"])(this.waterMaskTexture)&&(--this.waterMaskTexture.referenceCount,0===this.waterMaskTexture.referenceCount&&this.waterMaskTexture.destroy(),this.waterMaskTexture=void 0),this.terrainData=void 0,this.terrainState=F["a"].UNLOADED,this.mesh=void 0,this.fill=this.fill&&this.fill.destroy();const e=this.imagery;for(let t=0,a=e.length;t<a;++t)e[t].freeResources();this.imagery.length=0,this.freeVertexArray()},w.prototype.freeVertexArray=function(){w._freeVertexArray(this.vertexArray),this.vertexArray=void 0,w._freeVertexArray(this.wireframeVertexArray),this.wireframeVertexArray=void 0},w.initialize=function(e,t,a){let r=e.data;Object(s["a"])(r)||(r=e.data=new w),e.state===O["a"].START&&(B(e,t,a),e.state=O["a"].LOADING)},w.processStateMachine=function(e,t,a,r,i,n,o){w.initialize(e,a,r);const c=e.data;if(e.state===O["a"].LOADING&&j(e,t,a,r,i,n),o)return;const u=e.renderable;e.renderable=Object(s["a"])(c.vertexArray);const l=c.terrainState===F["a"].READY;e.upsampledFromParent=Object(s["a"])(c.terrainData)&&c.terrainData.wasCreatedByUpsampling();const d=c.processImagery(e,a,t);if(l&&d){const t=e._loadedCallbacks,a={};for(const r in t)t.hasOwnProperty(r)&&(t[r](e)||(a[r]=t[r]));e._loadedCallbacks=a,e.state=O["a"].DONE}u&&(e.renderable=!0)},w.prototype.processImagery=function(e,t,a,r){const i=e.data;let n=e.upsampledFromParent,o=!1,c=!0;const u=i.imagery;let l,d;for(l=0,d=u.length;l<d;++l){const i=u[l];if(!Object(s["a"])(i.loadingImagery)){n=!1;continue}if(i.loadingImagery.state===E["a"].PLACEHOLDER){const a=i.loadingImagery.imageryLayer;if(a.imageryProvider.ready){i.freeResources(),u.splice(l,1),a._createTileImagerySkeletons(e,t,l),--l,d=u.length;continue}n=!1}const h=i.processStateMachine(e,a,r);c=c&&h,o=o||h||Object(s["a"])(i.readyImagery),n=n&&Object(s["a"])(i.loadingImagery)&&(i.loadingImagery.state===E["a"].FAILED||i.loadingImagery.state===E["a"].INVALID)}return e.upsampledFromParent=n,e.renderable=e.renderable&&(o||c),c},w.prototype.addGeodeticSurfaceNormals=function(e,t){I(this,!0,e,t)},w.prototype.removeGeodeticSurfaceNormals=function(e){I(this,!1,void 0,e)},w.prototype.updateExaggeration=function(e,t,a){const r=this,i=r.renderedMesh;if(void 0===i)return;const n=t.terrainExaggeration,o=t.terrainExaggerationRelativeHeight,s=1!==n,c=i.encoding,u=c.exaggeration!==n,l=c.exaggerationRelativeHeight!==o;if(u||l){if(u)if(s&&!c.hasGeodeticSurfaceNormals){const a=e.tilingScheme.ellipsoid;r.addGeodeticSurfaceNormals(a,t)}else!s&&c.hasGeodeticSurfaceNormals&&r.removeGeodeticSurfaceNormals(t);if(c.exaggeration=n,c.exaggerationRelativeHeight=o,void 0!==a){a._tileToUpdateHeights.push(e);const t=e.customData,r=t.length;for(let e=0;e<r;e++){const a=t[e];a.level=-1}}}};const U={tilingScheme:void 0,x:0,y:0,level:0,exaggeration:1,exaggerationRelativeHeight:0,throttle:!0};function G(e,t,a,r,i,n){const o=a.tilingScheme,c=U;c.tilingScheme=o,c.x=r,c.y=i,c.level=n,c.exaggeration=t.terrainExaggeration,c.exaggerationRelativeHeight=t.terrainExaggerationRelativeHeight,c.throttle=!0;const u=e.terrainData,l=u.createMesh(c);Object(s["a"])(l)&&(e.terrainState=F["a"].TRANSFORMING,Promise.resolve(l).then((function(t){e.mesh=t,e.terrainState=F["a"].TRANSFORMED})).catch((function(){e.terrainState=F["a"].FAILED})))}function V(e,t,a,r,i,n,o){e.vertexArray=w._createVertexArrayForMesh(t,e.mesh),e.terrainState=F["a"].READY,e.fill=e.fill&&e.fill.destroy(o)}function z(e){let t=e.cache.tile_waterMaskData;if(!Object(s["a"])(t)){const a=C["a"].create({context:e,pixelFormat:l["a"].LUMINANCE,pixelDatatype:b["a"].UNSIGNED_BYTE,source:{arrayBufferView:new Uint8Array([255]),width:1,height:1}});a.referenceCount=1;const r=new T["a"]({wrapS:v["a"].CLAMP_TO_EDGE,wrapT:v["a"].CLAMP_TO_EDGE,minificationFilter:A["a"].LINEAR,magnificationFilter:S["a"].LINEAR});t={allWaterTexture:a,sampler:r,destroy:function(){this.allWaterTexture.destroy()}},e.cache.tile_waterMaskData=t}return t}function W(e,t){const a=t.terrainData.waterMask,r=z(e);let i;const o=a.length;if(1===o){if(0===a[0])return;i=r.allWaterTexture}else{const t=Math.sqrt(o);i=C["a"].create({context:e,pixelFormat:l["a"].LUMINANCE,pixelDatatype:b["a"].UNSIGNED_BYTE,source:{width:t,height:t,arrayBufferView:a},sampler:r.sampler,flipY:!1}),i.referenceCount=0}++i.referenceCount,t.waterMaskTexture=i,n["a"].fromElements(0,0,1,1,t.waterMaskTranslationAndScale)}w._createVertexArrayForMesh=function(e,t){const a=t.vertices,r=_["a"].createVertexBuffer({context:e,typedArray:a,usage:y["a"].STATIC_DRAW}),i=t.encoding.getAttributes(r),n=t.indices.indexBuffers||{};let o=n[e.id];if(!Object(s["a"])(o)||o.isDestroyed()){const a=t.indices;o=_["a"].createIndexBuffer({context:e,typedArray:a,usage:y["a"].STATIC_DRAW,indexDatatype:c["a"].fromSizeInBytes(a.BYTES_PER_ELEMENT)}),o.vertexArrayDestroyable=!1,o.referenceCount=1,n[e.id]=o,t.indices.indexBuffers=n}else++o.referenceCount;return new x["a"]({context:e,attributes:i,indexBuffer:o})},w._freeVertexArray=function(e){if(Object(s["a"])(e)){const t=e.indexBuffer;e.isDestroyed()||e.destroy(),Object(s["a"])(t)&&!t.isDestroyed()&&Object(s["a"])(t.referenceCount)&&(--t.referenceCount,0===t.referenceCount&&t.destroy())}},w.prototype._findAncestorTileWithTerrainData=function(e){let t=e.parent;while(Object(s["a"])(t)&&(!Object(s["a"])(t.data)||!Object(s["a"])(t.data.terrainData)||t.data.terrainData.wasCreatedByUpsampling()))t=t.parent;return t},w.prototype._computeWaterMaskTranslationAndScale=function(e,t,a){const r=t.rectangle,i=e.rectangle,n=i.width,o=i.height,s=n/r.width,c=o/r.height;return a.x=s*(i.west-r.west)/n,a.y=c*(i.south-r.south)/o,a.z=s,a.w=c,a},t["a"]=w},"6b72":function(e,t,a){"use strict";var r=a("2bb9"),i=a("535a"),n=a("2f63"),o=a("6dfc"),s=a("eace"),c=a("a894"),u=a("d289"),l=a("6dc0"),d=a("5770"),h=a("b7c8"),p=a("29ab"),m=a("a307");const f={OPAQUE_FRONT_FACE:0,OPAQUE_BACK_FACE:1,DEPTH_ONLY_FRONT_FACE:2,DEPTH_ONLY_BACK_FACE:3,DEPTH_ONLY_FRONT_AND_BACK_FACE:4,TRANSLUCENT_FRONT_FACE:5,TRANSLUCENT_BACK_FACE:6,TRANSLUCENT_FRONT_FACE_MANUAL_DEPTH_TEST:7,TRANSLUCENT_BACK_FACE_MANUAL_DEPTH_TEST:8,PICK_FRONT_FACE:9,PICK_BACK_FACE:10,DERIVED_COMMANDS_MAXIMUM_LENGTH:11},g=f.DERIVED_COMMANDS_MAXIMUM_LENGTH,_=["opaqueFrontFaceCommand","opaqueBackFaceCommand","depthOnlyFrontFaceCommand","depthOnlyBackFaceCommand","depthOnlyFrontAndBackFaceCommand","translucentFrontFaceCommand","translucentBackFaceCommand","translucentFrontFaceManualDepthTestCommand","translucentBackFaceManualDepthTestCommand","pickFrontFaceCommand","pickBackFaceCommand"];function y(){this._frontFaceAlphaByDistance=new o["a"](0,1,0,1),this._backFaceAlphaByDistance=new o["a"](0,1,0,1),this._frontFaceTranslucent=!1,this._backFaceTranslucent=!1,this._requiresManualDepthTest=!1,this._sunVisibleThroughGlobe=!1,this._environmentVisible=!1,this._useDepthPlane=!1,this._numberOfTextureUniforms=0,this._globeTranslucencyFramebuffer=void 0,this._rectangle=s["a"].clone(s["a"].MAX_VALUE),this._derivedCommandKey=0,this._derivedCommandsDirty=!1,this._derivedCommandPacks=void 0,this._derivedCommandTypes=new Array(g),this._derivedBlendCommandTypes=new Array(g),this._derivedPickCommandTypes=new Array(g),this._derivedCommandTypesToUpdate=new Array(g),this._derivedCommandsLength=0,this._derivedBlendCommandsLength=0,this._derivedPickCommandsLength=0,this._derivedCommandsToUpdateLength=0}function b(e,t,a,r){return e?Object(n["a"])(a)?(o["a"].clone(a,r),r.nearValue*=t,r.farValue*=t,r):(r.nearValue=t,r.farValue=t,r):(r.nearValue=1,r.farValue=1,r)}function T(e,t,a){return e&&(a.baseColor.alpha<1||t.nearValue<1||t.farValue<1)}function C(e,t){const a=e._frontFaceTranslucent,r=e._backFaceTranslucent;return a&&(t.cameraUnderground||r)}function S(e,t){return!t.cameraUnderground||e._frontFaceTranslucent}function A(e,t){return!t.cameraUnderground&&!e._frontFaceTranslucent}function v(e,t,a){return e._frontFaceTranslucent&&!e._backFaceTranslucent&&!a.depthTestAgainstTerrain&&t.mode!==m["a"].SCENE2D&&t.context.depthTexture}function x(e){let t=0;return e._frontFaceTranslucent&&++t,e._requiresManualDepthTest&&++t,t}function E(e,t){let a;e._derivedCommandsLength=O(e,t,!1,!1,e._derivedCommandTypes),e._derivedBlendCommandsLength=O(e,t,!0,!1,e._derivedBlendCommandTypes),e._derivedPickCommandsLength=O(e,t,!1,!0,e._derivedPickCommandTypes);let r=0;for(a=0;a<e._derivedCommandsLength;++a)r|=1<<e._derivedCommandTypes[a];for(a=0;a<e._derivedBlendCommandsLength;++a)r|=1<<e._derivedBlendCommandTypes[a];for(a=0;a<e._derivedPickCommandsLength;++a)r|=1<<e._derivedPickCommandTypes[a];let i=0;for(a=0;a<g;++a)(r&1<<a)>0&&(e._derivedCommandTypesToUpdate[i++]=a);e._derivedCommandsToUpdateLength=i;const o=r!==e._derivedCommandKey;e._derivedCommandKey=r,e._derivedCommandsDirty=o,!Object(n["a"])(e._derivedCommandPacks)&&e._frontFaceTranslucent&&(e._derivedCommandPacks=Z())}function O(e,t,a,r,i){let n=0;const o=e._frontFaceTranslucent,s=e._backFaceTranslucent;if(!o)return n;const c=t.cameraUnderground,u=e._requiresManualDepthTest,l=r?f.PICK_FRONT_FACE:u?f.TRANSLUCENT_FRONT_FACE_MANUAL_DEPTH_TEST:f.TRANSLUCENT_FRONT_FACE,d=r?f.PICK_BACK_FACE:u?f.TRANSLUCENT_BACK_FACE_MANUAL_DEPTH_TEST:f.TRANSLUCENT_BACK_FACE;return t.mode===m["a"].SCENE2D?(i[n++]=f.DEPTH_ONLY_FRONT_FACE,i[n++]=l,n):(s?(a||(i[n++]=f.DEPTH_ONLY_FRONT_AND_BACK_FACE),c?(i[n++]=l,i[n++]=d):(i[n++]=d,i[n++]=l)):c?(a||(i[n++]=f.DEPTH_ONLY_BACK_FACE),i[n++]=f.OPAQUE_FRONT_FACE,i[n++]=d):(a||(i[n++]=f.DEPTH_ONLY_FRONT_FACE),i[n++]=f.OPAQUE_BACK_FACE,i[n++]=l),n)}function D(e,t){const a=e.indexOf(t);a>-1&&e.splice(a,1)}function F(e,t){return e.indexOf(t)>-1}function w(e,t){D(e.defines,"TRANSLUCENT"),D(t.defines,"TRANSLUCENT")}function R(e,t){D(e.defines,"GROUND_ATMOSPHERE"),D(t.defines,"GROUND_ATMOSPHERE"),D(e.defines,"FOG"),D(t.defines,"FOG"),D(e.defines,"TRANSLUCENT"),D(t.defines,"TRANSLUCENT")}function L(e,t){if(F(t.defines,"TILE_LIMIT_RECTANGLE")||F(t.defines,"ENABLE_CLIPPING_PLANES"))return;const a="void main() \n{ \n    gl_FragColor = vec4(1.0); \n} \n";t.sources=[a]}function N(e,t){const a=t.sources,r=a.length;for(let n=0;n<r;++n)a[n]=d["a"].replaceMain(a[n],"czm_globe_translucency_main");const i="\n\nuniform sampler2D u_classificationTexture; \nvoid main() \n{ \n    vec2 st = gl_FragCoord.xy / czm_viewport.zw; \n#ifdef MANUAL_DEPTH_TEST \n    float logDepthOrDepth = czm_unpackDepth(texture2D(czm_globeDepthTexture, st)); \n    if (logDepthOrDepth != 0.0) \n    { \n        vec4 eyeCoordinate = czm_windowToEyeCoordinates(gl_FragCoord.xy, logDepthOrDepth); \n        float depthEC = eyeCoordinate.z / eyeCoordinate.w; \n        if (v_positionEC.z < depthEC) \n        { \n            discard; \n        } \n    } \n#endif \n    czm_globe_translucency_main(); \n    vec4 classificationColor = texture2D(u_classificationTexture, st); \n    if (classificationColor.a > 0.0) \n    { \n        // Reverse premultiplication process to get the correct composited result of the classification primitives \n        classificationColor.rgb /= classificationColor.a; \n    } \n    gl_FragColor = classificationColor * vec4(classificationColor.aaa, 1.0) + gl_FragColor * (1.0 - classificationColor.a); \n} \n";a.push(i)}function M(e,t){N(e,t),D(e.defines,"GROUND_ATMOSPHERE"),D(t.defines,"GROUND_ATMOSPHERE"),D(e.defines,"FOG"),D(t.defines,"FOG")}function P(e,t){N(e,t),e.defines.push("GENERATE_POSITION"),t.defines.push("MANUAL_DEPTH_TEST")}function I(e,t){M(e,t),e.defines.push("GENERATE_POSITION"),t.defines.push("MANUAL_DEPTH_TEST")}function B(e,t){const a="uniform sampler2D u_classificationTexture; \nvoid main() \n{ \n    vec2 st = gl_FragCoord.xy / czm_viewport.zw; \n    vec4 pickColor = texture2D(u_classificationTexture, st); \n    if (pickColor == vec4(0.0)) \n    { \n        discard; \n    } \n    gl_FragColor = pickColor; \n} \n";t.sources=[a]}function j(e,t,a,r,i,o){if(!Object(n["a"])(i))return t;if(!r&&Object(n["a"])(a))return a;let s=e.shaderCache.getDerivedShaderProgram(t,o);if(!Object(n["a"])(s)){const a=t._attributeLocations,r=t.vertexShaderSource.clone(),c=t.fragmentShaderSource.clone();r.defines=Object(n["a"])(r.defines)?r.defines.slice(0):[],c.defines=Object(n["a"])(c.defines)?c.defines.slice(0):[],i(r,c),s=e.shaderCache.createDerivedShaderProgram(t,o,{vertexShaderSource:r,fragmentShaderSource:c,attributeLocations:a})}return s}function H(e){e.cull.face=p["a"].BACK,e.cull.enabled=!0}function k(e){e.cull.face=p["a"].FRONT,e.cull.enabled=!0}function U(e){e.cull.face=p["a"].BACK,e.cull.enabled=!0,e.colorMask={red:!1,green:!1,blue:!1,alpha:!1}}function G(e){e.cull.face=p["a"].FRONT,e.cull.enabled=!0,e.colorMask={red:!1,green:!1,blue:!1,alpha:!1}}function V(e){e.cull.enabled=!1,e.colorMask={red:!1,green:!1,blue:!1,alpha:!1}}function z(e){e.cull.face=p["a"].BACK,e.cull.enabled=!0,e.depthMask=!1,e.blending=h["a"].ALPHA_BLEND}function W(e){e.cull.face=p["a"].FRONT,e.cull.enabled=!0,e.depthMask=!1,e.blending=h["a"].ALPHA_BLEND}function Y(e){e.cull.face=p["a"].BACK,e.cull.enabled=!0,e.blending.enabled=!1}function q(e){e.cull.face=p["a"].FRONT,e.cull.enabled=!0,e.blending.enabled=!1}function K(e,t,a,r,i){if(!Object(n["a"])(r))return e;if(!a&&Object(n["a"])(t))return t;let o=i[e.id];if(!Object(n["a"])(o)){const t=l["a"].getState(e);r(t),o=l["a"].fromCache(t),i[e.id]=o}return o}function $(e){return{u_classificationTexture:function(){return e._globeTranslucencyFramebuffer.classificationTexture}}}function Q(e,t,a,i,o){return Object(n["a"])(o)?!i&&Object(n["a"])(a)?a:Object(r["a"])(t,o(e),!1):t}function X(e){this.pass=e.pass,this.pickOnly=e.pickOnly,this.getShaderProgramFunction=e.getShaderProgramFunction,this.getRenderStateFunction=e.getRenderStateFunction,this.getUniformMapFunction=e.getUniformMapFunction,this.renderStateCache={}}function Z(){return[new X({pass:u["a"].GLOBE,pickOnly:!1,getShaderProgramFunction:w,getRenderStateFunction:H,getUniformMapFunction:void 0}),new X({pass:u["a"].GLOBE,pickOnly:!1,getShaderProgramFunction:R,getRenderStateFunction:k,getUniformMapFunction:void 0}),new X({pass:u["a"].GLOBE,pickOnly:!1,getShaderProgramFunction:L,getRenderStateFunction:U,getUniformMapFunction:void 0}),new X({pass:u["a"].GLOBE,pickOnly:!1,getShaderProgramFunction:L,getRenderStateFunction:G,getUniformMapFunction:void 0}),new X({pass:u["a"].GLOBE,pickOnly:!1,getShaderProgramFunction:L,getRenderStateFunction:V,getUniformMapFunction:void 0}),new X({pass:u["a"].TRANSLUCENT,pickOnly:!1,getShaderProgramFunction:N,getRenderStateFunction:z,getUniformMapFunction:$}),new X({pass:u["a"].TRANSLUCENT,pickOnly:!1,getShaderProgramFunction:M,getRenderStateFunction:W,getUniformMapFunction:$}),new X({pass:u["a"].TRANSLUCENT,pickOnly:!1,getShaderProgramFunction:P,getRenderStateFunction:z,getUniformMapFunction:$}),new X({pass:u["a"].TRANSLUCENT,pickOnly:!1,getShaderProgramFunction:I,getRenderStateFunction:W,getUniformMapFunction:$}),new X({pass:u["a"].TRANSLUCENT,pickOnly:!0,getShaderProgramFunction:B,getRenderStateFunction:Y,getUniformMapFunction:$}),new X({pass:u["a"].TRANSLUCENT,pickOnly:!0,getShaderProgramFunction:B,getRenderStateFunction:q,getUniformMapFunction:$})]}Object.defineProperties(y.prototype,{frontFaceAlphaByDistance:{get:function(){return this._frontFaceAlphaByDistance}},backFaceAlphaByDistance:{get:function(){return this._backFaceAlphaByDistance}},translucent:{get:function(){return this._frontFaceTranslucent}},sunVisibleThroughGlobe:{get:function(){return this._sunVisibleThroughGlobe}},environmentVisible:{get:function(){return this._environmentVisible}},useDepthPlane:{get:function(){return this._useDepthPlane}},numberOfTextureUniforms:{get:function(){return this._numberOfTextureUniforms}},rectangle:{get:function(){return this._rectangle}}}),y.prototype.update=function(e){const t=e.globe;if(!Object(n["a"])(t)||!t.show)return this._frontFaceTranslucent=!1,this._backFaceTranslucent=!1,this._sunVisibleThroughGlobe=!0,this._environmentVisible=!0,void(this._useDepthPlane=!1);this._frontFaceAlphaByDistance=b(t.translucency.enabled,t.translucency.frontFaceAlpha,t.translucency.frontFaceAlphaByDistance,this._frontFaceAlphaByDistance),this._backFaceAlphaByDistance=b(t.translucency.enabled,t.translucency.backFaceAlpha,t.translucency.backFaceAlphaByDistance,this._backFaceAlphaByDistance),this._frontFaceTranslucent=T(t.translucency.enabled,this._frontFaceAlphaByDistance,t),this._backFaceTranslucent=T(t.translucency.enabled,this._backFaceAlphaByDistance,t),this._requiresManualDepthTest=v(this,e,t),this._sunVisibleThroughGlobe=C(this,e),this._environmentVisible=S(this,e),this._useDepthPlane=A(this,e),this._numberOfTextureUniforms=x(this),this._rectangle=s["a"].clone(t.translucency.rectangle,this._rectangle),E(this,e)};const J=new Array(g),ee=new Array(g);function te(e,t,a,r,o,s,u){let l=t.derivedCommands.globeTranslucency;const d=e._derivedCommandsDirty;if(t.dirty||!Object(n["a"])(l)||d){t.dirty=!1,Object(n["a"])(l)||(l={},t.derivedCommands.globeTranslucency=l);const d=u.frameNumber,h=Object(i["a"])(l.uniformMapDirtyFrame,0),p=Object(i["a"])(l.shaderProgramDirtyFrame,0),m=Object(i["a"])(l.renderStateDirtyFrame,0),f=l.uniformMap!==t.uniformMap,g=l.shaderProgramId!==t.shaderProgram.id,_=l.renderStateId!==t.renderState.id;f&&(l.uniformMapDirtyFrame=d),g&&(l.shaderProgramDirtyFrame=d),_&&(l.renderStateDirtyFrame=d),l.uniformMap=t.uniformMap,l.shaderProgramId=t.shaderProgram.id,l.renderStateId=t.renderState.id;for(let y=0;y<a;++y){const a=s[y],b=r[y],T=o[y];let C,S,A,v=l[T];Object(n["a"])(v)?(C=v.uniformMap,S=v.shaderProgram,A=v.renderState):(C=void 0,S=void 0,A=void 0),v=c["a"].shallowClone(t,v),l[T]=v;const x=Object(i["a"])(v.derivedCommands.uniformMapDirtyFrame,0),E=Object(i["a"])(v.derivedCommands.shaderProgramDirtyFrame,0),O=Object(i["a"])(v.derivedCommands.renderStateDirtyFrame,0),D=f||x<h,F=g||E<p,w=_||O<m;D&&(v.derivedCommands.uniformMapDirtyFrame=d),F&&(v.derivedCommands.shaderProgramDirtyFrame=d),w&&(v.derivedCommands.renderStateDirtyFrame=d),v.derivedCommands.type=b,v.pass=a.pass,v.pickOnly=a.pickOnly,v.uniformMap=Q(e,t.uniformMap,C,D,a.getUniformMapFunction),v.shaderProgram=j(u.context,t.shaderProgram,S,F,a.getShaderProgramFunction,T),v.renderState=K(t.renderState,A,w,a.getRenderStateFunction,a.renderStateCache)}}}function ae(e,t,a,r,i,o,s){for(let c=0;c<t;++c){const t=e[c],u=t.derivedCommands.type;(!Object(n["a"])(s)||s.indexOf(u)>-1)&&a(t,r,i,o)}}function re(e,t,a,r,i,n){for(let o=0;o<t;++o)a(e[o],r,i,n)}y.prototype.updateDerivedCommands=function(e,t){const a=this._derivedCommandTypesToUpdate,r=this._derivedCommandsToUpdateLength;if(0!==r){for(let e=0;e<r;++e)ee[e]=this._derivedCommandPacks[a[e]],J[e]=_[a[e]];te(this,e,r,a,J,ee,t)}},y.prototype.pushDerivedCommands=function(e,t,a){const r=a.passes.pick;if(r&&t)return;let i=this._derivedCommandTypes,n=this._derivedCommandsLength;if(r?(i=this._derivedPickCommandTypes,n=this._derivedPickCommandsLength):t&&(i=this._derivedBlendCommandTypes,n=this._derivedBlendCommandsLength),0===n)return void a.commandList.push(e);const o=e.derivedCommands.globeTranslucency;for(let s=0;s<n;++s){const e=_[i[s]];a.commandList.push(o[e])}};const ie=[f.OPAQUE_FRONT_FACE,f.OPAQUE_BACK_FACE],ne=[f.DEPTH_ONLY_FRONT_FACE,f.DEPTH_ONLY_BACK_FACE,f.DEPTH_ONLY_FRONT_AND_BACK_FACE];y.prototype.executeGlobeCommands=function(e,t,a,r,i){const n=r.context,o=e.commands[u["a"].GLOBE],s=e.indices[u["a"].GLOBE];0!==s&&(this._globeTranslucencyFramebuffer=a,a.clearClassification(n,i),ae(o,s,t,r,n,i,ie))},y.prototype.executeGlobeClassificationCommands=function(e,t,a,r,i){const n=r.context,o=e.commands[u["a"].GLOBE],s=e.indices[u["a"].GLOBE],c=e.commands[u["a"].TERRAIN_CLASSIFICATION],l=e.indices[u["a"].TERRAIN_CLASSIFICATION];if(0===s||0===l)return;const d=this._frontFaceTranslucent,h=this._backFaceTranslucent;if(d&&h||re(c,l,t,r,n,i),!d&&!h)return;this._globeTranslucencyFramebuffer=a;const p=n.uniformState.globeDepthTexture,m=i.framebuffer;if(i.framebuffer=a.classificationFramebuffer,ae(o,s,t,r,n,i,ne),n.depthTexture){const e=a.packDepth(n,i);n.uniformState.globeDepthTexture=e}re(c,l,t,r,n,i),n.uniformState.globeDepthTexture=p,i.framebuffer=m},t["a"]=y},"6f08":function(e,t,a){"use strict";var r=a("77af"),i=a("bd8d"),n=a("2f63"),o=a("7d62"),s=a("f845"),c=a("f630"),u=a("6ef5"),l=a("6dc0"),d=a("3720"),h=a("987b"),p=a("b7c8"),m=a("3626"),f=a("6102"),g=a("25ef");function _(){this._picking=!1,this._numSamples=1,this._tempCopyDepthTexture=void 0,this._pickColorFramebuffer=new c["a"]({depthStencil:!0,supportsDepthTexture:!0}),this._outputFramebuffer=new c["a"]({depthStencil:!0,supportsDepthTexture:!0}),this._copyDepthFramebuffer=new c["a"],this._tempCopyDepthFramebuffer=new c["a"],this._updateDepthFramebuffer=new c["a"]({createColorAttachments:!1,createDepthAttachments:!1,depthStencil:!0}),this._clearGlobeColorCommand=void 0,this._copyColorCommand=void 0,this._copyDepthCommand=void 0,this._tempCopyDepthCommand=void 0,this._updateDepthCommand=void 0,this._viewport=new r["a"],this._rs=void 0,this._rsBlend=void 0,this._rsUpdate=void 0,this._useScissorTest=!1,this._scissorRectangle=void 0,this._useHdr=void 0,this._clearGlobeDepth=void 0}function y(e){e._pickColorFramebuffer.destroy(),e._outputFramebuffer.destroy(),e._copyDepthFramebuffer.destroy(),e._tempCopyDepthFramebuffer.destroy(),e._updateDepthFramebuffer.destroy()}function b(e,t,a,o,c){e._viewport.width=a,e._viewport.height=o;const u=!r["a"].equals(e._viewport,c.viewport);let _=u!==e._useScissorTest;e._useScissorTest=u,r["a"].equals(e._scissorRectangle,c.viewport)||(e._scissorRectangle=r["a"].clone(c.viewport,e._scissorRectangle),_=!0),Object(n["a"])(e._rs)&&r["a"].equals(e._viewport,e._rs.viewport)&&!_||(e._rs=l["a"].fromCache({viewport:e._viewport,scissorTest:{enabled:e._useScissorTest,rectangle:e._scissorRectangle}}),e._rsBlend=l["a"].fromCache({viewport:e._viewport,scissorTest:{enabled:e._useScissorTest,rectangle:e._scissorRectangle},blending:p["a"].ALPHA_BLEND}),e._rsUpdate=l["a"].fromCache({viewport:e._viewport,scissorTest:{enabled:e._useScissorTest,rectangle:e._scissorRectangle},stencilTest:{enabled:!0,frontFunction:f["a"].EQUAL,frontOperation:{fail:g["a"].KEEP,zFail:g["a"].KEEP,zPass:g["a"].KEEP},backFunction:f["a"].NEVER,reference:m["a"].CESIUM_3D_TILE_MASK,mask:m["a"].CESIUM_3D_TILE_MASK}})),Object(n["a"])(e._copyDepthCommand)||(e._copyDepthCommand=t.createViewportQuadCommand(h["a"],{uniformMap:{u_depthTexture:function(){return e.colorFramebufferManager.getDepthStencilTexture()}},owner:e})),e._copyDepthCommand.framebuffer=e._copyDepthFramebuffer.framebuffer,e._copyDepthCommand.renderState=e._rs,Object(n["a"])(e._copyColorCommand)||(e._copyColorCommand=t.createViewportQuadCommand(d["a"],{uniformMap:{colorTexture:function(){return e.colorFramebufferManager.getColorTexture()}},owner:e})),e._copyColorCommand.renderState=e._rs,Object(n["a"])(e._tempCopyDepthCommand)||(e._tempCopyDepthCommand=t.createViewportQuadCommand(h["a"],{uniformMap:{u_depthTexture:function(){return e._tempCopyDepthTexture}},owner:e})),e._tempCopyDepthCommand.framebuffer=e._tempCopyDepthFramebuffer.framebuffer,e._tempCopyDepthCommand.renderState=e._rs,Object(n["a"])(e._updateDepthCommand)||(e._updateDepthCommand=t.createViewportQuadCommand(d["a"],{uniformMap:{colorTexture:function(){return e._tempCopyDepthFramebuffer.getColorTexture()}},owner:e})),e._updateDepthCommand.framebuffer=e._updateDepthFramebuffer.framebuffer,e._updateDepthCommand.renderState=e._rsUpdate,Object(n["a"])(e._clearGlobeColorCommand)||(e._clearGlobeColorCommand=new s["a"]({color:new i["a"](0,0,0,0),stencil:0,owner:e})),e._clearGlobeColorCommand.framebuffer=e.framebuffer}Object.defineProperties(_.prototype,{colorFramebufferManager:{get:function(){return this._picking?this._pickColorFramebuffer:this._outputFramebuffer}},framebuffer:{get:function(){return this.colorFramebufferManager.framebuffer}},depthStencilTexture:{get:function(){return this.colorFramebufferManager.getDepthStencilTexture()}},picking:{get:function(){return this._picking},set:function(e){this._picking=e}}}),_.prototype.update=function(e,t,a,r,i,n){const o=a.width,s=a.height,c=i?e.halfFloatingPointTexture?u["a"].HALF_FLOAT:u["a"].FLOAT:u["a"].UNSIGNED_BYTE;this._numSamples=r,this.picking?this._pickColorFramebuffer.update(e,o,s):this._outputFramebuffer.update(e,o,s,r,c),this._copyDepthFramebuffer.update(e,o,s),b(this,e,o,s,t),e.uniformState.globeDepthTexture=void 0,this._useHdr=i,this._clearGlobeDepth=n},_.prototype.prepareColorTextures=function(e,t){!this.picking&&this._numSamples>1&&this._outputFramebuffer.prepareTextures(e,t)},_.prototype.executeCopyDepth=function(e,t){Object(n["a"])(this._copyDepthCommand)&&(this.prepareColorTextures(e),this._copyDepthCommand.execute(e,t),e.uniformState.globeDepthTexture=this._copyDepthFramebuffer.getColorTexture())},_.prototype.executeUpdateDepth=function(e,t,a,r){const i=Object(n["a"])(r)?r:t.framebuffer.depthStencilTexture;if(a||i!==this.colorFramebufferManager.getDepthStencilTexture()){if(Object(n["a"])(this._updateDepthCommand)){if(!Object(n["a"])(this._updateDepthFramebuffer.framebuffer)||this._updateDepthFramebuffer.getDepthStencilTexture()!==i||this._updateDepthFramebuffer.getColorTexture()!==this._copyDepthFramebuffer.getColorTexture()){const a=this._copyDepthFramebuffer.getColorTexture().width,r=this._copyDepthFramebuffer.getColorTexture().height;this._tempCopyDepthFramebuffer.destroy(),this._tempCopyDepthFramebuffer.update(e,a,r);const n=this._copyDepthFramebuffer.getColorTexture();this._updateDepthFramebuffer.setColorTexture(n,0),this._updateDepthFramebuffer.setDepthStencilTexture(i),this._updateDepthFramebuffer.update(e,a,r),b(this,e,a,r,t)}this._tempCopyDepthTexture=i,this._tempCopyDepthCommand.execute(e,t),this._updateDepthCommand.execute(e,t)}}else Object(n["a"])(this._copyDepthCommand)&&this._copyDepthCommand.execute(e,t)},_.prototype.executeCopyColor=function(e,t){Object(n["a"])(this._copyColorCommand)&&this._copyColorCommand.execute(e,t)},_.prototype.clear=function(e,t,a){const r=this._clearGlobeColorCommand;Object(n["a"])(r)&&(i["a"].clone(a,r.color),this.colorFramebufferManager.clear(e,r,t))},_.prototype.isDestroyed=function(){return!1},_.prototype.destroy=function(){return y(this),Object(n["a"])(this._copyColorCommand)&&(this._copyColorCommand.shaderProgram=this._copyColorCommand.shaderProgram.destroy()),Object(n["a"])(this._copyDepthCommand)&&(this._copyDepthCommand.shaderProgram=this._copyDepthCommand.shaderProgram.destroy()),Object(n["a"])(this._tempCopyDepthCommand)&&(this._tempCopyDepthCommand.shaderProgram=this._tempCopyDepthCommand.shaderProgram.destroy()),Object(n["a"])(this._updateDepthCommand)&&(this._updateDepthCommand.shaderProgram=this._updateDepthCommand.shaderProgram.destroy()),Object(o["a"])(this)},t["a"]=_},8004:function(e,t,a){"use strict";var r=a("77af"),i=a("bd8d"),n=a("2f63"),o=a("7d62"),s=a("f845"),c=a("f630"),u=a("6ef5"),l=a("6dc0"),d=a("987b");function h(){this._framebuffer=new c["a"]({depthStencil:!0,supportsDepthTexture:!0}),this._packedDepthFramebuffer=new c["a"],this._renderState=void 0,this._packedDepthCommand=void 0,this._clearCommand=void 0,this._viewport=new r["a"],this._useScissorTest=!1,this._scissorRectangle=void 0,this._useHdr=void 0}function p(e){e._framebuffer.destroy(),e._packedDepthFramebuffer.destroy()}function m(e,t,a,r,i){const n=i?t.halfFloatingPointTexture?u["a"].HALF_FLOAT:u["a"].FLOAT:u["a"].UNSIGNED_BYTE;e._framebuffer.update(t,a,r,1,n),e._packedDepthFramebuffer.update(t,a,r)}function f(e,t,a,o,c){e._viewport.width=a,e._viewport.height=o;const u=!r["a"].equals(e._viewport,c.viewport);let h=u!==e._useScissorTest;e._useScissorTest=u,r["a"].equals(e._scissorRectangle,c.viewport)||(e._scissorRectangle=r["a"].clone(c.viewport,e._scissorRectangle),h=!0),Object(n["a"])(e._renderState)&&r["a"].equals(e._viewport,e._renderState.viewport)&&!h||(e._renderState=l["a"].fromCache({viewport:e._viewport,scissorTest:{enabled:e._useScissorTest,rectangle:e._scissorRectangle}})),Object(n["a"])(e._packedDepthCommand)||(e._packedDepthCommand=t.createViewportQuadCommand(d["a"],{uniformMap:{u_depthTexture:function(){return e.depthStencilTexture}},owner:e})),Object(n["a"])(e._clearCommand)||(e._clearCommand=new s["a"]({color:new i["a"](0,0,0,0),depth:1,stencil:0,owner:e})),e._packedDepthCommand.framebuffer=e._packedDepthFramebuffer.framebuffer,e._packedDepthCommand.renderState=e._renderState,e._clearCommand.framebuffer=e.classificationFramebuffer,e._clearCommand.renderState=e._renderState}Object.defineProperties(h.prototype,{classificationTexture:{get:function(){return this._framebuffer.getColorTexture()}},classificationFramebuffer:{get:function(){return this._framebuffer.framebuffer}},packedDepthFramebuffer:{get:function(){return this._packedDepthFramebuffer.framebuffer}},depthStencilTexture:{get:function(){return this._framebuffer.getDepthStencilTexture()}},depthStencilRenderbuffer:{get:function(){return this._framebuffer.getDepthStencilRenderbuffer()}},packedDepthTexture:{get:function(){return this._packedDepthFramebuffer.getColorTexture()}}}),h.prototype.updateAndClear=function(e,t,a,r){const i=t.width,n=t.height;m(this,a,i,n,e),f(this,a,i,n,r),this._useHdr=e},h.prototype.clearClassification=function(e,t){this._clearCommand.execute(e,t)},h.prototype.packDepth=function(e,t){return this._packedDepthCommand.execute(e,t),this.packedDepthTexture},h.prototype.isDestroyed=function(){return!1},h.prototype.destroy=function(){return p(this),Object(o["a"])(this)},t["a"]=h}}]);